"use strict";(self.webpackChunkjupyter_sankey_widget=self.webpackChunkjupyter_sankey_widget||[]).push([[614],{2614:(e,t,l)=>{l.r(t),l.d(t,{SankeyModel:()=>c,SankeyView:()=>m,version:()=>p.i8});var s=l(7672),i=l(101),n=l(96),a=(l(8212),l(9628)),o=l(1253),r=l(4943),d=new XMLSerializer;class c extends s.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:"SankeyModel",_view_name:"SankeyView",_model_module:"jupyter-sankey-widget",_view_module:"jupyter-sankey-widget",_model_module_version:"0.5.0",_view_module_version:"0.5.0",links:[],nodes:[],order:null,groups:[],rank_sets:[],align_link_types:!1,scale:null,margins:{},png:"",svg:"",linkLabelFormat:"",linkLabelMinWidth:5,node_position_attr:null}}}function h(e){return void 0!==e.title?e.title:e.id}var g=(0,n.scaleOrdinal)(n.schemeCategory20);function u(e){return void 0!==e.color?e.color:g(e.type)}var k=(0,a.format)(".3s"),y=(0,o.sankeyLinkTitle)(h,(function(e){return void 0!==e.title?e.title:e.type}),k);class m extends s.DOMWidgetView{render(){this.sankeyLayout=(0,o.sankey)(),this.diagram=(0,o.sankeyDiagram)().nodeTitle(h).linkTitle(y).linkColor(u),(0,i.select)(this.el).append("svg"),(0,i.select)(this.el).append("div").attr("class","sankey-element-info"),this.diagram.on("selectNode",this.node_clicked.bind(this)),this.diagram.on("selectLink",this.link_clicked.bind(this)),this.value_changed(),this.model.on("change:layout change:links change:nodes change:order change:groups change:rank_sets change:align_link_types change:scale change:margins change:linkLabelFormat change:linkLabelMinWidth change:node_position_attr",this.value_changed,this)}value_changed(){var e=this,t=this.model.get("layout"),l=parseInt(t.get("width")||"600",10),s=parseInt(t.get("height")||"400",10),n={top:10,bottom:10,left:100,right:100,...this.model.get("margins")},o=this.model.get("linkLabelFormat"),c=this.model.get("linkLabelMinWidth"),h=o?(0,a.format)(o):function(e){return null};this.diagram.linkLabel((function(e){return e.dy>c?h(e.value):null})),this.sankeyLayout.scale(this.model.get("scale"));var g,u,k=this.model.get("order");this.diagram.margins(n).groups(this.model.get("groups")),this.sankeyLayout.size([l-n.left-n.right,s-n.top-n.bottom]).ordering(k&&k.length?k:null).rankSets(this.model.get("rank_sets")),g=this.sankeyLayout,u=this.model.get("align_link_types"),g.sourceId((function(e){return{id:"object"==typeof e.source?e.source.id:e.source,port:u?e.type:null}})).targetId((function(e){return{id:"object"==typeof e.target?e.target.id:e.target,port:u?e.type:null}}));var y=this.model.get("node_position_attr");y?(this.sankeyLayout.nodePosition((e=>e[y])),this.sankeyLayout.scale()||this.sankeyLayout.scale(1)):this.sankeyLayout.nodePosition(null);var m=this.sankeyLayout({nodes:JSON.parse(JSON.stringify(this.model.get("nodes"))),links:JSON.parse(JSON.stringify(this.model.get("links")))}),p=(0,i.select)(this.el).select("svg").datum(m).transition().duration(500).call(this.diagram);this.model.set("scale",this.sankeyLayout.scale()),p.attr("width",l).attr("height",s).attr("viewBox","0 0 "+l+" "+s).style("font-family",'"Helvetica Neue", Helvetica, Arial, sans-serif'),p.selectAll(".link").style("opacity",.8);var _=this.sankeyLayout.scale();p.selectAll(".link").selectAll(".link-marker").selection().data((e=>e.marker?[e]:[])).join("path").attr("class","link-marker").style("stroke","black").style("fill","none").style("opacity",.8).attr("transform",(e=>`translate(${e.points[0].x+10}, ${e.points[0].y})`)).attr("d",(e=>`M-4,-${e.marker/2*_} l8,0 m-4,0 l0,${e.marker*_} m-4,0 l8,0`)),p.selectAll("line").style("stroke",(function(e){return"process"===e.style?"#888":"#000"})).style("stroke-width",(function(e){return"process"===e.style?"4px":"1px"})),p.selectAll("rect").style("fill","none"),p.selectAll(".group").select("rect").style("fill","#eee").style("stroke","#bbb").style("stroke-width","0.5"),p.selectAll(".group").select("text").style("fill","#999"),setTimeout((function(){var t;(0,r.svgAsPngUri)(p.node(),{},(function(t){e.model.set("png",t.slice(22)),e.touch()})),e.model.set("svg",(t=p.node(),'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+d.serializeToString(t))),e.touch()}),800)}titles_changed(){(0,i.select)(this.el).call(this.diagram)}node_clicked(e){var t=e?{id:e.id}:null;this.send({event:"node_clicked",node:t})}link_clicked(e){var t=e?{source:e.source.id,target:e.target.id,type:e.type,value:e.value}:null;this.send({event:"link_clicked",link:t});var l=this.model.get("show_link_info_html"),s=(0,i.select)(this.el).select(".sankey-element-info");l&&e&&e.info_html?s.html(e.info_html):s.html("")}}const p={i8:"0.5.0"}}}]);