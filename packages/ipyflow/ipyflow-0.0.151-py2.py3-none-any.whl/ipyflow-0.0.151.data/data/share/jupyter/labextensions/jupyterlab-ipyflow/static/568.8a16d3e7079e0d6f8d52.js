"use strict";(self.webpackChunkjupyterlab_ipyflow=self.webpackChunkjupyterlab_ipyflow||[]).push([[568],{568:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var l=n(835),o=n(415),d=n(145);const s="ipyflow",a={id:"jupyterlab-ipyflow",requires:[d.INotebookTracker,l.ICommandPalette],autoStart:!0,activate:(e,t,n)=>{e.commands.addCommand("alt-mode-execute",{label:"Alt Mode Execute",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>{if("code"===t.activeCell.model.type){const e=t.currentWidget.sessionContext;e.isReady&&"code"===t.activeCell.model.type&&e.session.kernel.requestExecute({code:"%flow toggle-reactivity-until-next-reset",silent:!0,store_history:!1}).done.then((()=>{o.CodeCell.execute(t.activeCell,e)}))}}}),e.commands.addKeyBinding({command:"alt-mode-execute",keys:["Accel Shift Enter"],selector:".jp-Notebook"}),n.addItem({command:"alt-mode-execute",category:"execution",args:{}}),t.widgetAdded.connect(((e,t)=>{const n=t.sessionContext;n.ready.then((()=>{T(t.content),_=t.content.activeCell,p=t.content.activeCell.model.id;let e=()=>{};n.session.kernel.name===s&&(e=K(n,t.content)),n.kernelChanged.connect(((l,o)=>{T(t.content),e(),e=()=>{},null!==o.newValue&&o.newValue.name===s&&(e=K(n,t.content))}));let l=!1;n.statusChanged.connect(((n,o)=>{"restarting"!==o&&"autorestarting"!==o||(l=!0),"idle"!==o&&"busy"!==o||!l||(l=!1,n.ready.then((()=>{T(t.content),e(),e=()=>{},n.session.kernel.name===s&&(e=K(n,t.content))})))}))}))}))}},i="waiting-cell",c="ready-cell",r="ready-making-cell",u="ready-making-input-cell",m="linked-waiting",f="linked-ready-maker";let h=new Set,v=new Set,y=new Set,C={},w={},_=null,p=null,g={},x={},E={},L=null,k=null,S=!1,b=null,j=new Set,V=new Set,A=new Set;const D=new Event("cleanup"),I=e=>{if(null==e)return null;const t=e.children.item(1);return null===t?null:t.firstElementChild},O=e=>{if(null==e)return null;const t=e.children.item(2);return null===t?null:t.firstElementChild},P=(e,t,n)=>{const l=()=>{e.removeEventListener(t,n),e.removeEventListener("cleanup",l)};e.addEventListener(t,n),e.addEventListener("cleanup",l)},q=(e,t,n,l,o)=>{null!==e&&null!==t&&P(e,n,(()=>{t.firstElementChild.classList[l](o)}))},M=(e,t)=>{q(I(e),O(e),"mouseover","add",m),q(I(e),O(e),"mouseout","remove",m),q(O(e),I(e),"mouseover","add",t),q(O(e),I(e),"mouseout","remove",t)},N=e=>{g={},x={},E={},e.widgets.forEach(((e,t)=>{g[e.model.id]=e.node,x[e.model.id]=e.model,E[e.model.id]=t}))},T=e=>{e.widgets.forEach(((e,t)=>{e.node.classList.remove(i),e.node.classList.remove(r),e.node.classList.remove(c),e.node.classList.remove(u);const n=I(e.node);null!==n&&(n.firstElementChild.classList.remove(m),n.firstElementChild.classList.remove(f),n.dispatchEvent(D));const l=O(e.node);null!==l&&(l.firstElementChild.classList.remove(m),l.firstElementChild.classList.remove(f),l.dispatchEvent(D))}))},B=(e,t,n,l,o,d,s)=>{if(null===e)return;const a=()=>{for(const e of t){let t=f;s.has(e)&&(t=m);const o=l(n[e]);if(null===o||null===o.firstElementChild)return;o.firstElementChild.classList[d](t)}};e.addEventListener(o,a),P(e,o,a)},K=(e,t)=>{const n=e.session.kernel.createComm("ipyflow");let l=!1;const d=(e,o)=>{if(l)return void e.stateChanged.disconnect(d);if("executionCount"!==o.name||null===o.newValue)return;const s={};t.widgets.forEach(((t,n)=>{s[t.model.id]={index:n,content:t.model.value.text,type:t.model.type},t.model.id===e.id&&(t.node.classList.remove(c),t.node.classList.remove(u))})),n.send({type:"compute_exec_schedule",executed_cell_id:e.id,cell_metadata_by_id:s})},s=e=>{let l=-1;t.widgets.forEach(((t,n)=>{t.model.id===e.id&&(l=n)}));const o={type:"change_active_cell",active_cell_id:e.id,active_cell_order_idx:l};n.send(o)},a=(e,n)=>{if(t===e)if(l)t.activeCellChanged.disconnect(a);else if(s(n.model),null!==_&&null!==_.model&&(_.model.isDirty?h.add(p):h.delete(p),_.model.stateChanged.disconnect(d,_.model.stateChanged)),_=n,p=n.model.id,null!==_&&null!==_.model&&"code"===_.model.type){if(_.model.stateChanged.connect(d),s(_.model),h.has(p)){const e=_.model;void 0!==e._setDirty&&e._setDirty(!0)}N(t),D(p)}};t.activeCellChanged.connect(a);const E=[{action:"mouseover",update:"add"},{action:"mouseout",update:"remove"}],D=e=>{const t=x[e];if("code"!==t.type)return;if(null==t.executionCount)return;const n=g[e];v.has(e)?(n.classList.add(i),n.classList.add(c),n.classList.remove(u),M(n,m)):y.has(e)&&(n.classList.add(u),"normal"===k&&(n.classList.add(c),M(n,f))),"reactive"!==k&&(C.hasOwnProperty(e)&&E.forEach((({action:t,update:l})=>{B(I(n),C[e],g,I,t,l,v),B(O(n),C[e],g,I,t,l,v)})),w.hasOwnProperty(e)&&(v.has(e)||(n.classList.add(r),n.classList.add(c)),E.forEach((({action:t,update:l})=>{B(I(n),w[e],g,I,t,l,v),B(I(n),w[e],g,O,t,l,v)}))))};return n.onMsg=i=>{if(!l)if("establish"===i.content.data.type)t.activeCell.model.stateChanged.connect(d),s(t.activeCell.model);else if("compute_exec_schedule"===i.content.data.type){v=new Set(i.content.data.waiting_cells),y=new Set(i.content.data.ready_cells),V=new Set([...V,...i.content.data.new_ready_cells]),A=new Set([...A,...i.content.data.forced_reactive_cells]),C=i.content.data.waiter_links,w=i.content.data.ready_maker_links,L=null;const l=i.content.data.exec_mode,d=i.content.data.flow_order,s=i.content.data.exec_schedule;if(k=l,b=i.content.data.highlights,j.add(i.content.data.last_executed_cell_id),!i.content.data.last_execution_was_error)for(const e of t.widgets){if("code"!==e.model.type||j.has(e.model.id))continue;if(!(A.has(e.model.id)||"reactive"===l&&V.has(e.model.id)))continue;const t=e;if(null===L){if(L=t,"in_order"===d||"strict"===s)break}else null==t.model.executionCount||t.model.executionCount<L.model.executionCount&&(L=t)}null===L?(S?("reactive"===b&&(y=j),V=new Set,A=new Set,j=new Set,n.send({type:"reactivity_cleanup"})):j=new Set,(e=>{if(T(e),"none"!==b){N(e);for(const[e]of Object.entries(g))D(e)}})(t),S=!1):(S=!0,a(t,L),o.CodeCell.execute(L,e))}},n.open({}),()=>{l=!0}},R=a}}]);