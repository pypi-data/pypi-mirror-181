version: "3"
services:

  api:
    build: .
    ports:
      - 8808:8808
    volumes:
      - ./:/app
    environment:
      # Show print() in logs:
      PYTHONUNBUFFERED: '1'
      DEV_MODE: 'true'
    entrypoint: uvicorn trapi.main:app --host 0.0.0.0 --port 8808 --reload


  tests:
    build: .
    volumes:
      - ./:/app
    environment:
      PYTHONUNBUFFERED: '1'
      DEV_MODE: 'true'
    # entrypoint: pytest --cov=src tests/integration
    # entrypoint:  pytest tests/integration/test_openpredict_api.py -s
    # entrypoint:  pytest tests/integration/test_openpredict_api.py::test_post_trapi -s
    entrypoint:  pytest tests/package/test_decorator.py -s


  workspace:
    image: ghcr.io/maastrichtu-ids/jupyterlab
    ports:
      - 8888:8888
    volumes:
      - ./:/home/jovyan/work
    user: root
    environment:
      - GRANT_SUDO=yes
      ## With password:
      # - JUPYTER_TOKEN=password
