[tox]
envlist = py37,py38,py39,py310,py311,style,coverage,docs,quality
skip_missing_interpreters = True
#indexserver =
#    DEV = https://mypypiserver.org

[testenv]
changedir = tests
deps      = -r{toxinidir}/requirements-dev.txt
setenv    =
    PYTHONPATH={toxinidir}/src
    PYTHONUNBUFFERED=yes
commands  =
    pytest -vv --basetemp={envtmpdir} {posargs}

[testenv:style]
changedir =
deps      = -r{toxinidir}/requirements-dev.txt
setenv    =
    PYTHONPATH={toxinidir}/src
    PYTHONUNBUFFERED=yes
commands  =
    flake8 --max-line-length=120 --ignore=E201,E202,E401,E221,E241,E251,E271,W504,E272 ptutils

[testenv:coverage]
deps      = -r{toxinidir}/requirements-dev.txt
setenv    =
    PYTHONPATH={toxinidir}/src
    PYTHONUNBUFFERED=yes
commands  =
    pytest --cov-config=../.coveragerc --cov=ptutils --cov-report html -vv --basetemp={envtmpdir} {posargs}

[testenv:docs]
changedir =
depends   = coverage
deps      = -r{toxinidir}/requirements-dev.txt
setenv    =
    PYTHONPATH={toxinidir}/src
    PYTHONUNBUFFERED=yes
allowlist_externals = /usr/bin/rm
commands  =
	pip3 freeze
    rm -rf doc/build
    rm -rf doc/source/_autosummary
    python3 setup.py build_sphinx


[testenv:quality]
changedir = tests
depends   = coverage
deps      = -r{toxinidir}/requirements-dev.txt
setenv    =
    PYTHONPATH={toxinidir}/src
    PYTHONUNBUFFERED=yes
commands  =
	radon cc ../src
	radon mi ../src
	radon raw ../src
	xenon -b C -m A -a A ../src

