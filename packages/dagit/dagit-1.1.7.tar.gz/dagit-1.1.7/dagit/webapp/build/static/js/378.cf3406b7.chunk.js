"use strict";(self.webpackChunk_dagster_io_dagit_app=self.webpackChunk_dagster_io_dagit_app||[]).push([[378],{77523:function(e,n,t){t.d(n,{C:function(){return h}});var r=t(19065),i=t(8358),o=t(32030),s=t(75453),a=t(24971),l=t(325),c=t(93141),d=t(76336),u=t(32289),h=function(){var e=l.useContext(d.C5),n=e.allRepos,t=e.visibleRepos,h=e.toggleVisible,p=l.useState(!1),f=(0,r.Z)(p,2),x=f[0],m=f[1];return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(i.Vq,{canOutsideClickClose:!0,canEscapeKeyClose:!0,isOpen:x,style:{width:"auto"},onClose:function(){return m(!1)},children:[(0,u.jsx)(i.fK,{icon:"repo",label:"Filter code locations"}),(0,u.jsx)(c.e,{options:n,onBrowse:function(){return m(!1)},onToggle:h,selected:t}),(0,u.jsx)(i.cN,{children:(0,u.jsx)(o.x,{padding:{top:8},children:(0,u.jsx)(s.zx,{intent:"none",onClick:function(){return m(!1)},children:"Done"})})})]}),(0,u.jsx)(s.zx,{intent:"none",icon:(0,u.jsx)(a.JO,{name:"folder"}),rightIcon:(0,u.jsx)(a.JO,{name:"expand_more"}),onClick:function(){return m(!0)},children:"".concat(t.length," of ").concat(n.length)})]})}},2980:function(e,n,t){t.r(n),t.d(n,{OverviewRoot:function(){return Dn},default:function(){return Un}});var r,i,o,s,a,l,c,d,u,h=t(325),p=t(27601),f=t(99500),x=t(95764),m=t(73701),g=t(3159),v=t(30804),j=t(31112),y=t(12745),w=t(32030),b=t(89646),k=t(60736),C=t(47387),S=t(12436),T=t(19102),E=t(78093),O=t(82348),N=t(31269),I=t(37286),_=t(32289),A=function(e){var n=e.refreshState,t=e.tab;return(0,_.jsxs)(w.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,_.jsxs)(N.mQ,{selectedTabId:t,children:[(0,_.jsx)(I.f,{id:"timeline",title:"Timeline",to:"/overview/timeline"}),(0,_.jsx)(I.f,{id:"jobs",title:"Jobs",to:"/overview/jobs"}),(0,_.jsx)(I.f,{id:"schedules",title:"Schedules",to:"/overview/schedules"}),(0,_.jsx)(I.f,{id:"sensors",title:"Sensors",to:"/overview/sensors"}),(0,_.jsx)(I.f,{id:"backfills",title:"Backfills",to:"/overview/backfills"})]}),n?(0,_.jsx)(w.x,{padding:{bottom:8},children:(0,_.jsx)(T.xi,{refreshState:n})}):null]})},L=t(77892),Z=t(50741),P=t(2789),R=t(78042),z=function(){(0,E.Px)();var e=(0,m.a)(F),n=(0,L.l)({query:M,variables:{},pageSize:10,nextCursorForResult:function(e){var n;return"PartitionBackfills"===e.partitionBackfillsOrError.__typename?null===(n=e.partitionBackfillsOrError.results[9])||void 0===n?void 0:n.backfillId:void 0},getResultArray:function(e){return"PartitionBackfills"===(null===e||void 0===e?void 0:e.partitionBackfillsOrError.__typename)?e.partitionBackfillsOrError.results:[]}}),t=n.queryResult,r=n.paginationProps,i=(0,T.C4)(t,T.dT);return(0,O.j)("Backfills"),(0,_.jsxs)(v.T,{children:[(0,_.jsx)(j.m,{title:(0,_.jsx)(y.X6,{children:"Overview"}),tabs:(0,_.jsx)(A,{tab:"backfills",refreshState:i})}),(0,_.jsx)(Z.g,{queryResult:t,allowStaleData:!0,children:function(n){var i,o=n.partitionBackfillsOrError;if("PythonError"===o.__typename)return(0,_.jsx)(S.T9,{error:o});if(!o.results.length)return(0,_.jsx)(w.x,{padding:{vertical:64},children:(0,_.jsx)(b.t,{icon:"no-results",title:"No backfills found",description:(0,_.jsx)("p",{children:"This instance does not have any backfill jobs."})})});var s=((null===(i=e.data)||void 0===i?void 0:i.instance.daemonHealth.allDaemonStatuses)||[]).filter((function(e){return"BACKFILL"===e.daemonType})).map((function(e){return e.required&&e.healthy})),a=s.length&&s.every((function(e){return e}));return(0,_.jsxs)("div",{children:[a?null:(0,_.jsx)(w.x,{padding:{horizontal:24,vertical:16},children:(0,_.jsx)(k.b,{intent:"warning",title:"The backfill daemon is not running.",description:(0,_.jsxs)("div",{children:["See the"," ",(0,_.jsx)("a",{href:"https://docs.dagster.io/deployment/dagster-daemon",target:"_blank",rel:"noreferrer",children:"dagster-daemon documentation"})," ","for more information on how to deploy the dagster-daemon process."]})})}),(0,_.jsx)(P.G,{backfills:o.results.slice(0,10),refetch:t.refetch}),o.results.length>0?(0,_.jsx)("div",{style:{marginTop:"16px"},children:(0,_.jsx)(C.b$,(0,x.Z)({},r))}):null]})}})]})},F=(0,g.Ps)(r||(r=(0,f.Z)(["\n  query InstanceHealthForBackfillsQuery {\n    instance {\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n"])),R.O),M=(0,g.Ps)(i||(i=(0,f.Z)(["\n  query InstanceBackfillsQuery($cursor: String, $limit: Int) {\n    partitionBackfillsOrError(cursor: $cursor, limit: $limit) {\n      ... on PartitionBackfills {\n        results {\n          backfillId\n          status\n          backfillStatus\n          numRequested\n          numPartitions\n          timestamp\n          partitionSetName\n          partitionSet {\n            id\n            name\n            mode\n            pipelineName\n            repositoryOrigin {\n              id\n              repositoryName\n              repositoryLocationName\n            }\n          }\n          error {\n            ...PythonErrorFragment\n          }\n\n          ...BackfillTableFragment\n        }\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n  ","\n"])),P.b,S.Bq),D=t(47427),U=t(19065),$=t(34595),G=t(7838),K=t(88863),q=t(39061),B=t(77523),W=t(76336),H=t(37099),V=t(33902),J=t(11831),Q=t(54268),Y=t(519),X=t(3580),ee=function(e){var n=new Set,t=new Set;return e.forEach((function(e){n.has(e)?t.add(e):n.add(e)})),t},ne=t(52848),te=t(76314),re=function(e){return Array.isArray(e)?e:[]},ie=function(e,n){var t=function(e,n){return"".concat(e,":dagit.").concat(n)}(h.useContext(ne.I).basePath,e),r=(0,te.U)(t,re),i=(0,U.Z)(r,2),o=i[0],s=i[1],a=h.useCallback((function(e){var n=(0,V.Uz)(e);s((function(e){var t=new Set(e||[]);return t.has(n)?t.delete(n):t.add(n),Array.from(t)}))}),[s]),l=h.useCallback((function(e){s((function(t){var r=new Set(t||[]);return n.forEach((function(n){e?r.delete(n):r.add(n)})),Array.from(r)}))}),[n,s]),c=h.useMemo((function(){var e=new Set(o);return n.filter((function(n){return!e.has(n)}))}),[n,o]);return h.useMemo((function(){return{expandedKeys:c,onToggle:a,onToggleAll:l}}),[c,a,l])},oe=t(82426),se=t(16279),ae="overview-collapsed-state",le=function(e){var n=e.repos,t=h.useRef(null),r=h.useMemo((function(){return n.map((function(e){var n=e.repoAddress;return(0,V.Uz)(n)}))}),[n]),i=ie(ae,r),o=i.expandedKeys,s=i.onToggle,a=i.onToggleAll,l=h.useMemo((function(){var e=[];return n.forEach((function(n){var t=n.repoAddress,r=n.jobs;e.push({type:"header",repoAddress:t,jobCount:r.length});var i=(0,V.Uz)(t);o.includes(i)&&r.forEach((function(n){var r=n.isJob,i=n.name;e.push({type:"job",repoAddress:t,isJob:r,name:i})}))})),e}),[n,o]),c=ee(n.map((function(e){return e.repoAddress.name}))),d=(0,Y.useVirtualizer)({count:l.length,getScrollElement:function(){return t.current},estimateSize:function(e){var n=l[e];return"header"===(null===n||void 0===n?void 0:n.type)?32:64},overscan:10}),u=d.getTotalSize(),p=d.getVirtualItems();return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(oe.I,{}),(0,_.jsx)("div",{style:{overflow:"hidden"},children:(0,_.jsx)(X.W2,{ref:t,children:(0,_.jsx)(X.Nh,{$totalHeight:u,children:p.map((function(e){var n=e.index,t=e.key,r=e.size,i=e.start,d=l[n];return"header"===d.type?(0,_.jsx)(se.vG,{repoAddress:d.repoAddress,height:r,start:i,onToggle:s,onToggleAll:a,expanded:o.includes((0,V.Uz)(d.repoAddress)),showLocation:c.has(d.repoAddress.name),rightElement:(0,_.jsx)(J.u,{content:1===d.jobCount?"1 job":"".concat(d.jobCount," jobs"),placement:"top",children:(0,_.jsx)(Q.V,{children:d.jobCount})})},t):(0,_.jsx)(oe.b,{name:d.name,isJob:d.isJob,repoAddress:d.repoAddress,height:r,start:i},t)}))})})})]})},ce=t(59019),de=function(e){return(0,ce.Z)(e).sort((function(e,n){var t=(0,V.Uz)(e.repoAddress),r=(0,V.Uz)(n.repoAddress);return t.localeCompare(r)}))},ue=function(e){return new Set(e.map((function(e){return(0,V.Uz)((0,H.kQ)(e.repository.name,e.repositoryLocation.name))})))},he=function(){(0,E.Px)();var e=h.useState(""),n=(0,U.Z)(e,2),t=n[0],r=n[1],i=h.useContext(W.C5),o=i.allRepos,s=i.visibleRepos,a=o.length,l=(0,m.a)(fe,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),c=l.data,d=l.loading,u=(0,T.C4)(l,T.dT),p=h.useMemo((function(){var e=ue(s);return pe(c).filter((function(n){var t=n.repoAddress;return e.has((0,V.Uz)(t))}))}),[c,s]),f=t.trim().toLocaleLowerCase(),x=f.length>0,g=h.useMemo((function(){var e=f.toLocaleLowerCase();return p.map((function(n){return{repoAddress:n.repoAddress,jobs:n.jobs.filter((function(n){return n.name.toLocaleLowerCase().includes(e)}))}})).filter((function(e){return e.jobs.length>0}))}),[p,f]);return(0,_.jsxs)(w.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,_.jsx)(j.m,{title:(0,_.jsx)(y.X6,{children:"Overview"}),tabs:(0,_.jsx)(A,{tab:"jobs",refreshState:u})}),(0,_.jsxs)(w.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",gap:12,grow:0},children:[a>1?(0,_.jsx)(B.C,{}):null,(0,_.jsx)(K.oi,{icon:"search",value:t,onChange:function(e){return r(e.target.value)},placeholder:"Filter by job name\u2026",style:{width:"340px"}})]}),d&&!a?(0,_.jsx)(w.x,{padding:64,children:(0,_.jsx)($.$,{purpose:"page"})}):function(){if(d&&!c)return(0,_.jsx)(w.x,{flex:{direction:"row",justifyContent:"center"},style:{paddingTop:"100px"},children:(0,_.jsxs)(w.x,{flex:{direction:"row",alignItems:"center",gap:16},children:[(0,_.jsx)($.$,{purpose:"body-text"}),(0,_.jsx)("div",{style:{color:G.w.Gray600},children:"Loading jobs\u2026"})]})});var e=o.length>s.length;return g.length?(0,_.jsx)(le,{repos:g}):x?(0,_.jsx)(w.x,{padding:{top:20},children:(0,_.jsx)(b.t,{icon:"search",title:"No matching jobs",description:e?(0,_.jsxs)("div",{children:["No jobs matching ",(0,_.jsx)("strong",{children:t})," were found in the selected code locations"]}):(0,_.jsxs)("div",{children:["No jobs matching ",(0,_.jsx)("strong",{children:t})," were found in your definitions"]})})}):(0,_.jsx)(w.x,{padding:{top:20},children:(0,_.jsx)(b.t,{icon:"search",title:"No jobs",description:e?"No jobs were found in the selected code locations":"No jobs were found in your definitions"})})}()]})},pe=function(e){if("Workspace"!==(null===e||void 0===e?void 0:e.workspaceOrError.__typename))return[];var n,t=e.workspaceOrError.locationEntries.map((function(e){return e.locationOrLoadError})),r=[],i=(0,D.Z)(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if("RepositoryLocation"===(null===o||void 0===o?void 0:o.__typename)){var s,a=(0,D.Z)(o.repositories);try{for(a.s();!(s=a.n()).done;){var l=s.value,c=l.name,d=l.pipelines,u=(0,H.kQ)(c,o.name),h=d.filter((function(e){var n=e.name;return!(0,q.pv)(n)})).map((function(e){return{isJob:e.isJob,name:e.name}}));h.length>0&&r.push({repoAddress:u,jobs:h})}}catch(p){a.e(p)}finally{a.f()}}}}catch(p){i.e(p)}finally{i.f()}return de(r)},fe=(0,g.Ps)(o||(o=(0,f.Z)(["\n  query OverviewJobsQuery {\n    workspaceOrError {\n      ... on Workspace {\n        locationEntries {\n          id\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                pipelines {\n                  id\n                  name\n                  isJob\n                }\n              }\n            }\n            ...PythonErrorFragment\n          }\n        }\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n"])),S.Bq),xe=t(75453),me=t(8358),ge=t(45352),ve=t(56313),je=t(89324),ye=t(31834),we=function(e){var n=e.repos,t=h.useRef(null),r=h.useMemo((function(){return n.map((function(e){var n=e.repoAddress;return(0,V.Uz)(n)}))}),[n]),i=ie(ae,r),o=i.expandedKeys,s=i.onToggle,a=i.onToggleAll,l=h.useMemo((function(){var e=[];return n.forEach((function(n){var t=n.repoAddress,r=n.schedules;e.push({type:"header",repoAddress:t,scheduleCount:r.length});var i=(0,V.Uz)(t);o.includes(i)&&r.forEach((function(n){e.push({type:"schedule",repoAddress:t,name:n})}))})),e}),[n,o]),c=ee(n.map((function(e){return e.repoAddress.name}))),d=(0,Y.useVirtualizer)({count:l.length,getScrollElement:function(){return t.current},estimateSize:function(e){var n=l[e];return"header"===(null===n||void 0===n?void 0:n.type)?32:64},overscan:10}),u=d.getTotalSize(),p=d.getVirtualItems();return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(ye.o,{}),(0,_.jsx)("div",{style:{overflow:"hidden"},children:(0,_.jsx)(X.W2,{ref:t,children:(0,_.jsx)(X.Nh,{$totalHeight:u,children:p.map((function(e){var n=e.index,t=e.key,r=e.size,i=e.start,d=l[n];return"header"===d.type?(0,_.jsx)(se.vG,{repoAddress:d.repoAddress,height:r,start:i,onToggle:s,onToggleAll:a,expanded:o.includes((0,V.Uz)(d.repoAddress)),showLocation:c.has(d.repoAddress.name),rightElement:(0,_.jsx)(J.u,{content:1===d.scheduleCount?"1 schedule":"".concat(d.scheduleCount," schedules"),placement:"top",children:(0,_.jsx)(Q.V,{children:d.scheduleCount})})},t):(0,_.jsx)(ye.i,{name:d.name,repoAddress:d.repoAddress,height:r,start:i},t)}))})})})]})},be=function(){(0,E.Px)();var e=h.useState(""),n=(0,U.Z)(e,2),t=n[0],r=n[1],i=h.useContext(W.C5),o=i.allRepos,s=i.visibleRepos,a=o.length,l=(0,m.a)(Te,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),c=l.data,d=l.loading,u=(0,T.C4)(l,T.dT),p=h.useMemo((function(){var e=ue(s);return Se(c).filter((function(n){var t=n.repoAddress;return e.has((0,V.Uz)(t))}))}),[c,s]),f=t.trim().toLocaleLowerCase(),x=f.length>0,g=h.useMemo((function(){var e=f.toLocaleLowerCase();return p.map((function(n){return{repoAddress:n.repoAddress,schedules:n.schedules.filter((function(n){return n.toLocaleLowerCase().includes(e)}))}})).filter((function(e){return e.schedules.length>0}))}),[p,f]);return(0,_.jsxs)(w.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,_.jsx)(j.m,{title:(0,_.jsx)(y.X6,{children:"Overview"}),tabs:(0,_.jsx)(A,{tab:"schedules",refreshState:u})}),(0,_.jsxs)(w.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",gap:12,grow:0},children:[a>0?(0,_.jsx)(B.C,{}):null,(0,_.jsx)(K.oi,{icon:"search",value:t,onChange:function(e){return r(e.target.value)},placeholder:"Filter by schedule name\u2026",style:{width:"340px"}})]}),d&&!a?(0,_.jsx)(w.x,{padding:64,children:(0,_.jsx)($.$,{purpose:"page"})}):(0,_.jsxs)(_.Fragment,{children:["InstigationStates"===(null===c||void 0===c?void 0:c.unloadableInstigationStatesOrError.__typename)?(0,_.jsx)(ke,{count:c.unloadableInstigationStatesOrError.results.length}):null,(0,_.jsx)(w.x,{padding:{vertical:16,horizontal:24},border:{side:"top",width:1,color:G.w.KeylineGray},children:(0,_.jsx)(je.K,{daemonHealth:null===c||void 0===c?void 0:c.instance.daemonHealth})}),function(){if(d&&!c)return(0,_.jsx)(w.x,{flex:{direction:"row",justifyContent:"center"},style:{paddingTop:"100px"},children:(0,_.jsxs)(w.x,{flex:{direction:"row",alignItems:"center",gap:16},children:[(0,_.jsx)($.$,{purpose:"body-text"}),(0,_.jsx)("div",{style:{color:G.w.Gray600},children:"Loading schedules\u2026"})]})});var e=o.length>s.length;return g.length?(0,_.jsx)(we,{repos:g}):x?(0,_.jsx)(w.x,{padding:{top:20},children:(0,_.jsx)(b.t,{icon:"search",title:"No matching schedules",description:e?(0,_.jsxs)("div",{children:["No schedules matching ",(0,_.jsx)("strong",{children:t})," were found in the selected code locations"]}):(0,_.jsxs)("div",{children:["No schedules matching ",(0,_.jsx)("strong",{children:t})," were found in your definitions"]})})}):(0,_.jsx)(w.x,{padding:{top:20},children:(0,_.jsx)(b.t,{icon:"search",title:"No schedules",description:e?"No schedules were found in the selected code locations":"No schedules were found in your definitions"})})}()]})]})},ke=function(e){var n=e.count,t=h.useState(!1),r=(0,U.Z)(t,2),i=r[0],o=r[1];if(!n)return null;var s=1===n?"1 unloadable schedule":"".concat(n," unloadable schedules");return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(w.x,{padding:{vertical:16,horizontal:24},border:{side:"top",width:1,color:G.w.KeylineGray},children:(0,_.jsx)(k.b,{intent:"warning",title:s,description:(0,_.jsxs)(w.x,{flex:{direction:"column",gap:12,alignItems:"flex-start"},children:[(0,_.jsx)("div",{children:"Schedules were previously started but now cannot be loaded. They may be part of a code locations that no longer exist. You can turn them off, but you cannot turn them back on."}),(0,_.jsx)(xe.zx,{onClick:function(){return o(!0)},children:1===n?"View unloadable schedule":"View unloadable schedules"})]})})}),(0,_.jsxs)(me.Vq,{isOpen:i,title:"Unloadable schedules",style:{width:"90vw",maxWidth:"1200px"},children:[(0,_.jsx)(w.x,{padding:{bottom:8},children:(0,_.jsx)(Ce,{})}),(0,_.jsx)(me.cN,{children:(0,_.jsx)(xe.zx,{intent:"primary",onClick:function(){return o(!1)},children:"Done"})})]})]})},Ce=function(){var e=(0,m.a)(Ee).data;return e?"InstigationStates"===(null===e||void 0===e?void 0:e.unloadableInstigationStatesOrError.__typename)?(0,_.jsx)(ve.Y,{scheduleStates:e.unloadableInstigationStatesOrError.results,showSubheading:!1}):(0,_.jsx)(S.T9,{error:null===e||void 0===e?void 0:e.unloadableInstigationStatesOrError}):(0,_.jsx)($.$,{purpose:"section"})},Se=function(e){if("Workspace"!==(null===e||void 0===e?void 0:e.workspaceOrError.__typename))return[];var n,t=e.workspaceOrError.locationEntries.map((function(e){return e.locationOrLoadError})),r=[],i=(0,D.Z)(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if("RepositoryLocation"===(null===o||void 0===o?void 0:o.__typename)){var s,a=(0,D.Z)(o.repositories);try{for(a.s();!(s=a.n()).done;){var l=s.value,c=l.name,d=l.schedules,u=(0,H.kQ)(c,o.name),h=d.map((function(e){return e.name}));h.length>0&&r.push({repoAddress:u,schedules:h})}}catch(p){a.e(p)}finally{a.f()}}}}catch(p){i.e(p)}finally{i.f()}return de(r)},Te=(0,g.Ps)(s||(s=(0,f.Z)(["\n  query OverviewSchedulesQuery {\n    workspaceOrError {\n      ... on Workspace {\n        locationEntries {\n          id\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                schedules {\n                  id\n                  name\n                  description\n                }\n              }\n            }\n            ...PythonErrorFragment\n          }\n        }\n      }\n      ...PythonErrorFragment\n    }\n    unloadableInstigationStatesOrError(instigationType: SCHEDULE) {\n      ... on InstigationStates {\n        results {\n          id\n        }\n      }\n    }\n    instance {\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n  ","\n"])),S.Bq,R.O),Ee=(0,g.Ps)(a||(a=(0,f.Z)(["\n  query UnloadableSchedulesQuery {\n    unloadableInstigationStatesOrError(instigationType: SCHEDULE) {\n      ... on InstigationStates {\n        results {\n          id\n          ...InstigationStateFragment\n        }\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n  ","\n"])),ge.ai,S.Bq),Oe=t(57466),Ne=t(19377),Ie=function(e){var n=e.repos,t=h.useRef(null),r=h.useMemo((function(){return n.map((function(e){var n=e.repoAddress;return(0,V.Uz)(n)}))}),[n]),i=ie(ae,r),o=i.expandedKeys,s=i.onToggle,a=i.onToggleAll,l=h.useMemo((function(){var e=[];return n.forEach((function(n){var t=n.repoAddress,r=n.sensors;e.push({type:"header",repoAddress:t,sensorCount:r.length});var i=(0,V.Uz)(t);o.includes(i)&&r.forEach((function(n){e.push({type:"sensor",repoAddress:t,name:n})}))})),e}),[n,o]),c=ee(n.map((function(e){return e.repoAddress.name}))),d=(0,Y.useVirtualizer)({count:l.length,getScrollElement:function(){return t.current},estimateSize:function(e){var n=l[e];return"header"===(null===n||void 0===n?void 0:n.type)?32:64},overscan:10}),u=d.getTotalSize(),p=d.getVirtualItems();return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(Ne.K,{}),(0,_.jsx)("div",{style:{overflow:"hidden"},children:(0,_.jsx)(X.W2,{ref:t,children:(0,_.jsx)(X.Nh,{$totalHeight:u,children:p.map((function(e){var n=e.index,t=e.key,r=e.size,i=e.start,d=l[n];return"header"===d.type?(0,_.jsx)(se.vG,{repoAddress:d.repoAddress,height:r,start:i,onToggle:s,onToggleAll:a,expanded:o.includes((0,V.Uz)(d.repoAddress)),showLocation:c.has(d.repoAddress.name),rightElement:(0,_.jsx)(J.u,{content:1===d.sensorCount?"1 sensor":"".concat(d.sensorCount," sensors"),placement:"top",children:(0,_.jsx)(Q.V,{children:d.sensorCount})})},t):(0,_.jsx)(Ne.R,{name:d.name,repoAddress:d.repoAddress,height:r,start:i},t)}))})})})]})},_e=function(){(0,E.Px)();var e=h.useState(""),n=(0,U.Z)(e,2),t=n[0],r=n[1],i=h.useContext(W.C5),o=i.allRepos,s=i.visibleRepos,a=o.length,l=(0,m.a)(Pe,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),c=l.data,d=l.loading,u=(0,T.C4)(l,T.dT),p=h.useMemo((function(){var e=ue(s);return Ze(c).filter((function(n){var t=n.repoAddress;return e.has((0,V.Uz)(t))}))}),[c,s]),f=t.trim().toLocaleLowerCase(),x=f.length>0,g=h.useMemo((function(){var e=f.toLocaleLowerCase();return p.map((function(n){return{repoAddress:n.repoAddress,sensors:n.sensors.filter((function(n){return n.toLocaleLowerCase().includes(e)}))}})).filter((function(e){return e.sensors.length>0}))}),[p,f]);return(0,_.jsxs)(w.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,_.jsx)(j.m,{title:(0,_.jsx)(y.X6,{children:"Overview"}),tabs:(0,_.jsx)(A,{tab:"sensors",refreshState:u})}),(0,_.jsxs)(w.x,{padding:{horizontal:24,vertical:16},flex:{direction:"row",alignItems:"center",gap:12,grow:0},children:[a>0?(0,_.jsx)(B.C,{}):null,(0,_.jsx)(K.oi,{icon:"search",value:t,onChange:function(e){return r(e.target.value)},placeholder:"Filter by sensor name\u2026",style:{width:"340px"}})]}),d&&!a?(0,_.jsx)(w.x,{padding:64,children:(0,_.jsx)($.$,{purpose:"page"})}):(0,_.jsxs)(_.Fragment,{children:["InstigationStates"===(null===c||void 0===c?void 0:c.unloadableInstigationStatesOrError.__typename)?(0,_.jsx)(Ae,{count:c.unloadableInstigationStatesOrError.results.length}):null,(0,_.jsx)(Oe.F,{daemonHealth:null===c||void 0===c?void 0:c.instance.daemonHealth,padding:{vertical:16,horizontal:24},border:{side:"top",width:1,color:G.w.KeylineGray}}),function(){if(d&&!c)return(0,_.jsx)(w.x,{flex:{direction:"row",justifyContent:"center"},style:{paddingTop:"100px"},children:(0,_.jsxs)(w.x,{flex:{direction:"row",alignItems:"center",gap:16},children:[(0,_.jsx)($.$,{purpose:"body-text"}),(0,_.jsx)("div",{style:{color:G.w.Gray600},children:"Loading sensors\u2026"})]})});var e=o.length>s.length;return g.length?(0,_.jsx)(Ie,{repos:g}):x?(0,_.jsx)(w.x,{padding:{top:20},children:(0,_.jsx)(b.t,{icon:"search",title:"No matching sensors",description:e?(0,_.jsxs)("div",{children:["No sensors matching ",(0,_.jsx)("strong",{children:t})," were found in the selected code locations"]}):(0,_.jsxs)("div",{children:["No sensors matching ",(0,_.jsx)("strong",{children:t})," were found in your definitions"]})})}):(0,_.jsx)(w.x,{padding:{top:20},children:(0,_.jsx)(b.t,{icon:"search",title:"No sensors",description:e?"No sensors were found in the selected code locations":"No sensors were found in your definitions"})})}()]})]})},Ae=function(e){var n=e.count,t=h.useState(!1),r=(0,U.Z)(t,2),i=r[0],o=r[1];if(!n)return null;var s=1===n?"1 unloadable sensor":"".concat(n," unloadable sensors");return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(w.x,{padding:{vertical:16,horizontal:24},border:{side:"top",width:1,color:G.w.KeylineGray},children:(0,_.jsx)(k.b,{intent:"warning",title:s,description:(0,_.jsxs)(w.x,{flex:{direction:"column",gap:12,alignItems:"flex-start"},children:[(0,_.jsx)("div",{children:"Sensors were previously started but now cannot be loaded. They may be part of a code location that no longer exists. You can turn them off, but you cannot turn them back on."}),(0,_.jsx)(xe.zx,{onClick:function(){return o(!0)},children:1===n?"View unloadable sensor":"View unloadable sensors"})]})})}),(0,_.jsxs)(me.Vq,{isOpen:i,title:"Unloadable schedules",style:{width:"90vw",maxWidth:"1200px"},children:[(0,_.jsx)(w.x,{padding:{bottom:8},children:(0,_.jsx)(Le,{})}),(0,_.jsx)(me.cN,{children:(0,_.jsx)(xe.zx,{intent:"primary",onClick:function(){return o(!1)},children:"Done"})})]})]})},Le=function(){var e=(0,m.a)(Re).data;return e?"InstigationStates"===(null===e||void 0===e?void 0:e.unloadableInstigationStatesOrError.__typename)?(0,_.jsx)(ve.e,{sensorStates:e.unloadableInstigationStatesOrError.results,showSubheading:!1}):(0,_.jsx)(S.T9,{error:null===e||void 0===e?void 0:e.unloadableInstigationStatesOrError}):(0,_.jsx)($.$,{purpose:"section"})},Ze=function(e){if("Workspace"!==(null===e||void 0===e?void 0:e.workspaceOrError.__typename))return[];var n,t=e.workspaceOrError.locationEntries.map((function(e){return e.locationOrLoadError})),r=[],i=(0,D.Z)(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if("RepositoryLocation"===(null===o||void 0===o?void 0:o.__typename)){var s,a=(0,D.Z)(o.repositories);try{for(a.s();!(s=a.n()).done;){var l=s.value,c=l.name,d=l.sensors,u=(0,H.kQ)(c,o.name),h=d.map((function(e){return e.name}));h.length>0&&r.push({repoAddress:u,sensors:h})}}catch(p){a.e(p)}finally{a.f()}}}}catch(p){i.e(p)}finally{i.f()}return de(r)},Pe=(0,g.Ps)(l||(l=(0,f.Z)(["\n  query OverviewSensorsQuery {\n    workspaceOrError {\n      ... on Workspace {\n        locationEntries {\n          id\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                sensors {\n                  id\n                  name\n                  description\n                }\n              }\n            }\n            ...PythonErrorFragment\n          }\n        }\n      }\n      ...PythonErrorFragment\n    }\n    unloadableInstigationStatesOrError(instigationType: SENSOR) {\n      ... on InstigationStates {\n        results {\n          id\n        }\n      }\n    }\n    instance {\n      ...InstanceHealthFragment\n    }\n  }\n\n  ","\n  ","\n"])),S.Bq,R.O),Re=(0,g.Ps)(c||(c=(0,f.Z)(["\n  query UnloadableSensorsQuery {\n    unloadableInstigationStatesOrError(instigationType: SENSOR) {\n      ... on InstigationStates {\n        results {\n          id\n          ...InstigationStateFragment\n        }\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n  ","\n"])),ge.ai,S.Bq),ze=t(87011),Fe=t(16798),Me=t(922),De=t(8546),Ue=t(24971),$e=t(14198),Ge=t(762),Ke=t(55690),qe=t.n(Ke),Be=t(74549),We=t(37971),He=t(7489),Ve=t(68156),Je=t(28797),Qe=t(36114),Ye=t(35815),Xe=t(59549),en=t(34653),nn=t(32460),tn=function(e,n){return!(e.end<n.start||n.end<e.start)},rn=function(e,n,t,r){var i=e.left,o=e.left+Math.max(e.width,t),s=n.left,a=n.left+Math.max(n.width,t),l=Math.min(e.left,n.left),c=Math.max(e.left+Math.max(e.width,t),n.left+Math.max(n.width,t));return tn({start:i,end:o},{start:s,end:a})&&(l>r||c<r)},on=function(e){switch(e){case"queued":case"scheduled":return G.w.Blue200;case"inProgress":return G.w.Blue500;case"failed":return G.w.Red500;case"succeeded":return G.w.Green500}},sn=function(e){var n={scheduled:0,queued:0,inProgress:0,failed:0,succeeded:0};e.forEach((function(e){var t=e.status;"SCHEDULED"===t?n.scheduled++:en.sy.has(t)?n.queued++:en.Ys.has(t)?n.inProgress++:en.hd.has(t)?n.failed++:en._m.has(t)&&n.succeeded++}));var t=Object.keys(n).filter((function(e){return n[e]>0}));if(1===t.length){var r=(0,U.Z)(t,1)[0];return on(r)}for(var i=e.length,o=[n.failed>0?{status:"failed",pct:100*n.failed/i}:null,n.succeeded>0?{status:"succeeded",pct:100*n.succeeded/i}:null,n.inProgress>0?{status:"inProgress",pct:100*n.inProgress/i}:null,n.queued>0?{status:"queued",pct:100*n.queued/i}:null,n.scheduled>0?{status:"scheduled",pct:100*n.scheduled/i}:null].filter(Boolean),s="",a=0,l=0,c=0;c<o.length;c++){var d=o[c];if(d){var u=d.status,h=d.pct;l=a,a+=h;var p=on(u);0===c?s+="".concat(p," ").concat(h.toFixed(1),"%, "):c===o.length-1?s+="".concat(p," ").concat(l.toFixed(1),"%"):s+="".concat(p," ").concat(l.toFixed(1),"% ").concat(a.toFixed(1),"%, ")}}return"linear-gradient(to right, ".concat(s,")")},an=32,ln=function(e){var n=e.loading,t=void 0!==n&&n,r=e.jobs,i=e.range,o=h.useState(null),s=(0,U.Z)(o,2),a=s[0],l=s[1],c=Date.now(),d=(0,U.Z)(i,2),u=(d[0],c<=d[1]),p=r.reduce((function(e,n){var t=n.repoAddress,r=(0,V.Qj)(t),i=e[r]||[];return(0,x.Z)((0,x.Z)({},e),{},(0,Fe.Z)({},r,[].concat((0,ce.Z)(i),[n])))}),{}),f=Object.keys(p),m=ie(ae,f),g=m.expandedKeys,v=m.onToggle,j=m.onToggleAll,y=h.useRef(null),b=h.useCallback((function(e){var n;e?(y.current=new ResizeObserver((function(e){var n=e[0];l(n.contentRect.width)})),y.current.observe(e)):null===(n=y.current)||void 0===n||n.disconnect()}),[]);if(!a)return(0,_.jsx)(kn,{$height:174,ref:b,children:(0,_.jsx)("div",{})});var k=Object.keys(p).sort((function(e,n){return e.localeCompare(n)})),C=64,S=k.filter((function(e){return g.includes(e)})).reduce((function(e,n){return e+p[n].length}),0),T=k.length*Ye.l+an*S,E=ee(k.map((function(e){var n;return(null===(n=(0,Qe.g)(e))||void 0===n?void 0:n.name)||""}))),O=k.length>0,N=64+(O?T:110);return(0,_.jsxs)(kn,{$height:N,ref:b,children:[(0,_.jsx)(w.x,{padding:{left:24},flex:{direction:"column",justifyContent:"center"},style:{fontSize:"16px",height:64},border:{side:"top",width:1,color:G.w.KeylineGray},children:"Jobs"}),(0,_.jsx)(pn,{interval:36e5,range:i,height:O?T:0}),k.length?k.map((function(e){var n,t=null===(n=(0,Qe.g)(e))||void 0===n?void 0:n.name,r=p[e],o=C,s=g.includes(e);return C=o+Ye.l+(s?r.length*an:0),(0,_.jsx)(cn,{expanded:s,range:i,top:o,repoKey:e,isDuplicateRepoName:!(!t||!E.has(t)),jobs:p[e],onToggle:v,onToggleAll:j,width:a},e)})):(0,_.jsx)(bn,{loading:t,includesTicks:u})]})},cn=function(e){var n=e.expanded,t=e.onToggle,r=e.onToggleAll,i=e.repoKey,o=e.isDuplicateRepoName,s=e.jobs,a=e.range,l=e.top,c=e.width,d=(0,Qe.g)(i),u=(null===d||void 0===d?void 0:d.name)||"Unknown repo",p=(null===d||void 0===d?void 0:d.location)||"Unknown location",f=h.useCallback((function(e){e.getModifierState("Shift")?r(!n):d&&t(d)}),[n,t,r,d]);return(0,_.jsxs)("div",{children:[(0,_.jsx)(hn,{$top:l,children:(0,_.jsx)(Ye.L,{expanded:n,repoName:u,repoLocation:p,onClick:f,showLocation:o,rightElement:(0,_.jsx)(dn,{jobs:s})})}),n?s.map((function(e,n){return(0,_.jsx)(wn,{job:e,top:l+Ye.l+n*an,range:a,width:c},e.key)})):null]})},dn=h.memo((function(e){var n=e.jobs,t=h.useMemo((function(){var e=0,t=0,r=0;return n.forEach((function(n){n.runs.forEach((function(n){var i=n.status;"SCHEDULED"!==i&&(en.Ys.has(i)?e++:en.hd.has(i)?t++:en._m.has(i)&&r++)}))})),{inProgressCount:e,failedCount:t,succeededCount:r}}),[n]),r=t.inProgressCount,i=t.failedCount,o=t.succeededCount,s=1===r?"1 run in progress":"".concat(r," runs in progress"),a=1===o?"1 run succeeded":"".concat(o," runs succeeded"),l=1===i?"1 run failed":"".concat(i," runs failed");return(0,_.jsxs)(w.x,{flex:{direction:"row",gap:4,alignItems:"center"},children:[r>0?(0,_.jsx)(J.u,{content:(0,_.jsx)(un,{children:s}),placement:"top",children:(0,_.jsx)(Q.V,{intent:"primary",children:r})}):null,o>0?(0,_.jsx)(J.u,{content:(0,_.jsx)(un,{children:a}),placement:"top",children:(0,_.jsx)(Q.V,{intent:"success",children:o})}):null,i>0?(0,_.jsx)(J.u,{content:(0,_.jsx)(un,{children:l}),placement:"top",children:(0,_.jsx)(Q.V,{intent:"danger",children:i})}):null]})})),un=Me.ZP.span.withConfig({displayName:"RunTimeline__StatusSpan",componentId:"sc-1k6kbha-0"})(["white-space:nowrap;"]),hn=Me.ZP.div.withConfig({displayName:"RunTimeline__SectionHeaderContainer",componentId:"sc-1k6kbha-1"})(["position:absolute;top:0;left:0;right:0;",""],(function(e){var n=e.$top;return"transform: translateY(".concat(n,"px);")})),pn=function(e){var n=e.interval,t=e.range,r=e.height,i=(0,U.Z)(t,2),o=i[0],s=i[1],a=navigator.language,l=h.useContext(We.j),c=(0,U.Z)(l,1)[0],d="Automatic"===c?(0,He.cw)():c,u=h.useMemo((function(){return new Intl.DateTimeFormat(a,{month:"numeric",day:"numeric",year:"numeric",timeZone:d})}),[a,d]),p=h.useMemo((function(){return new Intl.DateTimeFormat(a,{hour:"numeric",timeZone:d})}),[a,d]),f=h.useMemo((function(){for(var e=s-o,n=[],t=qe().tz(o,d).startOf("day");t.valueOf()<s;){var r=t.valueOf();t.add(1,"day");var i=t.valueOf();n.push({dayStart:r,dayEnd:i})}return n.map((function(n){var t=n.dayStart,r=n.dayEnd,i=new Date(t),s=t-o,a=s+(r-t),l=Math.max(0,s/e*100),c=Math.min(100,a/e*100);return{label:u.format(i),key:i.toString(),left:l,width:c-l}}))}),[u,s,o,d]),x=h.useMemo((function(){var e=s-o,t=o-o%n,r=Math.ceil(e/n)+1;return(0,ce.Z)(new Array(r)).map((function(r,i){var s=t+i*n,a=new Date(s);return{label:p.format(a).replace(" ",""),key:a.toString(),left:(s-o)/e*100}})).filter((function(e){return e.left>0}))}),[s,o,n,p]),m=Date.now(),g="".concat(((m-o)/(s-o)*100).toPrecision(3),"%");return(0,_.jsxs)(fn,{style:{height:"".concat(r,"px")},children:[(0,_.jsx)(xn,{children:f.map((function(e){return(0,_.jsx)(mn,{style:{left:"".concat(e.left.toPrecision(3),"%"),width:"".concat(e.width.toPrecision(3),"%")},children:e.width>10?(0,_.jsx)(w.x,{flex:{justifyContent:"center"},children:e.label}):null},e.key)}))}),(0,_.jsx)(xn,{children:x.map((function(e){return(0,_.jsx)(gn,{style:{left:"".concat(e.left.toPrecision(3),"%")},children:e.label},e.key)}))}),(0,_.jsxs)(vn,{children:[(0,_.jsx)(jn,{style:{left:0,backgroundColor:G.w.Gray200}}),x.map((function(e){return(0,_.jsx)(jn,{style:{left:"".concat(e.left.toPrecision(3),"%")}},e.key)})),m>=o&&m<=s?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(yn,{style:{left:g},children:"Now"}),(0,_.jsx)(jn,{style:{left:g,backgroundColor:G.w.Blue500,zIndex:1}})]}):null]})]})},fn=Me.ZP.div.withConfig({displayName:"RunTimeline__DividerContainer",componentId:"sc-1k6kbha-2"})(["position:absolute;top:0;left:","px;right:0;font-family:",";color:",";"],320,De.b.monospace,G.w.Gray800),xn=Me.ZP.div.withConfig({displayName:"RunTimeline__DividerLabels",componentId:"sc-1k6kbha-3"})(["display:flex;align-items:center;box-shadow:inset 1px 0 0 ",",inset 0 1px 0 ",",inset -1px 0 0 ",";height:","px;position:relative;user-select:none;font-size:12px;width:100%;overflow:hidden;"],G.w.KeylineGray,G.w.KeylineGray,G.w.KeylineGray,32),mn=Me.ZP.div.withConfig({displayName:"RunTimeline__DateLabel",componentId:"sc-1k6kbha-4"})(["position:absolute;padding:8px 0;box-shadow:inset 1px 0 0 ",";white-space:nowrap;"],G.w.KeylineGray),gn=Me.ZP.div.withConfig({displayName:"RunTimeline__TimeLabel",componentId:"sc-1k6kbha-5"})(["position:absolute;padding:8px;box-shadow:inset 1px 0 0 ",";white-space:nowrap;"],G.w.KeylineGray),vn=Me.ZP.div.withConfig({displayName:"RunTimeline__DividerLines",componentId:"sc-1k6kbha-6"})(["height:100%;position:relative;width:100%;box-shadow:inset 1px 0 0 ",",inset -1px 0 0 ",";"],G.w.KeylineGray,G.w.KeylineGray),jn=Me.ZP.div.withConfig({displayName:"RunTimeline__DividerLine",componentId:"sc-1k6kbha-7"})(["background-color:",";height:100%;position:absolute;top:0;width:1px;"],G.w.KeylineGray),yn=Me.ZP.div.withConfig({displayName:"RunTimeline__NowMarker",componentId:"sc-1k6kbha-8"})(["background-color:",";border-radius:1px;color:",";cursor:default;font-size:12px;line-height:12px;margin-left:-12px;padding:1px 4px;position:absolute;top:-14px;user-select:none;"],G.w.Blue500,G.w.White),wn=function(e){var n=e.job,t=e.top,r=e.range,i=e.width,o=(0,U.Z)(r,2),s=o[0],a=o[1],l=i-320,c=n.runs,d=h.useMemo((function(){var e=function(e){for(var n=e.runs,t=e.start,r=e.end,i=e.width,o=e.minChunkWidth,s=e.minMultipleWidth,a=r-t,l=(Date.now()-t)/(r-t)*i,c=n.map((function(e){var n=e.startTime,r=e.endTime||Date.now();return{runs:[e],startTime:n,endTime:r,left:Math.max(0,Math.floor((n-t)/a*i)),width:Math.max(o,Math.min(Math.ceil((r-n)/a*i),Math.ceil((r-t)/a*i)))}})).sort((function(e,n){return n.left-e.left})),d=[];c.length;){var u=c.shift(),h=c[0];if(u)if(h&&rn(u,h,s,l)){c.shift(),u.runs=[].concat((0,ce.Z)(u.runs),(0,ce.Z)(h.runs)),u.startTime=Math.min(u.startTime,h.startTime),u.endTime=Math.max(u.endTime,h.endTime);var p=Math.max(u.left+s,u.left+u.width,h.left+h.width),f=Math.min(u.left,h.left);u.width=p-f,u.left=f,c.unshift(u)}else d.push(u)}return d}({runs:c,start:s,end:a,width:l,minChunkWidth:2,minMultipleWidth:12});return e}),[c,s,a,l]);return n.runs.length?(0,_.jsxs)(Cn,{$top:t,children:[(0,_.jsxs)(Sn,{children:[(0,_.jsx)(Ue.JO,{name:"asset"===n.jobType?"asset":"job"}),(0,_.jsx)("div",{style:{width:268},children:"asset"===n.jobType?(0,_.jsx)("span",{style:{color:G.w.Gray900},children:(0,_.jsx)($e.g,{text:n.jobName})}):(0,_.jsx)(Be.rU,{to:n.path,children:(0,_.jsx)($e.g,{text:n.jobName})})})]}),(0,_.jsx)(Tn,{children:d.map((function(e){var t=e.left,r=e.width,i=e.runs.length;return(0,_.jsx)(En,{$background:sn(e.runs),$multiple:i>1,style:{left:"".concat(t,"px"),width:"".concat(r,"px")},children:(0,_.jsx)(Ge.J,{content:(0,_.jsx)(Nn,{job:n,batch:e}),position:"top",interactionKind:"hover",className:"chunk-popover-target",children:(0,_.jsx)(w.x,{flex:{direction:"row",justifyContent:"center",alignItems:"center"},style:{height:"100%"},children:i>1?(0,_.jsx)(On,{children:e.runs.length}):null})})},e.runs[0].id)}))})]}):null},bn=function(e){var n=e.loading,t=e.includesTicks;return(0,_.jsx)(w.x,{background:G.w.White,padding:{vertical:24},flex:{direction:"row",justifyContent:"center"},border:{side:"horizontal",width:1,color:G.w.KeylineGray},children:n?(0,_.jsxs)(w.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,_.jsx)($.$,{purpose:"body-text"}),t?"Loading runs and scheduled ticks":"Loading runs"]}):(0,_.jsxs)(w.x,{flex:{direction:"column",gap:12,alignItems:"center"},children:[(0,_.jsx)("div",{children:t?"No runs or scheduled ticks in this time period.":"No runs in this time period."}),(0,_.jsxs)(w.x,{flex:{direction:"row",gap:12,alignItems:"center"},children:[(0,_.jsx)(Je.A,{icon:(0,_.jsx)(Ue.JO,{name:"add_circle"}),to:"/overview/jobs",children:"Launch a run"}),(0,_.jsx)("span",{children:"or"}),(0,_.jsx)(Je.A,{icon:(0,_.jsx)(Ue.JO,{name:"materialization"}),to:"/asset-groups",children:"Materialize an asset"})]})]})})},kn=Me.ZP.div.withConfig({displayName:"RunTimeline__Timeline",componentId:"sc-1k6kbha-9"})([""," position:relative;"],(function(e){var n=e.$height;return"height: ".concat(n,"px;")})),Cn=Me.ZP.div.withConfig({displayName:"RunTimeline__Row",componentId:"sc-1k6kbha-10"})(["align-items:center;box-shadow:inset 0 -1px 0 ",";display:flex;flex-direction:row;width:100%;height:","px;padding:1px 0;position:absolute;left:0;top:0;",":first-child,:hover{box-shadow:inset 0 1px 0 ",",inset 0 -1px 0 ",";}:hover{background-color:",";}"],G.w.KeylineGray,33,(function(e){var n=e.$top;return"transform: translateY(".concat(n,"px);")}),G.w.KeylineGray,G.w.KeylineGray,G.w.Gray10),Sn=Me.ZP.div.withConfig({displayName:"RunTimeline__JobName",componentId:"sc-1k6kbha-11"})(["align-items:center;display:flex;font-size:13px;justify-content:flex-start;gap:8px;line-height:16px;overflow:hidden;padding:0 12px 0 24px;text-overflow:ellipsis;white-space:nowrap;width:","px;"],320),Tn=Me.ZP.div.withConfig({displayName:"RunTimeline__RunChunks",componentId:"sc-1k6kbha-12"})(["flex:1;position:relative;height:","px;"],an),En=Me.ZP.div.withConfig({displayName:"RunTimeline__RunChunk",componentId:"sc-1k6kbha-13"})(["align-items:center;background:",";border-radius:2px;height:","px;position:absolute;top:2px;",";transition:background-color 300ms linear,width 300ms ease-in-out;.chunk-popover-target{display:block;height:100%;width:100%;}"],(function(e){return e.$background}),28,(function(e){return e.$multiple?"min-width: ".concat(12,"px"):null})),On=Me.ZP.div.withConfig({displayName:"RunTimeline__BatchCount",componentId:"sc-1k6kbha-14"})(["color:",";cursor:default;font-family:",";font-size:14px;font-weight:600;user-select:none;"],G.w.White,De.b.monospace),Nn=function(e){var n=e.job,t=e.batch,r=t.runs.slice(0,50),i=t.runs.length-r.length;return(0,_.jsxs)(w.x,{style:{width:"260px"},children:[(0,_.jsx)(w.x,{padding:12,border:{side:"bottom",width:1,color:G.w.KeylineGray},children:(0,_.jsx)(In,{children:n.jobName})}),(0,_.jsx)("div",{style:{maxHeight:"240px",overflowY:"auto"},children:r.map((function(e,n){return(0,_.jsxs)(w.x,{border:n>0?{side:"top",width:1,color:G.w.KeylineGray}:null,flex:{direction:"row",justifyContent:"space-between",alignItems:"center"},padding:{vertical:8,horizontal:12},children:[(0,_.jsxs)(w.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,_.jsx)(Xe.O_,{status:e.status,size:8}),"SCHEDULED"===e.status?"Scheduled":(0,_.jsx)(Be.rU,{to:"/runs/".concat(e.id),children:(0,_.jsx)(y.fv,{children:e.id.slice(0,8)})})]}),(0,_.jsx)(y.fv,{children:"SCHEDULED"===e.status?(0,_.jsx)(Ve.v,{timestamp:e.startTime/1e3}):(0,_.jsx)(nn.Q,{startUnix:e.startTime/1e3,endUnix:e.endTime/1e3})})]},e.id)}))}),i>0?(0,_.jsx)(w.x,{padding:12,border:{side:"top",width:1,color:G.w.KeylineGray},children:(0,_.jsxs)(Be.rU,{to:"".concat(n.path,"runs"),children:["+ ",i," more"]})}):null]})},In=Me.ZP.strong.withConfig({displayName:"RunTimeline__HoverContentJobName",componentId:"sc-1k6kbha-15"})(["display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;"]),_n=t(5484),An=(0,g.Ps)(d||(d=(0,f.Z)(["\n  fragment ScheduleFutureTicksFragment on Schedule {\n    id\n    executionTimezone\n    scheduleState {\n      id\n      status\n    }\n    futureTicks(cursor: $tickCursor, until: $ticksUntil) {\n      results {\n        timestamp\n      }\n    }\n  }\n"]))),Ln=t(25582),Zn=t(55752),Pn=function(e,n){return"".concat(n,"-").concat((0,V.Uz)(e))},Rn=(0,g.Ps)(u||(u=(0,f.Z)(["\n  query RunTimelineQuery(\n    $inProgressFilter: RunsFilter!\n    $terminatedFilter: RunsFilter!\n    $tickCursor: Float\n    $ticksUntil: Float\n  ) {\n    unterminated: runsOrError(filter: $inProgressFilter) {\n      ... on Runs {\n        results {\n          id\n          pipelineName\n          repositoryOrigin {\n            id\n            repositoryName\n            repositoryLocationName\n          }\n          ...RunTimeFragment\n        }\n      }\n    }\n    terminated: runsOrError(filter: $terminatedFilter) {\n      ... on Runs {\n        results {\n          id\n          pipelineName\n          repositoryOrigin {\n            id\n            repositoryName\n            repositoryLocationName\n          }\n          ...RunTimeFragment\n        }\n      }\n    }\n    workspaceOrError {\n      ... on Workspace {\n        locationEntries {\n          id\n          name\n          loadStatus\n          displayMetadata {\n            key\n            value\n          }\n          locationOrLoadError {\n            ... on RepositoryLocation {\n              id\n              name\n              repositories {\n                id\n                name\n                pipelines {\n                  id\n                  name\n                  isJob\n                }\n                schedules {\n                  id\n                  name\n                  pipelineName\n                  scheduleState {\n                    id\n                    status\n                  }\n                  ...ScheduleFutureTicksFragment\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  ","\n  ","\n"])),Zn.$X,An),zn=36e5,Fn=function(e){switch(e){case"1":return zn;case"6":return 216e5;case"12":return 432e5;case"24":return 864e5}},Mn=function(){(0,E.Px)(),(0,O.j)("Runs");var e=h.useContext(W.C5),n=e.allRepos,t=e.visibleRepos,r=h.useState(""),i=(0,U.Z)(r,2),o=i[0],s=i[1],a=function(e){var n=h.useCallback((function(n){switch(n){case"1":case"6":case"12":case"24":return n;default:return e}}),[e]),t=(0,te.U)("dagit.run-timeline-hour-window",n),r=(0,U.Z)(t,2),i=r[0],o=r[1],s=h.useCallback((function(n){o(n||e)}),[e,o]);return h.useMemo((function(){return[i,s]}),[i,s])}("12"),l=(0,U.Z)(a,2),c=l[0],d=l[1],u=h.useState((function(){return Date.now()})),p=(0,U.Z)(u,2),f=p[0],g=p[1],b=h.useState((function(){return 0})),k=(0,U.Z)(b,2),C=k[0],S=k[1];h.useEffect((function(){g(Date.now());var e=setInterval((function(){g(Date.now())}),6e4);return function(){clearInterval(e)}}),[c]);var N=h.useCallback((function(){S((function(e){return e-Fn(c)}))}),[c]),I=h.useCallback((function(){S((function(e){return e+Fn(c)}))}),[c]),L=h.useCallback((function(){S(0)}),[]),Z=h.useMemo((function(){return[f-Number(c)*zn+C,f+36e5+C]}),[c,f,C]),P=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=(0,U.Z)(e,2),r=t[0],i=t[1],o=r/1e3,s=i/1e3,a=(0,m.a)(Rn,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0,variables:{inProgressFilter:(0,x.Z)((0,x.Z)({},n),{},{statuses:[_n.VO.CANCELING,_n.VO.STARTED],createdBefore:s}),terminatedFilter:(0,x.Z)((0,x.Z)({},n),{},{statuses:Array.from(en.cv),createdBefore:s,updatedAfter:o}),tickCursor:o,ticksUntil:s}}),l=a.data,c=a.previousData,d=a.loading&&!l,u=l||c||{},p=u.unterminated,f=u.terminated,g=u.workspaceOrError,v=h.useMemo((function(){var e={},n=Date.now();return[].concat((0,ce.Z)("Runs"===(null===p||void 0===p?void 0:p.__typename)?p.results:[]),(0,ce.Z)("Runs"===(null===f||void 0===f?void 0:f.__typename)?f.results:[])).forEach((function(t){if(t.startTime&&t.repositoryOrigin&&tn({start:r,end:i},{start:1e3*t.startTime,end:t.endTime?1e3*t.endTime:n})){var o=Pn({name:t.repositoryOrigin.repositoryName,location:t.repositoryOrigin.repositoryLocationName},t.pipelineName);e[o]=[].concat((0,ce.Z)(e[o]||[]),[{id:t.id,status:t.status,startTime:1e3*t.startTime,endTime:t.endTime?1e3*t.endTime:n}])}})),e}),[i,p,f,r]),j=h.useMemo((function(){if(!g||"Workspace"!==g.__typename)return[];var e,n=[],t=(0,D.Z)(g.locationEntries);try{var o=function(){var t,o=e.value;if("WorkspaceLocationEntry"!==o.__typename||"RepositoryLocation"!==(null===(t=o.locationOrLoadError)||void 0===t?void 0:t.__typename))return"continue";var s,a=Date.now(),l=(0,D.Z)(o.locationOrLoadError.repositories);try{for(l.s();!(s=l.n()).done;){var c,d=s.value,u=(0,H.kQ)(d.name,o.locationOrLoadError.name),h=(0,D.Z)(d.pipelines);try{var p=function(){var e,t=c.value,o=(d.schedules||[]).filter((function(e){return e.pipelineName===t.name})),s=[],l=(0,D.Z)(o);try{var h=function(){var n=e.value;n.scheduleState.status===_n.yn.RUNNING&&n.futureTicks.results.forEach((function(e){var t=e.timestamp,o=1e3*t;o>a&&tn({start:r,end:i},{start:o,end:o})&&s.push({id:"".concat(n.pipelineName,"-future-run-").concat(t),status:"SCHEDULED",startTime:o,endTime:o+5e3})}))};for(l.s();!(e=l.n()).done;)h()}catch(g){l.e(g)}finally{l.f()}var p=(0,q.pv)(t.name),f=Pn(u,t.name),x=p?"Ad hoc materializations":t.name,m=v[f]||[];(s.length||m.length)&&n.push({key:f,jobName:x,jobType:p?"asset":"job",repoAddress:u,path:(0,Ln.jT)({repoName:u.name,repoLocation:u.location,pipelineName:t.name,isJob:t.isJob}),runs:[].concat((0,ce.Z)(m),s)})};for(h.s();!(c=h.n()).done;)p()}catch(f){h.e(f)}finally{h.f()}}}catch(f){l.e(f)}finally{l.f()}};for(t.s();!(e=t.n()).done;)o()}catch(a){t.e(a)}finally{t.f()}var s=n.reduce((function(e,n){var t=n.runs.map((function(e){return e.startTime}));return(0,x.Z)((0,x.Z)({},e),{},(0,Fe.Z)({},n.key,Math.min.apply(Math,(0,ce.Z)(t))))}),{});return n.sort((function(e,n){return s[e.key]-s[n.key]}))}),[g,v,r,i]);return h.useMemo((function(){return{jobs:j,initialLoading:d,queryData:a}}),[d,j,a])}(Z),R=P.jobs,z=P.initialLoading,F=P.queryData,M=(0,T.C4)(F,T.dT),$=h.useMemo((function(){var e=o.toLocaleLowerCase().trim(),n=t.flatMap((function(n){var t=(0,H.kQ)(n.repository.name,n.repositoryLocation.name);return n.repository.pipelines.filter((function(n){return n.name.toLocaleLowerCase().includes(e)})).map((function(e){return Pn(t,e.name)}))}));return new Set(n)}),[t,o]),G=h.useMemo((function(){return R.filter((function(e){var n=e.key;return $.has(n)}))}),[R,$]);return(0,_.jsxs)(v.T,{children:[(0,_.jsx)(j.m,{title:(0,_.jsx)(y.X6,{children:"Overview"}),tabs:(0,_.jsx)(A,{tab:"timeline",refreshState:M})}),(0,_.jsxs)(w.x,{padding:{horizontal:24,vertical:16},flex:{alignItems:"center",justifyContent:"space-between"},children:[(0,_.jsxs)(w.x,{flex:{direction:"row",alignItems:"center",gap:12,grow:0},children:[n.length>1&&(0,_.jsx)(B.C,{}),(0,_.jsx)(K.oi,{icon:"search",value:o,onChange:function(e){return s(e.target.value)},placeholder:"Filter by job name\u2026",style:{width:"200px"}})]}),(0,_.jsxs)(w.x,{flex:{direction:"row",gap:16,alignItems:"center"},children:[(0,_.jsx)(ze.h,{activeItems:new Set([c]),buttons:[{id:"1",label:"1hr"},{id:"6",label:"6hr"},{id:"12",label:"12hr"},{id:"24",label:"24hr"}],onClick:function(e){return d(e)}}),(0,_.jsxs)(w.x,{flex:{direction:"row",gap:4,alignItems:"center"},children:[(0,_.jsx)(xe.zx,{onClick:N,children:"\u2190"}),(0,_.jsx)(xe.zx,{onClick:L,children:"Now"}),(0,_.jsx)(xe.zx,{onClick:I,children:"\u2192"})]})]})]}),(0,_.jsx)(ln,{loading:z,range:Z,jobs:G})]})},Dn=function(){return(0,_.jsxs)(p.rs,{children:[(0,_.jsx)(p.AW,{path:"/overview/timeline",children:(0,_.jsx)(Mn,{})}),(0,_.jsx)(p.AW,{path:"/overview/jobs",children:(0,_.jsx)(he,{})}),(0,_.jsx)(p.AW,{path:"/overview/schedules",children:(0,_.jsx)(be,{})}),(0,_.jsx)(p.AW,{path:"/overview/sensors",children:(0,_.jsx)(_e,{})}),(0,_.jsx)(p.AW,{path:"/overview/backfills",children:(0,_.jsx)(z,{})}),(0,_.jsx)(p.AW,{path:"*",render:function(){return(0,_.jsx)(p.l_,{to:"/overview/timeline"})}})]})},Un=Dn}}]);
//# sourceMappingURL=378.cf3406b7.chunk.js.map