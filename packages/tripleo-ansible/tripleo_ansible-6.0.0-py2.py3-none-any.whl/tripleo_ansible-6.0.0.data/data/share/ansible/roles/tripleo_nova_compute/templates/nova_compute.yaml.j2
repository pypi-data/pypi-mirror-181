start_order: 3
image: {{ tripleo_nova_compute_container_image }}
ulimit: {{ tripleo_nova_compute_docker_ulimit }}
ipc: host
net: host
privileged: true
user: nova
restart: always
depends_on:
  - tripleo_nova_libvirt.target
volumes:
  {% set nova_compute_volumes = [] %}
  {%- set nova_compute_volumes =
        nova_compute_volumes +
        tripleo_nova_compute_common_volumes +
        tripleo_nova_compute_volumes +
        tripleo_nova_compute_opt_volumes -%}
  {%- if tripleo_nova_compute_multipathd_enable|bool -%}
  {%- set nova_compute_volumes =
        nova_compute_volumes +
        ['/etc/multipath:/etc/multipath:z'] +
        ['/etc/multipath.conf:/etc/multipath.conf:ro'] -%}
  {%- endif %}
  {%- set nova_compute_volumes =
        nova_compute_volumes +
        tripleo_nova_compute_logging_volumes -%}
  {{ nova_compute_volumes }}
environment:
  {% set nova_compute_env = tripleo_nova_compute_opt_env_vars %}
  {%- set _ = nova_compute_env.update({'KOLLA_CONFIG_STRATEGY':'COPY_ALWAYS'}) -%}
  {%- set _ = nova_compute_env.update({'LIBGUESTFS_BACKEND':'direct'}) -%}
  {{ nova_compute_env }}
