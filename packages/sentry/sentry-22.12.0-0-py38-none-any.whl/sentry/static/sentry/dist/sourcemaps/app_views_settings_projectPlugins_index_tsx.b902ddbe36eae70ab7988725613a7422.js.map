{"version":3,"file":"chunks/app_views_settings_projectPlugins_index_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/actionCreators/plugins.tsx","webpack:///./app/components/acl/access.tsx","webpack:///./app/stores/pluginsStore.tsx","webpack:///./app/utils/withPlugins.tsx","webpack:///./app/views/settings/project/permissionAlert.tsx","webpack:///./app/views/settings/projectPlugins/projectPluginRow.tsx","webpack:///./app/views/settings/projectPlugins/projectPlugins.tsx","webpack:///./app/views/settings/projectPlugins/index.tsx"],"sourcesContent":["import {\n  addErrorMessage,\n  addLoadingMessage,\n  addSuccessMessage,\n} from 'sentry/actionCreators/indicator';\nimport {Client, RequestOptions} from 'sentry/api';\nimport {t} from 'sentry/locale';\nimport PluginsStore from 'sentry/stores/pluginsStore';\nimport {Plugin} from 'sentry/types';\n\nconst activeFetch = {};\n// PluginsStore always exists, so api client should be independent of component lifecycle\nconst api = new Client();\n\ntype Slugs = {\n  /**\n   * Organization slug\n   */\n  orgId: string;\n\n  /**\n   * Plugin slug\n   */\n  pluginId: string;\n\n  /**\n   * Project slug\n   */\n  projectId: string;\n};\n\ntype DoUpdateParams = Slugs & {\n  update: Partial<Plugin>;\n} & Partial<RequestOptions>;\n\nfunction doUpdate({orgId, projectId, pluginId, update, ...params}: DoUpdateParams) {\n  PluginsStore.onUpdate(pluginId, update);\n  const request = api.requestPromise(\n    `/projects/${orgId}/${projectId}/plugins/${pluginId}/`,\n    {\n      ...params,\n    }\n  );\n\n  // This is intentionally not chained because we want the unhandled promise to be returned\n  request\n    .then(() => {\n      PluginsStore.onUpdateSuccess(pluginId, update);\n    })\n    .catch(resp => {\n      const err =\n        resp && resp.responseJSON && typeof resp.responseJSON.detail === 'string'\n          ? new Error(resp.responseJSON.detail)\n          : new Error('Unable to update plugin');\n      PluginsStore.onUpdateError(pluginId, update, err);\n    });\n\n  return request;\n}\n\ntype FetchPluginsOptions = {\n  /**\n   * Reset will set loading state = true\n   */\n  resetLoading?: boolean;\n};\n\n/**\n * Fetches list of available plugins for a project\n */\nexport function fetchPlugins(\n  {orgId, projectId}: Pick<Slugs, 'orgId' | 'projectId'>,\n  options?: FetchPluginsOptions\n): Promise<Plugin[]> {\n  const path = `/projects/${orgId}/${projectId}/plugins/`;\n\n  // Make sure we throttle fetches\n  if (activeFetch[path]) {\n    return activeFetch[path];\n  }\n\n  PluginsStore.onFetchAll(options);\n  const request = api.requestPromise(path, {\n    method: 'GET',\n    includeAllArgs: true,\n  });\n\n  activeFetch[path] = request;\n\n  // This is intentionally not chained because we want the unhandled promise to be returned\n  request\n    .then(([data, _, resp]) => {\n      PluginsStore.onFetchAllSuccess(data, {\n        pageLinks: resp?.getResponseHeader('Link') ?? undefined,\n      });\n\n      return data;\n    })\n    .catch(err => {\n      PluginsStore.onFetchAllError(err);\n      throw new Error('Unable to fetch plugins');\n    })\n    .then(() => (activeFetch[path] = null));\n\n  return request;\n}\n\ntype EnableDisablePluginParams = Slugs;\n\n/**\n * Enables a plugin\n */\nexport function enablePlugin(params: EnableDisablePluginParams) {\n  addLoadingMessage(t('Enabling...'));\n  return doUpdate({...params, update: {enabled: true}, method: 'POST'})\n    .then(() => addSuccessMessage(t('Plugin was enabled')))\n    .catch(() => addErrorMessage(t('Unable to enable plugin')));\n}\n\n/**\n * Disables a plugin\n */\nexport function disablePlugin(params: EnableDisablePluginParams) {\n  addLoadingMessage(t('Disabling...'));\n  return doUpdate({...params, update: {enabled: false}, method: 'DELETE'})\n    .then(() => addSuccessMessage(t('Plugin was disabled')))\n    .catch(() => addErrorMessage(t('Unable to disable plugin')));\n}\n","import {Component} from 'react';\n\nimport Alert from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\nimport {Config, Organization, Scope} from 'sentry/types';\nimport {isRenderFunc} from 'sentry/utils/isRenderFunc';\nimport withConfig from 'sentry/utils/withConfig';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nconst DEFAULT_NO_ACCESS_MESSAGE = (\n  <Alert type=\"error\" showIcon>\n    {t('You do not have sufficient permissions to access this.')}\n  </Alert>\n);\n\n// Props that function children will get.\nexport type ChildRenderProps = {\n  hasAccess: boolean;\n  hasSuperuser: boolean;\n};\n\ntype ChildFunction = (props: ChildRenderProps) => React.ReactNode;\n\ntype DefaultProps = {\n  /**\n   * List of required access levels\n   */\n  access: Scope[];\n\n  /**\n   * Custom renderer function for \"no access\" message OR `true` to use\n   * default message. `false` will suppress message.\n   */\n  renderNoAccessMessage: ChildFunction | boolean;\n\n  /**\n   * Requires superuser\n   */\n  isSuperuser?: boolean;\n\n  /**\n   * Should the component require all access levels or just one or more.\n   */\n  requireAll?: boolean;\n};\n\nconst defaultProps: DefaultProps = {\n  renderNoAccessMessage: false,\n  isSuperuser: false,\n  requireAll: true,\n  access: [],\n};\n\ntype Props = {\n  /**\n   * Configuration from ConfigStore\n   */\n  config: Config;\n\n  /**\n   * Current Organization\n   */\n  organization: Organization;\n\n  /**\n   * Children can be a node or a function as child.\n   */\n  children?: React.ReactNode | ChildFunction;\n} & Partial<DefaultProps>;\n\n/**\n * Component to handle access restrictions.\n */\nclass Access extends Component<Props> {\n  static defaultProps = defaultProps;\n\n  render() {\n    const {\n      organization,\n      config,\n      access,\n      requireAll,\n      isSuperuser,\n      renderNoAccessMessage,\n      children,\n    } = this.props;\n\n    const {access: orgAccess} = organization || {access: []};\n    const method = requireAll ? 'every' : 'some';\n\n    const hasAccess = !access || access[method](acc => orgAccess.includes(acc));\n    const hasSuperuser = !!(config.user && config.user.isSuperuser);\n\n    const renderProps: ChildRenderProps = {\n      hasAccess,\n      hasSuperuser,\n    };\n\n    const render = hasAccess && (!isSuperuser || hasSuperuser);\n\n    if (!render && typeof renderNoAccessMessage === 'function') {\n      return renderNoAccessMessage(renderProps);\n    }\n    if (!render && renderNoAccessMessage) {\n      return DEFAULT_NO_ACCESS_MESSAGE;\n    }\n\n    if (isRenderFunc<ChildFunction>(children)) {\n      return children(renderProps);\n    }\n\n    return render ? children : null;\n  }\n}\n\nexport default withOrganization(withConfig(Access));\n","import {createStore, StoreDefinition} from 'reflux';\n\nimport {Plugin} from 'sentry/types';\n\ninterface InternalDefinition {\n  plugins: Map<string, Plugin> | null;\n  state: {\n    error: Error | null;\n    loading: boolean;\n    pageLinks: string | null;\n    plugins: Plugin[];\n  };\n  updating: Map<string, Plugin>;\n}\n\ninterface PluginStoreDefinition extends StoreDefinition, InternalDefinition {\n  onFetchAll: (options?: {resetLoading?: boolean}) => void;\n  onFetchAllError: (err) => void;\n  onFetchAllSuccess: (data: Plugin[], links: {pageLinks?: string}) => void;\n\n  onUpdate: (id: string, updateObj: Partial<Plugin>) => void;\n  onUpdateError: (id: string, _updateObj: Partial<Plugin>, err) => void;\n  onUpdateSuccess: (id: string, _updateObj: Partial<Plugin>) => void;\n}\n\nconst defaultState = {\n  loading: true,\n  plugins: [],\n  error: null,\n  pageLinks: null,\n};\n\nconst storeConfig: PluginStoreDefinition = {\n  plugins: null,\n  state: {...defaultState},\n  updating: new Map(),\n\n  reset() {\n    // reset our state\n    this.plugins = null;\n    this.state = {...defaultState};\n    this.updating = new Map();\n    return this.state;\n  },\n\n  getInitialState() {\n    return this.getState();\n  },\n\n  getState() {\n    const {plugins: _plugins, ...state} = this.state;\n\n    return {\n      ...state,\n      plugins: this.plugins ? Array.from(this.plugins.values()) : [],\n    };\n  },\n\n  init() {\n    // XXX: Do not use `this.listenTo` in this store. We avoid usage of reflux\n    // listeners due to their leaky nature in tests.\n\n    this.reset();\n  },\n\n  triggerState() {\n    this.trigger(this.getState());\n  },\n\n  onFetchAll({resetLoading} = {}) {\n    if (resetLoading) {\n      this.state.loading = true;\n      this.state.error = null;\n      this.plugins = null;\n    }\n\n    this.triggerState();\n  },\n\n  onFetchAllSuccess(data, {pageLinks}) {\n    this.plugins = new Map(data.map(plugin => [plugin.id, plugin]));\n    this.state.pageLinks = pageLinks || null;\n    this.state.loading = false;\n    this.triggerState();\n  },\n\n  onFetchAllError(err) {\n    this.plugins = null;\n    this.state.loading = false;\n    this.state.error = err;\n    this.triggerState();\n  },\n\n  onUpdate(id: string, updateObj: Partial<Plugin>) {\n    if (!this.plugins) {\n      return;\n    }\n\n    const plugin = this.plugins.get(id);\n    if (!plugin) {\n      return;\n    }\n    const newPlugin = {\n      ...plugin,\n      ...updateObj,\n    };\n\n    this.plugins.set(id, newPlugin);\n    this.updating.set(id, plugin);\n    this.triggerState();\n  },\n\n  onUpdateSuccess(id: string, _updateObj: Partial<Plugin>) {\n    this.updating.delete(id);\n  },\n\n  onUpdateError(id: string, _updateObj: Partial<Plugin>, err) {\n    const origPlugin = this.updating.get(id);\n    if (!origPlugin || !this.plugins) {\n      return;\n    }\n\n    this.plugins.set(id, origPlugin);\n    this.updating.delete(id);\n    this.state.error = err;\n    this.triggerState();\n  },\n};\n\nconst PluginStore = createStore(storeConfig);\nexport default PluginStore;\n","import {Component} from 'react';\n\nimport {fetchPlugins} from 'sentry/actionCreators/plugins';\nimport PluginsStore from 'sentry/stores/pluginsStore';\nimport {Organization, Plugin, Project} from 'sentry/types';\nimport {defined} from 'sentry/utils';\nimport getDisplayName from 'sentry/utils/getDisplayName';\nimport withOrganization from 'sentry/utils/withOrganization';\nimport withProject from 'sentry/utils/withProject';\n\ntype WithPluginProps = {\n  organization: Organization;\n  project?: Project;\n};\n\ntype State = {\n  loading: boolean;\n  plugins: Plugin[];\n};\n\n/**\n * Higher order component that fetches list of plugins and\n * passes PluginsStore to component as `plugins`\n */\nfunction withPlugins<P extends WithPluginProps>(\n  WrappedComponent: React.ComponentType<P>\n) {\n  class WithPlugins extends Component<Omit<P, keyof 'plugins'> & WithPluginProps, State> {\n    static displayName = `withPlugins(${getDisplayName(WrappedComponent)})`;\n    state = {plugins: [], loading: true};\n\n    componentDidMount() {\n      this.fetchPlugins();\n    }\n\n    componentDidUpdate(prevProps, _prevState, prevContext) {\n      const {organization, project} = this.props;\n\n      // Only fetch plugins when a org slug or project slug has changed\n      const prevOrg = prevProps.organization || prevContext?.organization;\n      const prevProject = prevProps.project || prevContext?.project;\n\n      // If previous org/project is undefined then it means:\n      // the HoC has mounted, `fetchPlugins` has been called (via cDM), and\n      // store was updated. We don't need to fetchPlugins again (or it will cause an infinite loop)\n      //\n      // This is for the unusual case where component is mounted and receives a new org/project prop\n      // e.g. when switching projects via breadcrumbs in settings.\n      if (!defined(prevProject) || !defined(prevOrg)) {\n        return;\n      }\n\n      const isOrgSame = prevOrg.slug === organization.slug;\n      const isProjectSame = prevProject.slug === project?.slug;\n\n      // Don't do anything if org and project are the same\n      if (isOrgSame && isProjectSame) {\n        return;\n      }\n\n      this.fetchPlugins();\n    }\n\n    componentWillUnmount() {\n      this.unsubscribe();\n    }\n\n    unsubscribe = PluginsStore.listen(({plugins, loading}: State) => {\n      // State is destructured as store updates contain additional keys\n      // that are not exposed by this HoC\n      this.setState({plugins, loading});\n    }, undefined);\n\n    fetchPlugins() {\n      const {organization, project} = this.props;\n\n      if (!project || !organization) {\n        return;\n      }\n\n      fetchPlugins({projectId: project.slug, orgId: organization.slug});\n    }\n\n    render() {\n      return (\n        <WrappedComponent {...(this.props as P & WithPluginProps)} plugins={this.state} />\n      );\n    }\n  }\n  return withOrganization(withProject(WithPlugins));\n}\n\nexport default withPlugins;\n","import Access from 'sentry/components/acl/access';\nimport Alert from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\n\ntype Props = React.ComponentPropsWithoutRef<typeof Alert> &\n  Pick<React.ComponentProps<typeof Access>, 'access'>;\n\nconst PermissionAlert = ({access = ['project:write'], ...props}: Props) => (\n  <Access access={access}>\n    {({hasAccess}) =>\n      !hasAccess && (\n        <Alert data-test-id=\"project-permission-alert\" type=\"warning\" {...props}>\n          {t(\n            'These settings can only be edited by users with the organization owner, manager, or admin role.'\n          )}\n        </Alert>\n      )\n    }\n  </Access>\n);\n\nexport default PermissionAlert;\n","import {PureComponent} from 'react';\nimport {RouteComponentProps} from 'react-router';\nimport {css} from '@emotion/react';\nimport styled from '@emotion/styled';\n\nimport Access from 'sentry/components/acl/access';\nimport ExternalLink from 'sentry/components/links/externalLink';\nimport Link from 'sentry/components/links/link';\nimport Switch from 'sentry/components/switchButton';\nimport {t} from 'sentry/locale';\nimport PluginIcon from 'sentry/plugins/components/pluginIcon';\nimport {Organization, Plugin, Project} from 'sentry/types';\nimport getDynamicText from 'sentry/utils/getDynamicText';\nimport {trackIntegrationAnalytics} from 'sentry/utils/integrationUtil';\nimport recreateRoute from 'sentry/utils/recreateRoute';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nconst grayText = css`\n  color: #979ba0;\n`;\n\ntype Props = {\n  onChange: (id: string, enabled: boolean) => void;\n  organization: Organization;\n  project: Project;\n} & Plugin &\n  Pick<RouteComponentProps<{}, {}>, 'params' | 'routes'>;\n\nclass ProjectPluginRow extends PureComponent<Props> {\n  handleChange = () => {\n    const {onChange, id, enabled} = this.props;\n    onChange(id, !enabled);\n    const eventKey = !enabled ? 'integrations.enabled' : 'integrations.disabled';\n    trackIntegrationAnalytics(eventKey, {\n      integration: id,\n      integration_type: 'plugin',\n      view: 'legacy_integrations',\n      organization: this.props.organization,\n    });\n  };\n\n  render() {\n    const {id, name, slug, version, author, hasConfiguration, enabled, canDisable} =\n      this.props;\n\n    const configureUrl = recreateRoute(id, this.props);\n    return (\n      <Access access={['project:write']}>\n        {({hasAccess}) => {\n          const LinkOrSpan = hasAccess ? Link : 'span';\n\n          return (\n            <PluginItem key={id} className={slug}>\n              <PluginInfo>\n                <StyledPluginIcon size={48} pluginId={id} />\n                <PluginDescription>\n                  <PluginName>\n                    {`${name} `}\n                    {getDynamicText({\n                      value: (\n                        <Version>{version ? `v${version}` : <em>{t('n/a')}</em>}</Version>\n                      ),\n                      fixed: <Version>v10</Version>,\n                    })}\n                  </PluginName>\n                  <div>\n                    {author && (\n                      <ExternalLink css={grayText} href={author.url}>\n                        {author.name}\n                      </ExternalLink>\n                    )}\n                    {hasConfiguration && (\n                      <span>\n                        {' '}\n                        &middot;{' '}\n                        <LinkOrSpan css={grayText} to={configureUrl}>\n                          {t('Configure plugin')}\n                        </LinkOrSpan>\n                      </span>\n                    )}\n                  </div>\n                </PluginDescription>\n              </PluginInfo>\n              <Switch\n                size=\"lg\"\n                isDisabled={!hasAccess || !canDisable}\n                isActive={enabled}\n                toggle={this.handleChange}\n              />\n            </PluginItem>\n          );\n        }}\n      </Access>\n    );\n  }\n}\n\nexport default withOrganization(ProjectPluginRow);\n\nconst PluginItem = styled('div')`\n  display: flex;\n  flex: 1;\n  align-items: center;\n`;\n\nconst PluginDescription = styled('div')`\n  display: flex;\n  justify-content: center;\n  flex-direction: column;\n`;\n\nconst PluginInfo = styled('div')`\n  display: flex;\n  flex: 1;\n  line-height: 24px;\n`;\n\nconst PluginName = styled('div')`\n  font-size: 16px;\n`;\n\nconst StyledPluginIcon = styled(PluginIcon)`\n  margin-right: 16px;\n`;\n\n// Keeping these colors the same from old integrations page\nconst Version = styled('span')`\n  color: #babec2;\n`;\n","import {Component} from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport Access from 'sentry/components/acl/access';\nimport Link from 'sentry/components/links/link';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {\n  Panel,\n  PanelAlert,\n  PanelBody,\n  PanelHeader,\n  PanelItem,\n} from 'sentry/components/panels';\nimport {t, tct} from 'sentry/locale';\nimport {Plugin, Project} from 'sentry/types';\nimport RouteError from 'sentry/views/routeError';\n\nimport ProjectPluginRow from './projectPluginRow';\n\ntype Props = {\n  error: React.ComponentProps<typeof RouteError>['error'];\n  loading: boolean;\n  onChange: React.ComponentProps<typeof ProjectPluginRow>['onChange'];\n  plugins: Plugin[];\n  project: Project;\n} & RouteComponentProps<{orgId: string}, {}>;\n\nclass ProjectPlugins extends Component<Props> {\n  render() {\n    const {plugins, loading, error, onChange, routes, params, project} = this.props;\n    const {orgId} = this.props.params;\n    const hasError = error;\n    const isLoading = !hasError && loading;\n\n    if (hasError) {\n      return <RouteError error={error} />;\n    }\n\n    if (isLoading) {\n      return <LoadingIndicator />;\n    }\n\n    return (\n      <Panel>\n        <PanelHeader>\n          <div>{t('Legacy Integration')}</div>\n          <div>{t('Enabled')}</div>\n        </PanelHeader>\n        <PanelBody>\n          <PanelAlert type=\"warning\">\n            <Access access={['org:integrations']}>\n              {({hasAccess}) =>\n                hasAccess\n                  ? tct(\n                      \"Legacy Integrations must be configured per-project. It's recommended to prefer organization integrations over the legacy project integrations when available. Visit the [link:organization integrations] settings to manage them.\",\n                      {\n                        link: <Link to={`/settings/${orgId}/integrations`} />,\n                      }\n                    )\n                  : t(\n                      \"Legacy Integrations must be configured per-project. It's recommended to prefer organization integrations over the legacy project integrations when available.\"\n                    )\n              }\n            </Access>\n          </PanelAlert>\n\n          {plugins\n            .filter(p => {\n              return !p.isHidden;\n            })\n            .map(plugin => (\n              <PanelItem key={plugin.id}>\n                <ProjectPluginRow\n                  params={params}\n                  routes={routes}\n                  project={project}\n                  {...plugin}\n                  onChange={onChange}\n                />\n              </PanelItem>\n            ))}\n        </PanelBody>\n      </Panel>\n    );\n  }\n}\n\nexport default ProjectPlugins;\n","import {Component, Fragment} from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport {disablePlugin, enablePlugin, fetchPlugins} from 'sentry/actionCreators/plugins';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\nimport {t} from 'sentry/locale';\nimport {Organization, Plugin, Project} from 'sentry/types';\nimport {trackIntegrationAnalytics} from 'sentry/utils/integrationUtil';\nimport withPlugins from 'sentry/utils/withPlugins';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport PermissionAlert from 'sentry/views/settings/project/permissionAlert';\n\nimport ProjectPlugins from './projectPlugins';\n\ntype Props = RouteComponentProps<{orgId: string; projectId: string}, {}> & {\n  organization: Organization;\n  plugins: {\n    error: React.ComponentProps<typeof ProjectPlugins>['error'];\n    loading: boolean;\n    plugins: Plugin[];\n  };\n  project: Project;\n};\n\nclass ProjectPluginsContainer extends Component<Props> {\n  componentDidMount() {\n    this.fetchData();\n  }\n\n  fetchData = async () => {\n    const plugins = await fetchPlugins(this.props.params);\n    const installCount = plugins.filter(\n      plugin => plugin.hasConfiguration && plugin.enabled\n    ).length;\n    trackIntegrationAnalytics(\n      'integrations.index_viewed',\n      {\n        integrations_installed: installCount,\n        view: 'legacy_integrations',\n        organization: this.props.organization,\n      },\n      {startSession: true}\n    );\n  };\n\n  handleChange = (pluginId: string, shouldEnable: boolean) => {\n    const {projectId, orgId} = this.props.params;\n    const actionCreator = shouldEnable ? enablePlugin : disablePlugin;\n    actionCreator({projectId, orgId, pluginId});\n  };\n\n  render() {\n    const {loading, error, plugins} = this.props.plugins || {};\n    const {orgId} = this.props.params;\n\n    const title = t('Legacy Integrations');\n\n    return (\n      <Fragment>\n        <SentryDocumentTitle title={title} orgSlug={orgId} />\n        <SettingsPageHeader title={title} />\n        <PermissionAlert />\n\n        <ProjectPlugins\n          {...this.props}\n          onChange={this.handleChange}\n          loading={loading}\n          error={error}\n          plugins={plugins}\n        />\n      </Fragment>\n    );\n  }\n}\n\nexport {ProjectPluginsContainer};\n\nexport default withPlugins(ProjectPluginsContainer);\n"],"names":["activeFetch","api","Client","doUpdate","orgId","projectId","pluginId","update","params","PluginsStore","request","requestPromise","then","catch","resp","err","responseJSON","detail","Error","fetchPlugins","options","path","method","includeAllArgs","data","_","pageLinks","getResponseHeader","undefined","enablePlugin","addLoadingMessage","t","enabled","addSuccessMessage","addErrorMessage","disablePlugin","DEFAULT_NO_ACCESS_MESSAGE","type","showIcon","Access","Component","render","organization","config","access","requireAll","isSuperuser","renderNoAccessMessage","children","this","props","orgAccess","hasAccess","acc","includes","hasSuperuser","user","renderProps","isRenderFunc","withOrganization","withConfig","defaultState","loading","plugins","error","storeConfig","state","updating","Map","reset","getInitialState","getState","_plugins","Array","from","values","init","triggerState","trigger","onFetchAll","resetLoading","onFetchAllSuccess","map","plugin","id","onFetchAllError","onUpdate","updateObj","get","newPlugin","set","onUpdateSuccess","_updateObj","delete","onUpdateError","origPlugin","createStore","WrappedComponent","WithPlugins","setState","componentDidMount","componentDidUpdate","prevProps","_prevState","prevContext","project","prevOrg","prevProject","defined","isOrgSame","slug","isProjectSame","componentWillUnmount","unsubscribe","getDisplayName","withProject","PermissionAlert","grayText","ProjectPluginRow","PureComponent","onChange","eventKey","trackIntegrationAnalytics","integration","integration_type","view","name","version","author","hasConfiguration","canDisable","configureUrl","recreateRoute","LinkOrSpan","Link","PluginItem","className","PluginInfo","StyledPluginIcon","size","PluginDescription","PluginName","getDynamicText","value","Version","fixed","css","href","url","to","isDisabled","isActive","toggle","handleChange","PluginIcon","ProjectPlugins","routes","isLoading","tct","link","filter","p","isHidden","ProjectPluginsContainer","async","installCount","length","integrations_installed","startSession","shouldEnable","fetchData","title","Fragment","orgSlug","withPlugins"],"sourceRoot":""}