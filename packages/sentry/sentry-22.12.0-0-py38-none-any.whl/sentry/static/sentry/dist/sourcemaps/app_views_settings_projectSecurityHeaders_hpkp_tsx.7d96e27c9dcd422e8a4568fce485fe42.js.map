{"version":3,"file":"chunks/app_views_settings_projectSecurityHeaders_hpkp_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"gWAOA,MAAMA,EAAiB,QAAC,KAACC,EAAO,QAAc,SAC5C,QAAC,IAAK,CAACA,KAAMA,EAAMC,UAAQ,YACxBC,EAAAA,EAAAA,GACC,+FAEI,EALJH,EAAc,6BAQpB,S,0DCHA,QAZA,SACEI,EACAC,GAGQ,IAFRC,IAAsB,UAAH,+CACnBC,EAAoB,uCAEpB,MAAMC,EAAY,GAAEJ,OAAeC,IAC7BI,EAAOF,EAAe,GAAEC,OAAcD,IAAgBC,EAE5D,OAAOF,EAAc,GAAEG,aAAkBA,CAC3C,C,wPCJe,MAAMC,UAGXC,EAAAA,EACRC,WACE,MAAO,EACT,CAEAC,SACE,OACE,QAAC,IAAmB,CAACC,MAAOC,KAAKH,WAAW,SACzCG,KAAKC,mBAGZ,EAdmBN,EAAS,uB,kiBCcf,MAAMO,UAA2BP,EAAAA,EAC9CQ,eACE,MAAM,MAACC,EAAK,UAAEC,GAAaL,KAAKM,MAAMC,OACtC,MAAO,CAAC,CAAC,UAAY,aAAYH,KAASC,WAC5C,CAEAR,WACE,MAAM,UAACQ,GAAaL,KAAKM,MAAMC,OAC/B,OAAOC,EAAAA,EAAAA,IAAcpB,EAAAA,EAAAA,GAAE,kCAAmCiB,GAAW,EACvE,CAEAI,gBAAgBC,GACd,MAMG,0SAAwBC,EAAAA,EAAAA,GAAeD,8BAG5C,CAEAE,0BAA0BF,GACxB,MAMG,sTAAwBC,EAAAA,EAAAA,GAAeD,8BAG5C,CAEAG,aACE,MAAM,OAACN,GAAUP,KAAKM,OAChB,QAACI,GAAWV,KAAKc,MACvB,OAAKJ,GAKH,0BACE,QAAC,IAAkB,CAACX,OAAOX,EAAAA,EAAAA,GAAE,8BAE7B,QAAC,IAAc,KAEf,QAAC,IAAS,CAACsB,QAASA,EAASN,MAAOG,EAAOH,MAAOC,UAAWE,EAAOF,aAEpE,QAAC,KAAK,YACJ,QAAC,KAAW,WAAEjB,EAAAA,EAAAA,GAAE,YAEhB,QAAC,IAAS,CAAC2B,aAAW,aACpB,uBACGC,EAAAA,EAAAA,IACE,2YAKD,CACEC,MACE,QAAC,IAAY,CAACC,KAAK,+DAM3B,uBACG9B,EAAAA,EAAAA,GACE,qMAML,uBACGA,EAAAA,EAAAA,GACC,gFAGJ,wBAAMY,KAAKS,gBAAgBC,MAE3B,uBACGtB,EAAAA,EAAAA,GAAG,+HAGN,wBAAMY,KAAKY,0BAA0BF,MAErC,uBACGM,EAAAA,EAAAA,IACE,gPAGD,CACEC,MACE,aAAGC,KAAK,sFA1Df,IAmEX,E,2aCtHF,MAAMC,EAAmB,kDAElB,SAASR,EAAeD,GAC7B,MAAMU,EAAWV,EAAQW,OAASX,EAAQ,GAAGY,IAAIC,SAAWJ,EAC5D,OAAOK,EAAAA,EAAAA,GAAe,CACpBC,MAAOL,EACPM,MAAOP,GAEX,CAQe,SAASQ,EAAU,GAAoC,IAApC,QAACjB,EAAO,MAAEN,EAAK,UAAEC,GAAiB,EAClE,OACE,QAAC,KAAK,YACJ,QAAC,KAAW,WAAEjB,EAAAA,EAAAA,GAAE,iBAChB,QAAC,IAAS,YACR,QAAC,KAAU,CAACF,KAAK,OAAM,UACpB8B,EAAAA,EAAAA,IACC,sFACA,CACEC,MAAM,QAAC,IAAI,CAACW,GAAK,aAAYxB,cAAkBC,iBAIrD,QAAC,IAAK,CAACwB,QAAQ,EAAOC,0BAAwB,YAC5C,QAAC,KAAa,UAAEnB,EAAeD,YAKzC,CAnBwBiB,EAAS,uB","sources":["webpack:///./app/components/previewFeature.tsx","webpack:///./app/utils/routeTitle.tsx","webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/projectSecurityHeaders/hpkp.tsx","webpack:///./app/views/settings/projectSecurityHeaders/reportUri.tsx"],"sourcesContent":["import Alert from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\n\ntype Props = {\n  type?: React.ComponentProps<typeof Alert>['type'];\n};\n\nconst PreviewFeature = ({type = 'info'}: Props) => (\n  <Alert type={type} showIcon>\n    {t(\n      'This feature is a preview and may change in the future. Thanks for being an early adopter!'\n    )}\n  </Alert>\n);\n\nexport default PreviewFeature;\n","function routeTitleGen(\n  routeName: string,\n  orgSlug: string,\n  withSentry: boolean = true,\n  projectSlug?: string\n): string {\n  const tmplBase = `${routeName} - ${orgSlug}`;\n  const tmpl = projectSlug ? `${tmplBase} - ${projectSlug}` : tmplBase;\n\n  return withSentry ? `${tmpl} - Sentry` : tmpl;\n}\n\nexport default routeTitleGen;\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {RouteComponentProps} from 'react-router';\n\nimport ExternalLink from 'sentry/components/links/externalLink';\nimport {Panel, PanelBody, PanelHeader} from 'sentry/components/panels';\nimport PreviewFeature from 'sentry/components/previewFeature';\nimport {t, tct} from 'sentry/locale';\nimport {ProjectKey} from 'sentry/types';\nimport routeTitleGen from 'sentry/utils/routeTitle';\nimport AsyncView from 'sentry/views/asyncView';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport ReportUri, {\n  getSecurityDsn,\n} from 'sentry/views/settings/projectSecurityHeaders/reportUri';\n\ntype Props = RouteComponentProps<{orgId: string; projectId: string}, {}>;\n\ntype State = {\n  keyList: null | ProjectKey[];\n} & AsyncView['state'];\n\nexport default class ProjectHpkpReports extends AsyncView<Props, State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    const {orgId, projectId} = this.props.params;\n    return [['keyList', `/projects/${orgId}/${projectId}/keys/`]];\n  }\n\n  getTitle() {\n    const {projectId} = this.props.params;\n    return routeTitleGen(t('HTTP Public Key Pinning (HPKP)'), projectId, false);\n  }\n\n  getInstructions(keyList: ProjectKey[]) {\n    return (\n      'def middleware(request, response):\\n' +\n      \"    response['Public-Key-Pins'] = \\\\\\n\" +\n      '        \\'pin-sha256=\"cUPcTAZWKaASuYWhhneDttWpY3oBAkE3h2+soZS7sWs=\"; \\' \\\\\\n' +\n      '        \\'pin-sha256=\"M8HztCzM3elUxkcjR2S5P4hhyBNf6lHkmjAHKhpGPWE=\"; \\' \\\\\\n' +\n      \"        'max-age=5184000; includeSubDomains; ' \\\\\\n\" +\n      `        \\'report-uri=\"${getSecurityDsn(keyList)}\"\\' \\n` +\n      '    return response\\n'\n    );\n  }\n\n  getReportOnlyInstructions(keyList: ProjectKey[]) {\n    return (\n      'def middleware(request, response):\\n' +\n      \"    response['Public-Key-Pins-Report-Only'] = \\\\\\n\" +\n      '        \\'pin-sha256=\"cUPcTAZWKaASuYWhhneDttWpY3oBAkE3h2+soZS7sWs=\"; \\' \\\\\\n' +\n      '        \\'pin-sha256=\"M8HztCzM3elUxkcjR2S5P4hhyBNf6lHkmjAHKhpGPWE=\"; \\' \\\\\\n' +\n      \"        'max-age=5184000; includeSubDomains; ' \\\\\\n\" +\n      `        \\'report-uri=\"${getSecurityDsn(keyList)}\"\\' \\n` +\n      '    return response\\n'\n    );\n  }\n\n  renderBody() {\n    const {params} = this.props;\n    const {keyList} = this.state;\n    if (!keyList) {\n      return null;\n    }\n\n    return (\n      <div>\n        <SettingsPageHeader title={t('HTTP Public Key Pinning')} />\n\n        <PreviewFeature />\n\n        <ReportUri keyList={keyList} orgId={params.orgId} projectId={params.projectId} />\n\n        <Panel>\n          <PanelHeader>{t('About')}</PanelHeader>\n\n          <PanelBody withPadding>\n            <p>\n              {tct(\n                `[link:HTTP Public Key Pinning]\n              (HPKP) is a security feature that tells a web client to associate a specific\n              cryptographic public key with a certain web server to decrease the risk of MITM\n              attacks with forged certificates. It's enforced by browser vendors, and Sentry\n              supports capturing violations using the standard reporting hooks.`,\n                {\n                  link: (\n                    <ExternalLink href=\"https://en.wikipedia.org/wiki/HTTP_Public_Key_Pinning\" />\n                  ),\n                }\n              )}\n            </p>\n\n            <p>\n              {t(\n                `To configure HPKP reports\n              in Sentry, you'll need to send a header from your server describing your\n              policy, as well specifying the authenticated Sentry endpoint.`\n              )}\n            </p>\n\n            <p>\n              {t(\n                'For example, in Python you might achieve this via a simple web middleware'\n              )}\n            </p>\n            <pre>{this.getInstructions(keyList)}</pre>\n\n            <p>\n              {t(`Alternatively you can setup HPKP reports to simply send reports rather than\n              actually enforcing the policy`)}\n            </p>\n            <pre>{this.getReportOnlyInstructions(keyList)}</pre>\n\n            <p>\n              {tct(\n                `We recommend setting this up to only run on a percentage of requests, as\n              otherwise you may find that you've quickly exhausted your quota. For more\n              information, take a look at [link:the documentation on MDN].`,\n                {\n                  link: (\n                    <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Public_Key_Pinning\" />\n                  ),\n                }\n              )}\n            </p>\n          </PanelBody>\n        </Panel>\n      </div>\n    );\n  }\n}\n","import Field from 'sentry/components/forms/field';\nimport Link from 'sentry/components/links/link';\nimport {Panel, PanelAlert, PanelBody, PanelHeader} from 'sentry/components/panels';\nimport TextCopyInput from 'sentry/components/textCopyInput';\nimport {t, tct} from 'sentry/locale';\nimport {ProjectKey} from 'sentry/types';\nimport getDynamicText from 'sentry/utils/getDynamicText';\n\nconst DEFAULT_ENDPOINT = 'https://sentry.example.com/api/security-report/';\n\nexport function getSecurityDsn(keyList: ProjectKey[]) {\n  const endpoint = keyList.length ? keyList[0].dsn.security : DEFAULT_ENDPOINT;\n  return getDynamicText({\n    value: endpoint,\n    fixed: DEFAULT_ENDPOINT,\n  });\n}\n\ntype Props = {\n  keyList: ProjectKey[];\n  orgId: string;\n  projectId: string;\n};\n\nexport default function ReportUri({keyList, orgId, projectId}: Props) {\n  return (\n    <Panel>\n      <PanelHeader>{t('Report URI')}</PanelHeader>\n      <PanelBody>\n        <PanelAlert type=\"info\">\n          {tct(\n            \"We've automatically pulled these credentials from your available [link:Client Keys]\",\n            {\n              link: <Link to={`/settings/${orgId}/projects/${projectId}/keys/`} />,\n            }\n          )}\n        </PanelAlert>\n        <Field inline={false} flexibleControlStateSize>\n          <TextCopyInput>{getSecurityDsn(keyList)}</TextCopyInput>\n        </Field>\n      </PanelBody>\n    </Panel>\n  );\n}\n"],"names":["PreviewFeature","type","showIcon","t","routeName","orgSlug","withSentry","projectSlug","tmplBase","tmpl","AsyncView","AsyncComponent","getTitle","render","title","this","renderComponent","ProjectHpkpReports","getEndpoints","orgId","projectId","props","params","routeTitleGen","getInstructions","keyList","getSecurityDsn","getReportOnlyInstructions","renderBody","state","withPadding","tct","link","href","DEFAULT_ENDPOINT","endpoint","length","dsn","security","getDynamicText","value","fixed","ReportUri","to","inline","flexibleControlStateSize"],"sourceRoot":""}