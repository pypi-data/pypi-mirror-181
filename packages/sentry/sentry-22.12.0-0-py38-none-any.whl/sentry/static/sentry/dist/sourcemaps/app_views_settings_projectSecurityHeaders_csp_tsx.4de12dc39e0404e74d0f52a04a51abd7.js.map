{"version":3,"file":"chunks/app_views_settings_projectSecurityHeaders_csp_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"+gBASA,MAAMA,GACJ,E,8FAAA,IAAC,IAAK,CAACC,KAAK,QAAQC,UAAQ,YACzBC,EAAAA,EAAAA,GAAE,4DA8DP,MAAMC,UAAeC,EAAAA,UAGnBC,SACE,MAAM,aACJC,EAAY,OACZC,EAAM,OACNC,EAAM,WACNC,EAAU,YACVC,EAAW,sBACXC,EAAqB,SACrBC,GACEC,KAAKC,OAEFN,OAAQO,GAAaT,GAAgB,CAACE,OAAQ,IAG/CQ,GAAaR,GAAUA,EAFdC,EAAa,QAAU,SAEMQ,GAAOF,EAAUG,SAASD,KAChEE,KAAkBZ,EAAOa,OAAQb,EAAOa,KAAKV,aAE7CW,EAAgC,CACpCL,YACAG,gBAGId,EAASW,KAAeN,GAAeS,GAE7C,OAAKd,GAA2C,mBAA1BM,GAGjBN,GAAUM,EACNZ,GAGLuB,EAAAA,EAAAA,GAA4BV,GACvBA,EAASS,GAGXhB,EAASO,EAAW,KAVlBD,EAAsBU,EAWjC,EAvCIlB,EAAM,6BAANA,EAAM,eA3BuB,CACjCQ,uBAAuB,EACvBD,aAAa,EACbD,YAAY,EACZD,OAAQ,KAiEV,SAAee,EAAAA,EAAAA,IAAiBC,EAAAA,EAAAA,GAAWrB,G,iOC5G3C,MAAMsB,EAAiB,QAAC,KAACzB,EAAO,QAAc,SAC5C,QAAC,IAAK,CAACA,KAAMA,EAAMC,UAAQ,YACxBC,EAAAA,EAAAA,GACC,+FAEI,EALJuB,EAAc,6BAQpB,S,oHCXO,MAAMC,EAAQ,4CAsCrB,EApCqC,CACnC,CAEEC,MAAO,eACPC,OAAQ,CACN,CACEC,KAAM,sCACN7B,KAAM,UAEN8B,OAAO5B,EAAAA,EAAAA,GAAE,+BACT6B,MAAM7B,EAAAA,EAAAA,GACJ,2EAEF8B,QAASC,IAAQ,CAAEC,QAASD,KAK9B,CACEJ,KAAM,6BACN7B,KAAM,SACNmC,WAAW,EACXC,UAAU,EACVC,KAAM,EACNC,YAAa,6CACbR,OAAO5B,EAAAA,EAAAA,GAAE,8BACT6B,MAAM7B,EAAAA,EAAAA,GACJ,oGAEFqC,WAAWrC,EAAAA,EAAAA,GAAE,6CACb8B,QAASC,IAAQ,CAAEC,QAASD,O,0DCxBpC,QAZA,SACEO,EACAC,GAGQ,IAFRC,IAAsB,UAAH,+CACnBC,EAAoB,uCAEpB,MAAMC,EAAY,GAAEJ,OAAeC,IAC7BI,EAAOF,EAAe,GAAEC,OAAcD,IAAgBC,EAE5D,OAAOF,EAAc,GAAEG,aAAkBA,CAC3C,C,wPCJe,MAAMC,UAGXC,EAAAA,EACRC,WACE,MAAO,EACT,CAEA3C,SACE,OACE,QAAC,IAAmB,CAACsB,MAAOd,KAAKmC,WAAW,SACzCnC,KAAKoC,mBAGZ,EAdmBH,EAAS,uB,isBCmBf,MAAMI,UAA0BJ,EAAAA,EAC7CK,eACE,MAAM,MAACC,EAAK,UAAEC,GAAaxC,KAAKC,MAAMwC,OACtC,MAAO,CACL,CAAC,UAAY,aAAYF,KAASC,WAClC,CAAC,UAAY,aAAYD,KAASC,MAEtC,CAEAL,WACE,MAAM,UAACK,GAAaxC,KAAKC,MAAMwC,OAC/B,OAAOC,EAAAA,EAAAA,IAAcrD,EAAAA,EAAAA,GAAE,iCAAkCmD,GAAW,EACtE,CAEAG,gBAAgBC,GACd,MACE,kVAOAC,EAAAA,EAAAA,GAAeD,GAPf,0BAWJ,CAEAE,0BAA0BF,GACxB,MACE,4JAIAC,EAAAA,EAAAA,GAAeD,GAJf,0BAQJ,CAEAG,aACE,MAAM,MAACR,EAAK,UAAEC,GAAaxC,KAAKC,MAAMwC,QAChC,QAACO,EAAO,QAAEJ,GAAW5C,KAAKiD,MAChC,OAAKL,GAAYI,GAKf,0BACE,QAAC,IAAkB,CAAClC,OAAOzB,EAAAA,EAAAA,GAAE,8BAE7B,QAAC,IAAc,KAEf,QAAC,IAAS,CAACuD,QAASA,EAASL,MAAOA,EAAOC,UAAWA,KAEtD,QAAC,IAAI,CACHU,YAAU,EACVC,UAAU,MACVC,YAAaJ,EAAQ3B,QACrBgC,YAAc,aAAYd,KAASC,KAAa,UAEhD,QAAC,IAAM,CAAC7C,OAAQ,CAAC,iBAAiB,SAC/B,QAAC,UAACQ,GAAU,SAAK,QAAC,IAAQ,CAACmD,UAAWnD,EAAWoD,MAAOC,EAAAA,SAAc,OAI3E,QAAC,KAAK,YACJ,QAAC,KAAW,WAAEnE,EAAAA,EAAAA,GAAE,YAEhB,QAAC,IAAS,CAACoE,aAAW,aACpB,uBACGC,EAAAA,EAAAA,IACE,+ZAMD,CACEC,MACE,QAAC,IAAY,CAACC,KAAK,+DAM3B,uBACGF,EAAAA,EAAAA,IACE,sMAGD,CACEG,KAAK,gBAAM/C,MAAM,iCAKvB,uBACGzB,EAAAA,EAAAA,GACC,gFAGJ,wBAAMW,KAAK2C,gBAAgBC,MAE3B,uBACGvD,EAAAA,EAAAA,GAAG,8HAGN,wBAAMW,KAAK8C,0BAA0BF,MAErC,uBACGc,EAAAA,EAAAA,IACE,qPAGD,CACEC,MACE,aAAGC,KAAK,0FAzEf,IAkFX,E,2aChJF,MAAME,EAAmB,kDAElB,SAASjB,EAAeD,GAC7B,MAAMmB,EAAWnB,EAAQoB,OAASpB,EAAQ,GAAGqB,IAAIC,SAAWJ,EAC5D,OAAOK,EAAAA,EAAAA,GAAe,CACpBC,MAAOL,EACPM,MAAOP,GAEX,CAQe,SAASQ,EAAU,GAAoC,IAApC,QAAC1B,EAAO,MAAEL,EAAK,UAAEC,GAAiB,EAClE,OACE,QAAC,KAAK,YACJ,QAAC,KAAW,WAAEnD,EAAAA,EAAAA,GAAE,iBAChB,QAAC,IAAS,YACR,QAAC,KAAU,CAACF,KAAK,OAAM,UACpBuE,EAAAA,EAAAA,IACC,sFACA,CACEC,MAAM,QAAC,IAAI,CAACY,GAAK,aAAYhC,cAAkBC,iBAIrD,QAAC,IAAK,CAACgC,QAAQ,EAAOC,0BAAwB,YAC5C,QAAC,KAAa,UAAE5B,EAAeD,YAKzC,CAnBwB0B,EAAS,uB","sources":["webpack:///./app/components/acl/access.tsx","webpack:///./app/components/previewFeature.tsx","webpack:///./app/data/forms/cspReports.tsx","webpack:///./app/utils/routeTitle.tsx","webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/projectSecurityHeaders/csp.tsx","webpack:///./app/views/settings/projectSecurityHeaders/reportUri.tsx"],"sourcesContent":["import {Component} from 'react';\n\nimport Alert from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\nimport {Config, Organization, Scope} from 'sentry/types';\nimport {isRenderFunc} from 'sentry/utils/isRenderFunc';\nimport withConfig from 'sentry/utils/withConfig';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nconst DEFAULT_NO_ACCESS_MESSAGE = (\n  <Alert type=\"error\" showIcon>\n    {t('You do not have sufficient permissions to access this.')}\n  </Alert>\n);\n\n// Props that function children will get.\nexport type ChildRenderProps = {\n  hasAccess: boolean;\n  hasSuperuser: boolean;\n};\n\ntype ChildFunction = (props: ChildRenderProps) => React.ReactNode;\n\ntype DefaultProps = {\n  /**\n   * List of required access levels\n   */\n  access: Scope[];\n\n  /**\n   * Custom renderer function for \"no access\" message OR `true` to use\n   * default message. `false` will suppress message.\n   */\n  renderNoAccessMessage: ChildFunction | boolean;\n\n  /**\n   * Requires superuser\n   */\n  isSuperuser?: boolean;\n\n  /**\n   * Should the component require all access levels or just one or more.\n   */\n  requireAll?: boolean;\n};\n\nconst defaultProps: DefaultProps = {\n  renderNoAccessMessage: false,\n  isSuperuser: false,\n  requireAll: true,\n  access: [],\n};\n\ntype Props = {\n  /**\n   * Configuration from ConfigStore\n   */\n  config: Config;\n\n  /**\n   * Current Organization\n   */\n  organization: Organization;\n\n  /**\n   * Children can be a node or a function as child.\n   */\n  children?: React.ReactNode | ChildFunction;\n} & Partial<DefaultProps>;\n\n/**\n * Component to handle access restrictions.\n */\nclass Access extends Component<Props> {\n  static defaultProps = defaultProps;\n\n  render() {\n    const {\n      organization,\n      config,\n      access,\n      requireAll,\n      isSuperuser,\n      renderNoAccessMessage,\n      children,\n    } = this.props;\n\n    const {access: orgAccess} = organization || {access: []};\n    const method = requireAll ? 'every' : 'some';\n\n    const hasAccess = !access || access[method](acc => orgAccess.includes(acc));\n    const hasSuperuser = !!(config.user && config.user.isSuperuser);\n\n    const renderProps: ChildRenderProps = {\n      hasAccess,\n      hasSuperuser,\n    };\n\n    const render = hasAccess && (!isSuperuser || hasSuperuser);\n\n    if (!render && typeof renderNoAccessMessage === 'function') {\n      return renderNoAccessMessage(renderProps);\n    }\n    if (!render && renderNoAccessMessage) {\n      return DEFAULT_NO_ACCESS_MESSAGE;\n    }\n\n    if (isRenderFunc<ChildFunction>(children)) {\n      return children(renderProps);\n    }\n\n    return render ? children : null;\n  }\n}\n\nexport default withOrganization(withConfig(Access));\n","import Alert from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\n\ntype Props = {\n  type?: React.ComponentProps<typeof Alert>['type'];\n};\n\nconst PreviewFeature = ({type = 'info'}: Props) => (\n  <Alert type={type} showIcon>\n    {t(\n      'This feature is a preview and may change in the future. Thanks for being an early adopter!'\n    )}\n  </Alert>\n);\n\nexport default PreviewFeature;\n","// Export route to make these forms searchable by label/help\nimport {JsonFormObject} from 'sentry/components/forms/types';\nimport {t} from 'sentry/locale';\n\nexport const route = '/settings/:orgId/projects/:projectId/csp/';\n\nconst formGroups: JsonFormObject[] = [\n  {\n    // Form \"section\"/\"panel\"\n    title: 'CSP Settings',\n    fields: [\n      {\n        name: 'sentry:csp_ignored_sources_defaults',\n        type: 'boolean',\n\n        label: t('Use default ignored sources'),\n        help: t(\n          'Our default list will attempt to ignore common issues and reduce noise.'\n        ),\n        getData: data => ({options: data}),\n      },\n\n      // XXX: Org details endpoints accept these multiline inputs as a list,\n      // where as it looks like project details accepts it as a string with newlines\n      {\n        name: 'sentry:csp_ignored_sources',\n        type: 'string',\n        multiline: true,\n        autosize: true,\n        rows: 4,\n        placeholder: 'e.g.\\nfile://*\\n*.example.com\\nexample.com',\n        label: t('Additional ignored sources'),\n        help: t(\n          'Discard reports about requests from the given sources. Separate multiple entries with a newline.'\n        ),\n        extraHelp: t('Separate multiple entries with a newline.'),\n        getData: data => ({options: data}),\n      },\n    ],\n  },\n];\n\nexport default formGroups;\n","function routeTitleGen(\n  routeName: string,\n  orgSlug: string,\n  withSentry: boolean = true,\n  projectSlug?: string\n): string {\n  const tmplBase = `${routeName} - ${orgSlug}`;\n  const tmpl = projectSlug ? `${tmplBase} - ${projectSlug}` : tmplBase;\n\n  return withSentry ? `${tmpl} - Sentry` : tmpl;\n}\n\nexport default routeTitleGen;\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {RouteComponentProps} from 'react-router';\n\nimport Access from 'sentry/components/acl/access';\nimport Form from 'sentry/components/forms/form';\nimport JsonForm from 'sentry/components/forms/jsonForm';\nimport ExternalLink from 'sentry/components/links/externalLink';\nimport {Panel, PanelBody, PanelHeader} from 'sentry/components/panels';\nimport PreviewFeature from 'sentry/components/previewFeature';\nimport formGroups from 'sentry/data/forms/cspReports';\nimport {t, tct} from 'sentry/locale';\nimport {Project, ProjectKey} from 'sentry/types';\nimport routeTitleGen from 'sentry/utils/routeTitle';\nimport AsyncView from 'sentry/views/asyncView';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport ReportUri, {\n  getSecurityDsn,\n} from 'sentry/views/settings/projectSecurityHeaders/reportUri';\n\ntype Props = RouteComponentProps<{orgId: string; projectId: string}, {}>;\n\ntype State = {\n  keyList: null | ProjectKey[];\n  project: null | Project;\n} & AsyncView['state'];\n\nexport default class ProjectCspReports extends AsyncView<Props, State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    const {orgId, projectId} = this.props.params;\n    return [\n      ['keyList', `/projects/${orgId}/${projectId}/keys/`],\n      ['project', `/projects/${orgId}/${projectId}/`],\n    ];\n  }\n\n  getTitle() {\n    const {projectId} = this.props.params;\n    return routeTitleGen(t('Content Security Policy (CSP)'), projectId, false);\n  }\n\n  getInstructions(keyList: ProjectKey[]) {\n    return (\n      'def middleware(request, response):\\n' +\n      \"    response['Content-Security-Policy'] = \\\\\\n\" +\n      '        \"default-src *; \" \\\\\\n' +\n      \"        \\\"script-src 'self' 'unsafe-eval' 'unsafe-inline' cdn.example.com cdn.ravenjs.com; \\\" \\\\\\n\" +\n      \"        \\\"style-src 'self' 'unsafe-inline' cdn.example.com; \\\" \\\\\\n\" +\n      '        \"img-src * data:; \" \\\\\\n' +\n      '        \"report-uri ' +\n      getSecurityDsn(keyList) +\n      '\"\\n' +\n      '    return response\\n'\n    );\n  }\n\n  getReportOnlyInstructions(keyList: ProjectKey[]) {\n    return (\n      'def middleware(request, response):\\n' +\n      \"    response['Content-Security-Policy-Report-Only'] = \\\\\\n\" +\n      '        \"default-src \\'self\\'; \" \\\\\\n' +\n      '        \"report-uri ' +\n      getSecurityDsn(keyList) +\n      '\"\\n' +\n      '    return response\\n'\n    );\n  }\n\n  renderBody() {\n    const {orgId, projectId} = this.props.params;\n    const {project, keyList} = this.state;\n    if (!keyList || !project) {\n      return null;\n    }\n\n    return (\n      <div>\n        <SettingsPageHeader title={t('Content Security Policy')} />\n\n        <PreviewFeature />\n\n        <ReportUri keyList={keyList} orgId={orgId} projectId={projectId} />\n\n        <Form\n          saveOnBlur\n          apiMethod=\"PUT\"\n          initialData={project.options}\n          apiEndpoint={`/projects/${orgId}/${projectId}/`}\n        >\n          <Access access={['project:write']}>\n            {({hasAccess}) => <JsonForm disabled={!hasAccess} forms={formGroups} />}\n          </Access>\n        </Form>\n\n        <Panel>\n          <PanelHeader>{t('About')}</PanelHeader>\n\n          <PanelBody withPadding>\n            <p>\n              {tct(\n                `[link:Content Security Policy]\n            (CSP) is a security standard which helps prevent cross-site scripting (XSS),\n            clickjacking and other code injection attacks resulting from execution of\n            malicious content in the trusted web page context. It's enforced by browser\n            vendors, and Sentry supports capturing CSP violations using the standard\n            reporting hooks.`,\n                {\n                  link: (\n                    <ExternalLink href=\"https://en.wikipedia.org/wiki/Content_Security_Policy\" />\n                  ),\n                }\n              )}\n            </p>\n\n            <p>\n              {tct(\n                `To configure [csp:CSP] reports\n              in Sentry, you'll need to send a header from your server describing your\n              policy, as well specifying the authenticated Sentry endpoint.`,\n                {\n                  csp: <abbr title=\"Content Security Policy\" />,\n                }\n              )}\n            </p>\n\n            <p>\n              {t(\n                'For example, in Python you might achieve this via a simple web middleware'\n              )}\n            </p>\n            <pre>{this.getInstructions(keyList)}</pre>\n\n            <p>\n              {t(`Alternatively you can setup CSP reports to simply send reports rather than\n              actually enforcing the policy`)}\n            </p>\n            <pre>{this.getReportOnlyInstructions(keyList)}</pre>\n\n            <p>\n              {tct(\n                `We recommend setting this up to only run on a percentage of requests, as\n              otherwise you may find that you've quickly exhausted your quota. For more\n              information, take a look at [link:the article on html5rocks.com].`,\n                {\n                  link: (\n                    <a href=\"http://www.html5rocks.com/en/tutorials/security/content-security-policy/\" />\n                  ),\n                }\n              )}\n            </p>\n          </PanelBody>\n        </Panel>\n      </div>\n    );\n  }\n}\n","import Field from 'sentry/components/forms/field';\nimport Link from 'sentry/components/links/link';\nimport {Panel, PanelAlert, PanelBody, PanelHeader} from 'sentry/components/panels';\nimport TextCopyInput from 'sentry/components/textCopyInput';\nimport {t, tct} from 'sentry/locale';\nimport {ProjectKey} from 'sentry/types';\nimport getDynamicText from 'sentry/utils/getDynamicText';\n\nconst DEFAULT_ENDPOINT = 'https://sentry.example.com/api/security-report/';\n\nexport function getSecurityDsn(keyList: ProjectKey[]) {\n  const endpoint = keyList.length ? keyList[0].dsn.security : DEFAULT_ENDPOINT;\n  return getDynamicText({\n    value: endpoint,\n    fixed: DEFAULT_ENDPOINT,\n  });\n}\n\ntype Props = {\n  keyList: ProjectKey[];\n  orgId: string;\n  projectId: string;\n};\n\nexport default function ReportUri({keyList, orgId, projectId}: Props) {\n  return (\n    <Panel>\n      <PanelHeader>{t('Report URI')}</PanelHeader>\n      <PanelBody>\n        <PanelAlert type=\"info\">\n          {tct(\n            \"We've automatically pulled these credentials from your available [link:Client Keys]\",\n            {\n              link: <Link to={`/settings/${orgId}/projects/${projectId}/keys/`} />,\n            }\n          )}\n        </PanelAlert>\n        <Field inline={false} flexibleControlStateSize>\n          <TextCopyInput>{getSecurityDsn(keyList)}</TextCopyInput>\n        </Field>\n      </PanelBody>\n    </Panel>\n  );\n}\n"],"names":["DEFAULT_NO_ACCESS_MESSAGE","type","showIcon","t","Access","Component","render","organization","config","access","requireAll","isSuperuser","renderNoAccessMessage","children","this","props","orgAccess","hasAccess","acc","includes","hasSuperuser","user","renderProps","isRenderFunc","withOrganization","withConfig","PreviewFeature","route","title","fields","name","label","help","getData","data","options","multiline","autosize","rows","placeholder","extraHelp","routeName","orgSlug","withSentry","projectSlug","tmplBase","tmpl","AsyncView","AsyncComponent","getTitle","renderComponent","ProjectCspReports","getEndpoints","orgId","projectId","params","routeTitleGen","getInstructions","keyList","getSecurityDsn","getReportOnlyInstructions","renderBody","project","state","saveOnBlur","apiMethod","initialData","apiEndpoint","disabled","forms","formGroups","withPadding","tct","link","href","csp","DEFAULT_ENDPOINT","endpoint","length","dsn","security","getDynamicText","value","fixed","ReportUri","to","inline","flexibleControlStateSize"],"sourceRoot":""}