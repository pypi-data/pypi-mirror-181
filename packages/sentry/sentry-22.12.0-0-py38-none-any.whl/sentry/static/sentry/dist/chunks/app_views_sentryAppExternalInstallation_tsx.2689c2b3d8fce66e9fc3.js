(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_sentryAppExternalInstallation_tsx"],{"./app/actionCreators/sentryAppInstallations.tsx":(e,t,n)=>{"use strict";n.d(t,{G:()=>a,W:()=>i});var s=n("./app/actionCreators/indicator.tsx"),r=n("./app/locale.tsx");function a(e,t,n){(0,s.E3)();const a=e.requestPromise(`/organizations/${t}/sentry-app-installations/`,{method:"POST",data:{slug:n.slug}});return a.then((()=>(0,s.B8)()),(()=>(0,s.Iw)((0,r.t)("Unable to install %s",n.name)))),a}function i(e,t){(0,s.E3)();const n=e.requestPromise(`/sentry-app-installations/${t.uuid}/`,{method:"DELETE"}),a=t.app.slug.charAt(0).toUpperCase()+t.app.slug.slice(1);return n.then((()=>{(0,s.S9)((0,r.t)("%s successfully uninstalled.",a))}),(()=>(0,s.B8)())),n}},"./app/components/acl/access.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/react/index.js")),a=n("./app/components/alert.tsx"),i=n("./app/locale.tsx"),o=n("./app/utils/isRenderFunc.tsx"),l=n("./app/utils/withConfig.tsx"),c=n("./app/utils/withOrganization.tsx");const p=(0,n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js").tZ)(a.Z,{type:"error",showIcon:!0,children:(0,i.t)("You do not have sufficient permissions to access this.")});class d extends r.Component{render(){const{organization:e,config:t,access:n,requireAll:s,isSuperuser:r,renderNoAccessMessage:a,children:i}=this.props,{access:l}=e||{access:[]},c=!n||n[s?"every":"some"]((e=>l.includes(e))),d=!(!t.user||!t.user.isSuperuser),g={hasAccess:c,hasSuperuser:d},u=c&&(!r||d);return u||"function"!=typeof a?!u&&a?p:(0,o.l)(i)?i(g):u?i:null:a(g)}}d.displayName="Access",(0,s.Z)(d,"defaultProps",{renderNoAccessMessage:!1,isSuperuser:!1,requireAll:!0,access:[]});const g=(0,c.Z)((0,l.Z)(d))},"./app/components/narrowLayout.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=n("../node_modules/react/index.js"),a=n("./app/actionCreators/account.tsx"),i=n("./app/icons/index.tsx"),o=n("./app/locale.tsx"),l=n("./app/utils/useApi.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{maxWidth:t,showLogout:n,children:s}=e;const p=(0,l.Z)();return(0,r.useEffect)((()=>(document.body.classList.add("narrow"),()=>document.body.classList.remove("narrow"))),[]),(0,c.BX)("div",{className:"app",children:[(0,c.tZ)("div",{className:"pattern-bg"}),(0,c.tZ)("div",{className:"container",style:{maxWidth:t},children:(0,c.BX)("div",{className:"box box-modal",children:[(0,c.BX)("div",{className:"box-header",children:[(0,c.tZ)("a",{href:"/",children:(0,c.tZ)(i.iW,{size:"lg"})}),n&&(0,c.tZ)("a",{className:"logout pull-right",onClick:async function(){await(0,a.kS)(p),window.location.assign("/auth/login")},children:(0,c.tZ)(d,{children:(0,o.t)("Sign out")})})]}),(0,c.tZ)("div",{className:"box-content with-padding",children:s})]})})]})}p.displayName="NarrowLayout";const d=(0,s.Z)("span",{target:"eaq1ri90"})("font-size:",(e=>e.theme.fontSizeLarge),";"),g=p},"./app/components/sentryAppIcon.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var s=n("./app/components/avatar/sentryAppAvatar.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=e=>{let{sentryApp:t,size:n}=e;return(0,r.tZ)(s.Z,{sentryApp:t,size:n,isColor:!0})};a.displayName="SentryAppIcon";const i=a},"./app/utils/consolidatedScopes.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>y,m:()=>h}),n("../node_modules/core-js/modules/es.array.includes.js");var s=n("../node_modules/lodash/groupBy.js"),r=n.n(s),a=n("../node_modules/lodash/invertBy.js"),i=n.n(a),o=n("../node_modules/lodash/pick.js"),l=n.n(o);const c={read:0,write:1,admin:2},p={project:"Project",team:"Team",release:"Release",event:"Event",org:"Organization",member:"Member"},d={Project:"no-access",Team:"no-access",Release:"no-access",Event:"no-access",Organization:"no-access",Member:"no-access"},g="project:releases",u=e=>{const t=e.split(":")[1];return c[t]},m=(e,t)=>u(e)-u(t);function h(e){const t={...d};let n=[...e];var s;return e.includes(g)&&(t.Release="admin",n=e.filter((e=>e!==g))),(s=n,Object.values(r()(s,(e=>e.split(":")[0]))).map((e=>e.sort(m))).map((e=>e.pop()))).forEach((e=>{if(e){const[n,s]=e.split(":");t[p[n]]=s}})),t}function y(e){const t=h(e);return{read:[],write:[],admin:[],...l()(i()(t),["read","write","admin"])}}},"./app/views/asyncView.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var s=n("./app/components/asyncComponent.tsx"),r=n("./app/components/sentryDocumentTitle.tsx"),a=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends s.Z{getTitle(){return""}render(){return(0,a.tZ)(r.Z,{title:this.getTitle(),children:this.renderComponent()})}}i.displayName="AsyncView"},"./app/views/sentryAppExternalInstallation.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>R});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(n("../node_modules/core-js/modules/es.array.includes.js"),n("./app/actionCreators/indicator.tsx")),i=n("./app/actionCreators/sentryAppInstallations.tsx"),o=n("./app/components/alert.tsx"),l=n("./app/components/avatar/organizationAvatar.tsx"),c=n("./app/components/forms/controls/selectControl.tsx"),p=n("./app/components/forms/field/index.tsx"),d=n("../node_modules/react/index.js"),g=n("./app/components/acl/access.tsx"),u=n("./app/components/asyncComponent.tsx"),m=n("./app/components/button.tsx"),h=n("./app/components/circleIndicator.tsx"),y=n("./app/components/sentryAppIcon.tsx"),Z=n("./app/components/tag.tsx"),x=n("./app/icons/index.tsx"),A=n("./app/locale.tsx"),w=n("./app/styles/space.tsx"),f=n("./app/utils/consolidatedScopes.tsx"),b=n("./app/utils/integrationUtil.tsx"),v=n("./app/utils/marked.tsx"),z=n("./app/utils/recordSentryAppInteraction.tsx"),j=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class _ extends u.Z{componentDidUpdate(e){this.props.organization.id!==e.organization.id&&this.trackOpened()}componentDidMount(){this.trackOpened()}trackOpened(){const{sentryApp:e,organization:t,isInstalled:n}=this.props;(0,z.E)(e.slug,"sentry_app_viewed"),(0,b.Db)("integrations.install_modal_opened",{integration_type:"sentry_app",integration:e.slug,already_installed:n,view:"external_install",integration_status:e.status,organization:t},{startSession:!0})}getEndpoints(){const{sentryApp:e}=this.props;return[["featureData",`/sentry-apps/${e.slug}/features/`]]}featureTags(e){return e.map((e=>{const t=e.featureGate.replace(/integrations/g,"");return(0,j.tZ)(M,{children:t.replace(/-/g," ")},t)}))}get permissions(){return(0,f.A)(this.props.sentryApp.scopes)}async onInstall(){const{onInstall:e}=this.props;try{await e()}catch(e){}}renderPermissions(){const e=this.permissions;return 0===Object.keys(e).filter((t=>e[t].length>0)).length?null:(0,j.BX)(d.Fragment,{children:[(0,j.tZ)(P,{children:"Permissions"}),e.read.length>0&&(0,j.BX)(E,{children:[(0,j.tZ)(T,{}),(0,j.tZ)(C,{children:(0,A._N)("[read] access to [resources] resources",{read:(0,j.tZ)("strong",{children:"Read"}),resources:e.read.join(", ")})},"read")]}),e.write.length>0&&(0,j.BX)(E,{children:[(0,j.tZ)(T,{}),(0,j.tZ)(C,{children:(0,A._N)("[read] and [write] access to [resources] resources",{read:(0,j.tZ)("strong",{children:"Read"}),write:(0,j.tZ)("strong",{children:"Write"}),resources:e.write.join(", ")})},"write")]}),e.admin.length>0&&(0,j.BX)(E,{children:[(0,j.tZ)(T,{}),(0,j.tZ)(C,{children:(0,A._N)("[admin] access to [resources] resources",{admin:(0,j.tZ)("strong",{children:"Admin"}),resources:e.admin.join(", ")})},"admin")]})]})}renderBody(){const{sentryApp:e,closeModal:t,isInstalled:n,organization:s}=this.props,{featureData:r}=this.state,a=(r||[]).map((e=>({featureGate:e.featureGate,description:(0,j.tZ)("span",{dangerouslySetInnerHTML:{__html:(0,v.A)(e.description)}})}))),{FeatureList:i,IntegrationFeatures:o}=(0,b.bh)(),l=e.overview||"",c={organization:s,features:a};return(0,j.BX)(d.Fragment,{children:[(0,j.BX)(S,{children:[(0,j.tZ)(y.Z,{sentryApp:e,size:50}),(0,j.BX)(I,{children:[(0,j.tZ)(O,{children:e.name}),!!a.length&&(0,j.tZ)(q,{children:this.featureTags(a)})]})]}),(0,j.tZ)(N,{dangerouslySetInnerHTML:{__html:(0,v.Z)(l)}}),(0,j.tZ)(i,{...c,provider:{...e,key:e.slug}}),(0,j.tZ)(o,{...c,children:r=>{let{disabled:a,disabledReason:i}=r;return(0,j.BX)(d.Fragment,{children:[!a&&this.renderPermissions(),(0,j.BX)(X,{children:[(0,j.tZ)(B,{children:(0,A.t)("Authored By %s",e.author)}),(0,j.BX)("div",{children:[a&&(0,j.tZ)(k,{reason:i}),(0,j.tZ)(m.ZP,{size:"sm",onClick:t,children:(0,A.t)("Cancel")}),(0,j.tZ)(g.Z,{organization:s,access:["org:integrations"],children:e=>{let{hasAccess:t}=e;return t&&(0,j.tZ)(m.ZP,{size:"sm",priority:"primary",disabled:n||a,onClick:()=>this.onInstall(),style:{marginLeft:(0,w.Z)(1)},"data-test-id":"install",children:(0,A.t)("Accept & Install")})}})]})]})]})}})]})}}const S=(0,r.Z)("div",{target:"e1hor01j12"})("display:grid;grid-template-columns:max-content 1fr;gap:",(0,w.Z)(1),";align-items:center;margin-bottom:",(0,w.Z)(2),";"),I=(0,r.Z)("div",{target:"e1hor01j11"})({name:"4runny",styles:"display:grid;grid-template-rows:max-content max-content;align-items:start"}),O=(0,r.Z)("div",{target:"e1hor01j10"})({name:"1k5apmu",styles:"font-weight:bold;font-size:1.4em"}),N=(0,r.Z)("div",{target:"e1hor01j9"})("margin-bottom:",(0,w.Z)(2),";li{margin-bottom:6px;}"),B=(0,r.Z)("div",{target:"e1hor01j8"})("color:",(e=>e.theme.gray300),";"),k=(0,r.Z)((e=>{let{reason:t,...n}=e;return(0,j.BX)("div",{...n,children:[(0,j.tZ)(x.Gy,{color:"errorText",size:"1.5em"}),t]})}),{target:"e1hor01j7"})("display:grid;align-items:center;flex:1;grid-template-columns:max-content 1fr;color:",(e=>e.theme.errorText),";font-size:0.9em;"),C=(0,r.Z)("p",{target:"e1hor01j6"})({name:"1x9ekz7",styles:"margin:0px 6px"}),E=(0,r.Z)("div",{target:"e1hor01j5"})({name:"zjik7",styles:"display:flex"}),X=(0,r.Z)("div",{target:"e1hor01j4"})({name:"1348q18",styles:"display:flex;padding:20px 30px;border-top:1px solid #e2dee6;margin:20px -30px -30px;justify-content:space-between"}),P=(0,r.Z)("p",{target:"e1hor01j3"})("margin-bottom:",(0,w.Z)(1),";font-weight:bold;"),T=(0,r.Z)((e=>(0,j.tZ)(h.Z,{size:7,...e})),{target:"e1hor01j2"})("margin-top:7px;color:",(e=>e.theme.success),";"),q=(0,r.Z)("div",{target:"e1hor01j1"})("margin:-",(0,w.Z)(.5),";"),M=(0,r.Z)(Z.Z,{target:"e1hor01j0"})("padding:",(0,w.Z)(.5),";");var L=n("./app/components/narrowLayout.tsx"),D=n("./app/utils/queryString.tsx"),F=n("./app/views/asyncView.tsx");class R extends F.Z{constructor(){super(...arguments),(0,s.Z)(this,"disableErrorReport",!1),(0,s.Z)(this,"hasAccess",(e=>e.access.includes("org:integrations"))),(0,s.Z)(this,"onClose",(()=>{const{selectedOrgSlug:e}=this.state,t=document.referrer||`/settings/${e}/integrations/`;window.location.assign(t)})),(0,s.Z)(this,"onInstall",(async()=>{const{organization:e,sentryApp:t}=this.state;if(!e||!t)return;(0,b.Db)("integrations.installation_start",{integration_type:"sentry_app",integration:t.slug,view:"external_install",integration_status:t.status,organization:e});const n=await(0,i.G)(this.api,e.slug,t);if("installed"===n.status&&(0,b.Db)("integrations.installation_complete",{integration_type:"sentry_app",integration:t.slug,view:"external_install",integration_status:t.status,organization:e}),t.redirectUrl){const s={installationId:n.uuid,code:n.code,orgSlug:e.slug},r=(0,D.Yi)(t.redirectUrl,s);return window.location.assign(r)}return this.onClose()})),(0,s.Z)(this,"onSelectOrg",(async e=>{this.setState({selectedOrgSlug:e,reloading:!0});try{const[t,n]=await Promise.all([this.api.requestPromise(`/organizations/${e}/`),this.api.requestPromise(`/organizations/${e}/sentry-app-installations/`)]),s=n.map((e=>e.app.slug)).includes(this.sentryAppSlug);this.setState({organization:t,isInstalled:s,reloading:!1})}catch(e){(0,a.Iw)((0,A.t)("Failed to retrieve organization or integration details")),this.setState({reloading:!1})}})),(0,s.Z)(this,"onRequestSuccess",(e=>{let{stateKey:t,data:n}=e;"organizations"===t&&1===n.length&&this.onSelectOrg(n[0].slug)}))}getDefaultState(){return{...super.getDefaultState(),selectedOrgSlug:null,organization:null,organizations:[],reloading:!1}}getEndpoints(){return[["organizations","/organizations/"],["sentryApp",`/sentry-apps/${this.sentryAppSlug}/`]]}getTitle(){return(0,A.t)("Choose Installation Organization")}get sentryAppSlug(){return this.props.params.sentryAppSlug}get isSingleOrg(){return 1===this.state.organizations.length}get isSentryAppInternal(){const{sentryApp:e}=this.state;return e&&"internal"===e.status}get isSentryAppUnavailableForOrg(){const{sentryApp:e,selectedOrgSlug:t}=this.state;return t&&e?.owner?.slug!==t&&"unpublished"===e.status}get disableInstall(){const{reloading:e,isInstalled:t}=this.state;return t||e||this.isSentryAppUnavailableForOrg}getOptions(){return this.state.organizations.map((e=>({value:e.slug,label:(0,j.BX)("div",{children:[(0,j.tZ)(l.Z,{organization:e}),(0,j.tZ)(V,{children:e.slug})]},e.slug)})))}renderInternalAppError(){const{sentryApp:e}=this.state;return(0,j.tZ)(o.Z,{type:"error",showIcon:!0,children:(0,A._N)("Integration [sentryAppName] is an internal integration. Internal integrations are automatically installed",{sentryAppName:(0,j.tZ)("strong",{children:e.name})})})}checkAndRenderError(){const{organization:e,selectedOrgSlug:t,isInstalled:n,sentryApp:s}=this.state;if(t&&e&&!this.hasAccess(e))return(0,j.BX)(o.Z,{type:"error",showIcon:!0,children:[(0,j.tZ)("p",{children:(0,A._N)("You do not have permission to install integrations in\n          [organization]. Ask an organization owner or manager to\n          visit this page to finish installing this integration.",{organization:(0,j.tZ)("strong",{children:e.slug})})}),(0,j.tZ)(U,{children:window.location.href})]});if(n&&e)return(0,j.tZ)(o.Z,{type:"error",showIcon:!0,children:(0,A._N)("Integration [sentryAppName] already installed for [organization]",{organization:(0,j.tZ)("strong",{children:e.name}),sentryAppName:(0,j.tZ)("strong",{children:s.name})})});if(this.isSentryAppUnavailableForOrg){const e=s?.owner?.slug??"another organization";return(0,j.tZ)(o.Z,{type:"error",showIcon:!0,children:(0,A._N)("Integration [sentryAppName] is an unpublished integration for [otherOrg]. An unpublished integration can only be installed on the organization which created it.",{sentryAppName:(0,j.tZ)("strong",{children:s.name}),otherOrg:(0,j.tZ)("strong",{children:e})})})}return null}renderMultiOrgView(){const{selectedOrgSlug:e,sentryApp:t}=this.state;return(0,j.BX)("div",{children:[(0,j.tZ)("p",{children:(0,A._N)("Please pick a specific [organization:organization] to install [sentryAppName]",{organization:(0,j.tZ)("strong",{}),sentryAppName:(0,j.tZ)("strong",{children:t.name})})}),(0,j.tZ)(p.Z,{label:(0,A.t)("Organization"),inline:!1,stacked:!0,required:!0,children:()=>(0,j.tZ)(c.Z,{onChange:e=>{let{value:t}=e;return this.onSelectOrg(t)},value:e,placeholder:(0,A.t)("Select an organization"),options:this.getOptions()})})]})}renderSingleOrgView(){const{organizations:e,sentryApp:t}=this.state,n=e[0].name;return(0,j.tZ)("div",{children:(0,j.tZ)("p",{children:(0,A._N)("You are installing [sentryAppName] for organization [organization]",{organization:(0,j.tZ)("strong",{children:n}),sentryAppName:(0,j.tZ)("strong",{children:t.name})})})})}renderMainContent(){const{organization:e,sentryApp:t}=this.state;return(0,j.BX)("div",{children:[(0,j.tZ)(G,{children:this.isSingleOrg?this.renderSingleOrgView():this.renderMultiOrgView()}),this.checkAndRenderError(),e&&(0,j.tZ)(_,{sentryApp:t,organization:e,onInstall:this.onInstall,closeModal:this.onClose,isInstalled:this.disableInstall})]})}renderBody(){return(0,j.tZ)(L.Z,{children:(0,j.BX)($,{children:[(0,j.tZ)("h3",{children:(0,A.t)("Finish integration installation")}),this.isSentryAppInternal?this.renderInternalAppError():this.renderMainContent()]})})}}const U=(0,r.Z)("pre",{target:"e14lyx9n3"})({name:"1iee5id",styles:"margin-bottom:0;background:#fbe3e1"}),V=(0,r.Z)("span",{target:"e14lyx9n2"})({name:"1qkltea",styles:"margin-left:5px"}),$=(0,r.Z)("div",{target:"e14lyx9n1"})({name:"qkomnt",styles:"margin-bottom:40px"}),G=(0,r.Z)("div",{target:"e14lyx9n0"})({name:"1azpx8r",styles:"margin-bottom:20px"})},"../node_modules/lodash/invertBy.js":(e,t,n)=>{var s=n("../node_modules/lodash/_baseIteratee.js"),r=n("../node_modules/lodash/_createInverter.js"),a=Object.prototype,i=a.hasOwnProperty,o=a.toString,l=r((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=o.call(t)),i.call(e,t)?e[t].push(n):e[t]=[n]}),s);e.exports=l}}]);
//# sourceMappingURL=../sourcemaps/app_views_sentryAppExternalInstallation_tsx.3c183c4b04758984f255aa0a04d72057.js.map