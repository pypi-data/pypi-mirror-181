"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dataExport_dataDownload_tsx"],{"./app/components/dataExport.tsx":(e,t,r)=>{r.d(t,{ZP:()=>y,tD:()=>h});var n=r("../node_modules/react/index.js"),o=r("../node_modules/lodash/debounce.js"),s=r.n(o),i=r("./app/actionCreators/indicator.tsx"),a=r("./app/components/acl/feature.tsx"),d=r("./app/components/button.tsx"),l=r("./app/locale.tsx"),c=r("./app/utils/withApi.tsx"),p=r("./app/utils/withOrganization.tsx"),u=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let h;function m(e){let{api:t,children:r,disabled:o,organization:c,payload:p,icon:h}=e;const m=(0,n.useRef)(!1),[y,w]=(0,n.useState)(!1);(0,n.useEffect)((()=>{y&&w(!1)}),[p.queryType,p.queryInfo]),(0,n.useEffect)((()=>()=>{m.current=!0}),[]);const x=(0,n.useCallback)((()=>{w(!0),t.requestPromise(`/organizations/${c.slug}/data-export/`,{includeAllArgs:!0,method:"POST",data:{query_type:p.queryType,query_info:p.queryInfo}}).then((e=>{let[t,r,n]=e;m.current||(0,i.S9)(201===n?.status?(0,l.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,l.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((e=>{if(m.current)return;const t=e?.responseJSON?.detail??(0,l.t)("We tried our hardest, but we couldn't export your data. Give it another go.");(0,i.Iw)(t),w(!1)}))}),[p.queryInfo,p.queryType,c.slug,t]);return(0,u.tZ)(a.Z,{features:["organizations:discover-query"],children:y?(0,u.tZ)(d.ZP,{size:"sm",priority:"default",title:(0,l.t)("You can get on with your life. We'll email you when your data's ready."),disabled:!0,icon:h,children:(0,l.t)("We're working on it...")}):(0,u.tZ)(d.ZP,{onClick:s()(x,500),disabled:o||!1,size:"sm",priority:"default",title:(0,l.t)("Put your data to work. Start your export and we'll email you when it's finished."),icon:h,children:r||(0,l.t)("Export All to CSV")})})}!function(e){e.IssuesByTag="Issues-by-Tag",e.Discover="Discover"}(h||(h={})),m.displayName="DataExport";const y=(0,c.Z)((0,p.Z)(m))},"./app/views/asyncView.tsx":(e,t,r)=>{r.d(t,{Z:()=>i});var n=r("./app/components/asyncComponent.tsx"),o=r("./app/components/sentryDocumentTitle.tsx"),s=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends n.Z{getTitle(){return""}render(){return(0,s.tZ)(o.Z,{title:this.getTitle(),children:this.renderComponent()})}}i.displayName="AsyncView"},"./app/views/dataExport/dataDownload.tsx":(e,t,r)=>{r.r(t),r.d(t,{DownloadStatus:()=>w,default:()=>f});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("../node_modules/react/index.js"),i=r("../node_modules/react-router/es/index.js"),a=r("./app/components/button.tsx"),d=r("./app/components/dataExport.tsx"),l=r("./app/components/dateTime.tsx"),c=r("./app/icons/index.tsx"),p=r("./app/locale.tsx"),u=r("./app/styles/space.tsx"),h=r("./app/views/asyncView.tsx"),m=r("./app/views/auth/layout.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let w;!function(e){e.Early="EARLY",e.Valid="VALID",e.Expired="EXPIRED"}(w||(w={}));class x extends h.Z{constructor(){super(...arguments),(0,n.Z)(this,"disableErrorReport",!1)}getTitle(){return(0,p.t)("Download Center")}getEndpoints(){const{orgId:e,dataExportId:t}=this.props.params;return[["download",`/organizations/${e}/data-export/${t}/`]]}getActionLink(e){const{orgId:t}=this.props.params;switch(e){case d.tD.IssuesByTag:return`/organizations/${t}/issues/`;case d.tD.Discover:return`/organizations/${t}/discover/queries/`;default:return"/"}}renderDate(e){if(!e)return null;const t=new Date(e);return(0,y.tZ)("strong",{children:(0,y.tZ)(l.Z,{date:t})})}renderEarly(){return(0,y.BX)(s.Fragment,{children:[(0,y.tZ)(Z,{children:(0,y.BX)("h3",{children:[(0,p.t)("What are"),(0,y.tZ)("i",{children:(0,p.t)(" you ")}),(0,p.t)("doing here?")]})}),(0,y.BX)(g,{children:[(0,y.tZ)("p",{children:(0,p.t)("Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.")}),(0,y.tZ)("p",{children:(0,p.t)("Close this window and we'll email you when your download is ready.")})]})]})}renderExpired(){const{query:e}=this.state.download,t=this.getActionLink(e.type);return(0,y.BX)(s.Fragment,{children:[(0,y.tZ)(Z,{children:(0,y.tZ)("h3",{children:(0,p.t)("This is awkward.")})}),(0,y.BX)(g,{children:[(0,y.tZ)("p",{children:(0,p.t)("That link expired, so your download doesn't live here anymore. Just picked up one day and left town.")}),(0,y.tZ)("p",{children:(0,p.t)("Make a new one with your latest data. Your old download will never see it coming.")}),(0,y.tZ)(b,{href:t,priority:"primary",children:(0,p.t)("Start a New Download")})]})]})}openInDiscover(){const{download:{query:{info:e}}}=this.state,{orgId:t}=this.props.params,r={pathname:`/organizations/${t}/discover/results/`,query:e};i.browserHistory.push(r)}renderOpenInDiscover(){const{download:{query:e={type:d.tD.IssuesByTag,info:{}}}}=this.state,{type:t=d.tD.IssuesByTag}=e;return"Discover"===t?(0,y.BX)(s.Fragment,{children:[(0,y.tZ)("p",{children:(0,p.t)("Need to make changes?")}),(0,y.tZ)(a.ZP,{priority:"primary",onClick:()=>this.openInDiscover(),children:(0,p.t)("Open in Discover")}),(0,y.tZ)("br",{})]}):null}renderValid(){const{download:{dateExpired:e,checksum:t}}=this.state,{orgId:r,dataExportId:n}=this.props.params;return(0,y.BX)(s.Fragment,{children:[(0,y.tZ)(Z,{children:(0,y.tZ)("h3",{children:(0,p.t)("All done.")})}),(0,y.BX)(g,{children:[(0,y.tZ)("p",{children:(0,p.t)("See, that wasn't so bad. Your data is all ready for download.")}),(0,y.tZ)(a.ZP,{priority:"primary",icon:(0,y.tZ)(c.Dj,{}),href:`/api/0/organizations/${r}/data-export/${n}/?download=true`,children:(0,p.t)("Download CSV")}),(0,y.BX)("p",{children:[(0,p.t)("That link won't last forever â€” it expires:"),(0,y.tZ)("br",{}),this.renderDate(e)]}),this.renderOpenInDiscover(),(0,y.BX)("p",{children:[(0,y.tZ)("small",{children:(0,y.BX)("strong",{children:["SHA1:",t]})}),(0,y.tZ)("br",{}),(0,p._N)("Need help verifying? [link].",{link:(0,y.tZ)("a",{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns",target:"_blank",rel:"noopener noreferrer",children:(0,p.t)("Check out our docs")})})]})]})]})}renderError(){const{errors:{download:e}}=this.state,t=e?.responseJSON?.detail;return(0,y.tZ)(m.Z,{children:(0,y.BX)("main",{children:[(0,y.tZ)(Z,{children:(0,y.BX)("h3",{children:[e.status," - ",e.statusText]})}),t&&(0,y.tZ)(g,{children:(0,y.tZ)("p",{children:t})})]})})}renderContent(){const{download:e}=this.state;switch(e.status){case w.Early:return this.renderEarly();case w.Expired:return this.renderExpired();default:return this.renderValid()}}renderBody(){return(0,y.tZ)(m.Z,{children:(0,y.tZ)("main",{children:this.renderContent()})})}}const Z=(0,o.Z)("header",{target:"eq2c1c22"})("border-bottom:1px solid ",(e=>e.theme.border),";padding:",(0,u.Z)(3)," 40px 0;h3{font-size:24px;margin:0 0 ",(0,u.Z)(3)," 0;}"),g=(0,o.Z)("div",{target:"eq2c1c21"})("padding:",(0,u.Z)(2)," 40px;max-width:500px;p{margin:",(0,u.Z)(1.5)," 0;}"),b=(0,o.Z)(a.ZP,{target:"eq2c1c20"})("margin-bottom:",(0,u.Z)(1.5),";"),f=x}}]);
//# sourceMappingURL=../sourcemaps/app_views_dataExport_dataDownload_tsx.d9572fa45e2ddb09916d6038a57d42d3.js.map