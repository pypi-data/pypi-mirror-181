"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dashboardsV2_dashboard_tsx"],{"./app/actionCreators/dashboards.tsx":(e,t,s)=>{s.d(t,{AK:()=>u,JR:()=>p,QL:()=>m,Y:()=>h,a_:()=>c,iM:()=>g,j2:()=>l});var i=s("../node_modules/lodash/omit.js"),a=s.n(i),o=s("./app/actionCreators/indicator.tsx"),n=s("./app/constants/pageFilters.tsx"),r=s("./app/locale.tsx"),d=s("./app/views/dashboardsV2/utils.tsx");function l(e,t){const s=e.requestPromise(`/organizations/${t}/dashboards/`,{method:"GET",query:{sort:"myDashboardsAndRecentlyViewed"}});return s.catch((e=>{const t=e?.responseJSON??null;if(t){const e=(0,d.Tk)(t,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,r.t)("Unable to fetch dashboards"))})),s}function p(e,t,s,i){const{title:n,widgets:l,projects:p,environment:c,period:u,start:h,end:g,filters:m,utc:b}=s,w=e.requestPromise(`/organizations/${t}/dashboards/`,{method:"POST",data:{title:n,widgets:l.map((e=>a()(e,["tempId"]))),duplicate:i,projects:p,environment:c,period:u,start:h,end:g,filters:m,utc:b},query:{project:p}});return w.catch((e=>{const t=e?.responseJSON??null;if(t){const e=(0,d.Tk)(t,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,r.t)("Unable to create dashboard"))})),w}function c(e,t,s){return e.requestPromise(`/organizations/${t}/dashboards/${s}/visit/`,{method:"POST"})}function u(e,t,s){const i=e.requestPromise(`/organizations/${t}/dashboards/${s}/`,{method:"GET"});return i.catch((e=>{const t=e?.responseJSON??null;if(t){const e=(0,d.Tk)(t,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,r.t)("Unable to load dashboard"))})),i}function h(e,t,s){const{title:i,widgets:n,projects:l,environment:p,period:c,start:u,end:h,filters:g,utc:m}=s,b={title:i,widgets:n.map((e=>a()(e,["tempId"]))),projects:l,environment:p,period:c,start:u,end:h,filters:g,utc:m},w=e.requestPromise(`/organizations/${t}/dashboards/${s.id}/`,{method:"PUT",data:b,query:{project:l}});return w.catch((e=>{const t=e?.responseJSON??null;if(t){const e=(0,d.Tk)(t,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,r.t)("Unable to update dashboard"))})),w}function g(e,t,s){const i=e.requestPromise(`/organizations/${t}/dashboards/${s}/`,{method:"DELETE"});return i.catch((e=>{const t=e?.responseJSON??null;if(t){const e=(0,d.Tk)(t,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,r.t)("Unable to delete dashboard"))})),i}function m(e,t,s){return e.requestPromise(`/organizations/${t}/dashboards/widgets/`,{method:"POST",data:s,query:{project:[n.mP]}})}},"./app/views/dashboardsV2/dashboard.tsx":(e,t,s)=>{s.d(t,{re:()=>$,ey:()=>U,ZP:()=>Q});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(s("../node_modules/react-grid-layout/css/styles.css"),s("../node_modules/react-resizable/css/styles.css"),s("../node_modules/react/index.js")),n=s("../node_modules/react-grid-layout/index.js"),r=s("../node_modules/react-lazyload/lib/index.js"),d=s("../node_modules/lodash/cloneDeep.js"),l=s.n(d),p=s("../node_modules/lodash/debounce.js"),c=s.n(p),u=s("../node_modules/lodash/isEqual.js"),h=s.n(u),g=s("./app/actionCreators/dashboards.tsx"),m=s("./app/actionCreators/indicator.tsx"),b=s("./app/actionCreators/members.tsx"),w=s("./app/actionCreators/tags.tsx"),y=s("./app/components/button.tsx"),x=s("./app/icons/index.tsx"),f=s("./app/locale.tsx"),Z=s("./app/styles/space.tsx"),v=s("./app/utils/theme.tsx"),D=s("./app/utils/withApi.tsx"),z=s("./app/utils/withPageFilters.tsx"),C=s("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),k=s("./app/views/dashboardsV2/types.tsx"),W=s("../node_modules/framer-motion/dist/es/render/dom/motion.mjs");const T=(0,a.Z)(W.E.div,{target:"ec3gecx0"})("position:relative;touch-action:manipulation;",(e=>"big_number"===e.displayType?`\n          /* 2 cols */\n          grid-area: span 1 / span 2;\n\n          @media (min-width: ${e.theme.breakpoints.small}) {\n            /* 4 cols */\n            grid-area: span 1 / span 1;\n          }\n\n          @media (min-width: ${e.theme.breakpoints.xlarge}) {\n            /* 6 and 8 cols */\n            grid-area: span 1 / span 2;\n          }\n        `:"\n          /* 2, 4, 6 and 8 cols */\n          grid-area: span 2 / span 2;\n        "),";");var E=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const _="add-widget-button",I={x:0,y:0,scaleX:1,scaleY:1};function j(e){let{onAddWidget:t}=e;const{setNodeRef:s,transform:i}=(0,C.nB)({disabled:!0,id:_,transition:null});return(0,E.tZ)(T,{ref:s,displayType:k.FO.BIG_NUMBER,layoutId:_,style:{originX:0,originY:0},animate:i?{x:i.x,y:i.y,scaleX:i?.scaleX&&i.scaleX<=1?i.scaleX:1,scaleY:i?.scaleY&&i.scaleY<=1?i.scaleY:1}:I,transition:{duration:.25},children:(0,E.tZ)(R,{onClick:t,children:(0,E.tZ)(S,{"data-test-id":"widget-add",icon:(0,E.tZ)(x.N_,{size:"lg",isCircled:!0,color:"inactive"}),"aria-label":(0,f.t)("Add widget")})})},"add")}j.displayName="AddWidget";const M=j,S=(0,a.Z)(y.ZP,{target:"e1sxcph31"})({name:"6ayxgl",styles:"border:none;&,&:focus,&:active,&:hover{background:transparent;box-shadow:none;}"}),R=(0,a.Z)("div",{target:"e1sxcph30"})("width:100%;height:110px;border:2px dashed ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";display:flex;align-items:center;justify-content:center;cursor:",(e=>e.onClick?"pointer":""),";");var P=s("./app/views/dashboardsV2/layoutUtils.tsx"),L=s("./app/components/panels/panelAlert.tsx"),q=s("./app/views/dashboardsV2/widgetCard/index.tsx");function O(e){const{widget:t,isEditing:s,widgetLimitReached:i,onDelete:a,onEdit:o,onDuplicate:n,isPreview:r,isMobile:d,windowWidth:l,index:p,dashboardFilters:c}=e,u={widget:t,isEditing:s,widgetLimitReached:i,onDelete:a,onEdit:o,onDuplicate:n,showContextMenu:!0,isPreview:r,index:p,dashboardFilters:c,renderErrorMessage:e=>"string"==typeof e&&(0,E.tZ)(L.Z,{type:"error",children:e}),isMobile:d,windowWidth:l,tableItemLimit:20};return(0,E.tZ)(B,{children:(0,E.tZ)(q.Z,{...u})})}O.displayName="SortableWidget";const A=O,B=(0,a.Z)("div",{target:"e12vujy00"})({name:"13udsys",styles:"height:100%"});var V=s("./app/views/dashboardsV2/utils.tsx");const $="widget-drag",N="desktop",F="mobile",U=6,H=[16,16],X={x:0,y:Number.MAX_SAFE_INTEGER},Y=parseInt(v.ZP.breakpoints.small,10),G={[F]:0,[N]:Y},J={[F]:2,[N]:U};class K extends o.Component{constructor(e){super(e),(0,i.Z)(this,"forceCheckTimeout",void 0),(0,i.Z)(this,"debouncedHandleResize",c()((()=>{this.setState({windowWidth:window.innerWidth})}),250)),(0,i.Z)(this,"handleStartAdd",(()=>{const{organization:e,router:t,location:s,paramDashboardId:i}=this.props;i?t.push({pathname:`/organizations/${e.slug}/dashboard/${i}/widget/new/`,query:{...s.query,source:k.EN.DASHBOARDS}}):t.push({pathname:`/organizations/${e.slug}/dashboards/new/widget/new/`,query:{...s.query,source:k.EN.DASHBOARDS}})})),(0,i.Z)(this,"handleUpdateComplete",(e=>t=>{const{isEditing:s,onUpdate:i,handleUpdateWidgetList:a}=this.props;let o=[...this.props.dashboard.widgets];const n=o.indexOf(e),r={...t,tempId:e.tempId};(0,P.I_)(e.displayType)!==(0,P.I_)(t.displayType)?(o[n]=(0,P.W8)(r),o=(0,P.Bb)(o)):o[n]=r,i(o),s||a(o)})),(0,i.Z)(this,"handleDeleteWidget",(e=>()=>{const{dashboard:t,onUpdate:s,isEditing:i,handleUpdateWidgetList:a}=this.props;let o=t.widgets.filter((t=>t!==e));o=(0,P.Bb)(o),s(o),i||a(o)})),(0,i.Z)(this,"handleDuplicateWidget",((e,t)=>()=>{const{dashboard:s,onUpdate:i,isEditing:a,handleUpdateWidgetList:o}=this.props,n=l()((0,P.TE)({...e,id:void 0,tempId:void 0}));let r=[...s.widgets];r.splice(t,0,n),r=(0,P.Bb)(r),i(r),a||o(r)})),(0,i.Z)(this,"handleEditWidget",(e=>()=>{const{organization:t,router:s,location:i,paramDashboardId:a}=this.props;a?s.push({pathname:`/organizations/${t.slug}/dashboard/${a}/widget/${e}/edit/`,query:{...i.query,source:k.EN.DASHBOARDS}}):s.push({pathname:`/organizations/${t.slug}/dashboards/new/widget/${e}/edit/`,query:{...i.query,source:k.EN.DASHBOARDS}})})),(0,i.Z)(this,"handleLayoutChange",((e,t)=>{const{isMobile:s}=this.state,{dashboard:i,onUpdate:a}=this.props,o=e=>{let{i:t}=e;return t!==_},n={[N]:t.desktop.filter(o),[F]:t.mobile.filter(o)};let d=(0,P.Sp)(n.desktop);const l=i.widgets.map((e=>{const t=(0,P.Yb)(e);let i=n.desktop.find((e=>{let{i:s}=e;return s===t}));if(!i){const a=(0,P.I_)(e.displayType),o={w:P.c6,h:a,minH:a,i:t},[r,l]=(0,P.Hh)(d,a);if(d=l,i={...o,...r},s){const e=n.mobile.filter((e=>{let{i:s}=e;return s!==t}));e.push({...o,...X}),n.mobile=e}}return{...e,layout:(0,P.hq)(i)}}));this.setState({layouts:n}),a(l),window.clearTimeout(this.forceCheckTimeout),this.forceCheckTimeout=window.setTimeout(r.be,400)})),(0,i.Z)(this,"handleBreakpointChange",(e=>{const{layouts:t}=this.state,{dashboard:{widgets:s}}=this.props;e!==F?this.setState({isMobile:!1}):this.setState({isMobile:!0,layouts:{...t,[F]:(0,P.VW)(t.desktop,s)}})}));const{dashboard:t}=e,s=(0,P.RI)(t.widgets);this.state={isMobile:!1,layouts:{[N]:s,[F]:(0,P.VW)(s,t.widgets)},windowWidth:window.innerWidth}}static getDerivedStateFromProps(e,t){if(t.isMobile)return null;const s=(0,P.RI)(e.dashboard.widgets);return h()(s.map(P.hq),t.layouts.desktop.map(P.hq))?null:{...t,layouts:{[N]:s,[F]:(0,P.VW)(s,e.dashboard.widgets)}}}componentDidMount(){const{newWidget:e}=this.props;window.addEventListener("resize",this.debouncedHandleResize),this.fetchTags(),e&&this.addNewWidget(),this.fetchMemberList()}componentDidUpdate(e){const{selection:t,newWidget:s}=this.props;s&&s!==e.newWidget&&this.addNewWidget(),h()(e.selection.projects,t.projects)||this.fetchMemberList()}componentWillUnmount(){window.removeEventListener("resize",this.debouncedHandleResize),window.clearTimeout(this.forceCheckTimeout)}fetchMemberList(){const{api:e,selection:t}=this.props;(0,b.MA)(e,this.props.organization.slug,t.projects?.map((e=>String(e))))}async addNewWidget(){const{api:e,organization:t,newWidget:s,handleAddCustomWidget:i,onSetNewWidget:a}=this.props;if(s)try{await(0,g.QL)(e,t.slug,s),i(s),a?.()}catch(e){(0,m.Iw)(e)}}fetchTags(){const{api:e,organization:t,selection:s}=this.props;(0,w.QK)(e,t.slug,s)}getWidgetIds(){return[...this.props.dashboard.widgets.map(((e,t)=>(0,P.$n)(e,t))),_]}renderWidget(e,t){const{isMobile:s,windowWidth:i}=this.state,{isEditing:a,widgetLimitReached:o,isPreview:n,dashboard:r,location:d}=this.props,l={widget:e,isEditing:a,widgetLimitReached:o,onDelete:this.handleDeleteWidget(e),onEdit:this.handleEditWidget(t),onDuplicate:this.handleDuplicateWidget(e,t),isPreview:n,dashboardFilters:(0,V.lM)(d)??r.filters},p=(0,P.Yb)(e);return(0,E.tZ)("div",{"data-grid":e.layout,children:(0,E.tZ)(A,{...l,isMobile:s,windowWidth:i,index:String(t)})},p)}get addWidgetLayout(){const{isMobile:e,layouts:t}=this.state;let s=X;if(!e){const e=(0,P.Sp)(t.desktop),[i]=(0,P.Hh)(e,1);s=i}return{...s,w:P.c6,h:1,isResizable:!1}}render(){const{layouts:e,isMobile:t}=this.state,{isEditing:s,dashboard:i,widgetLimitReached:a}=this.props,{widgets:o}=i,n=(0,P.Sp)(e.desktop),r=(0,P._F)(o,n),d=!t&&s;return(0,E.BX)(te,{breakpoints:G,cols:J,rowHeight:120,margin:H,draggableHandle:`.${$}`,draggableCancel:".widget-resize",layouts:e,onLayoutChange:this.handleLayoutChange,onBreakpointChange:this.handleBreakpointChange,isDraggable:d,isResizable:d,resizeHandle:(0,E.tZ)(se,{"aria-label":(0,f.t)("Resize Widget"),"data-test-id":"custom-resize-handle",className:"widget-resize",size:"xs",borderless:!0,icon:(0,E.tZ)(x.Iq,{size:"xs"})}),useCSSTransforms:!1,isBounded:!0,children:[r.map(((e,t)=>this.renderWidget(e,t))),s&&!a&&(0,E.tZ)(ee,{"data-grid":this.addWidgetLayout,children:(0,E.tZ)(M,{onAddWidget:this.handleStartAdd})},_)]})}}K.displayName="Dashboard";const Q=(0,D.Z)((0,z.Z)(K)),ee=(0,a.Z)("div",{target:"e1wa3gzn2"})("z-index:5;background-color:",(e=>e.theme.background),";"),te=(0,a.Z)((0,n.WidthProvider)(n.Responsive),{target:"e1wa3gzn1"})("margin:-",(0,Z.Z)(2),";.react-grid-item.react-grid-placeholder{background:",(e=>e.theme.purple200),";border-radius:",(e=>e.theme.borderRadius),";}"),se=(0,a.Z)(y.ZP,{target:"e1wa3gzn0"})("position:absolute;z-index:2;bottom:",(0,Z.Z)(.5),";right:",(0,Z.Z)(.5),";color:",(e=>e.theme.subText),";cursor:nwse-resize;.react-resizable-hide &{display:none;}")},"./app/views/dashboardsV2/layoutUtils.tsx":(e,t,s)=>{s.d(t,{$n:()=>b,Bb:()=>T,Hh:()=>C,I_:()=>v,RI:()=>f,Sp:()=>z,TE:()=>y,VW:()=>x,W8:()=>W,WJ:()=>D,Yb:()=>w,_F:()=>k,c6:()=>g,hq:()=>Z}),s("../node_modules/core-js/modules/es.array.includes.js");var i=s("../node_modules/react-grid-layout/build/utils.js"),a=s("../node_modules/lodash/pickBy.js"),o=s.n(a),n=s("../node_modules/lodash/sortBy.js"),r=s.n(n),d=s("../node_modules/lodash/zip.js"),l=s.n(d),p=s("./app/utils.tsx"),c=s("./app/utils/guid.tsx"),u=s("./app/views/dashboardsV2/dashboard.tsx"),h=s("./app/views/dashboardsV2/types.tsx");const g=2,m=["x","y","w","h","minW","maxW","minH","maxH"];function b(e,t){return e.id?`${e.id}-index-${t}`:`index-${t}`}function w(e){return`grid-item-${e.id??e.tempId}`}function y(e){return e.id??e.tempId?e:{...e,tempId:(0,c.E)()}}function x(e,t){if(0===e.length)return[];const s=l()(e,t);return r()(s,["0.y","0.x"]).map(((e,t)=>{let[s,i]=e;return{...s,x:0,y:2*t,w:2,h:i.displayType===h.FO.BIG_NUMBER?1:2}}))}function f(e){return e.filter((e=>(0,p.ri)(e.layout))).map((e=>{let{layout:t,...s}=e;return{...t,i:w(s)}}))}function Z(e){return o()(e,((e,t)=>(0,p.ri)(e)&&m.includes(t)))}function v(e){return e===h.FO.BIG_NUMBER?1:2}function D(){return Array(u.ey).fill(0)}function z(e){const t=D();return e.forEach((e=>{let{x:s,w:i,y:a,h:o}=e;for(let e=s;e<s+i;e++)t[e]=Math.max(a+o,t[e])})),t}function C(e,t){const s=[...e],i=Math.max(...s);for(let e=0;e<=i;e++)for(let i=0;i<=s.length-g;i++){if(s[i]>e)continue;const a=i+g;if(s.slice(i,a).every((t=>t<=e))){for(let a=i;a<i+g;a++)s[a]=e+t;return[{x:i,y:e},[...s]]}}for(let e=0;e<g;e++)s[e]=i;return[{x:0,y:i},[...s]]}function k(e,t){let s=[...t];return e.map((e=>{if((0,p.ri)(e.layout))return e;const t=v(e.displayType),[i,a]=C(s,t);return s=a,{...e,layout:{...i,h:t,minH:t,w:g}}}))}function W(e){const{displayType:t,layout:s}=e,i={...e};if(!(0,p.ri)(s))return i;const a=v(t),o={...s,h:Math.max(s?.h??a,a),minH:a};return{...i,layout:o}}function T(e){const t=(0,i.compact)(f(e),"vertical",u.ey);return e.map((e=>{const s=t.find((t=>{let{i:s}=t;return s===w(e)}));return s?{...e,layout:s}:e}))}},"./app/views/dashboardsV2/widgetCard/index.tsx":(e,t,s)=>{s.d(t,{_:()=>G,Z:()=>X});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react/index.js")),n=s("../node_modules/react-lazyload/lib/index.js"),r=s("./app/components/alert.tsx"),d=s("./app/components/button.tsx"),l=s("./app/components/charts/errorPanel.tsx"),p=s("./app/components/charts/styles.tsx"),c=s("./app/components/errorBoundary.tsx"),u=s("./app/components/links/externalLink.tsx"),h=s("./app/components/panels/index.tsx"),g=s("./app/components/placeholder.tsx"),m=s("./app/components/searchSyntax/parser.tsx"),b=s("./app/components/tooltip.tsx"),w=s("./app/icons/index.tsx"),y=s("./app/locale.tsx"),x=s("./app/styles/space.tsx"),f=s("./app/utils/discover/fields.tsx"),Z=s("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),v=s("./app/utils/withApi.tsx"),D=s("./app/utils/withOrganization.tsx"),z=s("./app/utils/withPageFilters.tsx"),C=s("./app/utils/withSentryRouter.tsx"),k=s("./app/views/dashboardsV2/dashboard.tsx"),W=s("./app/views/dashboardsV2/types.tsx"),T=s("./app/views/dashboardsV2/widgetBuilder/utils.tsx"),E=s("./app/views/dashboardsV2/widgetCard/dashboardsMEPContext.tsx"),_=s("./app/views/dashboardsV2/widgetCard/widgetCardChartContainer.tsx"),I=s("./app/actionCreators/modal.tsx"),j=s("./app/components/confirm.tsx"),M=s("./app/components/dropdownMenuControl.tsx"),S=s("./app/components/modals/widgetViewerModal/utils.tsx"),R=s("./app/components/tag.tsx"),P=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),L=s("./app/views/dashboardsV2/utils.tsx"),q=s("./app/views/dashboardsV2/widgetViewer/widgetViewerContext.tsx"),O=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function A(e){let{organization:t,selection:s,widget:i,widgetLimitReached:a,onDelete:o,onDuplicate:n,onEdit:r,showContextMenu:d,isPreview:l,router:p,location:c,index:u,seriesData:h,tableData:g,pageLinks:m,totalIssuesCount:b,seriesResultsType:x}=e;const{isMetricsData:f}=(0,E.XA)();if(!d)return null;const v=[],D=[],z=e=>{(0,S.X)(c.pathname)||p.push({pathname:`${c.pathname}${c.pathname.endsWith("/")?"":"/"}widget/${e}/`,query:c.query})};if(l)return(0,O.tZ)(q.M.Consumer,{children:e=>{let{setData:s}=e;return(0,O.tZ)(Z.nP,{children:e=>(0,O.BX)(V,{children:[!t.features.includes("performance-mep-bannerless-ui")&&(t.features.includes("dashboards-mep")||t.features.includes("mep-rollout-flag"))&&!1===f&&e&&e.metricSettingState!==Z.oR.transactionsOnly&&(0,O.tZ)(F,{tooltipText:(0,y.t)("This widget is only applicable to indexed events."),children:(0,y.t)("Indexed")}),(0,O.tZ)($,{items:[{key:"preview",label:(0,y.t)("This is a preview only. To edit, you must add this dashboard.")}],triggerProps:{"aria-label":(0,y.t)("Widget actions"),size:"xs",borderless:!0,showChevron:!1,icon:(0,O.tZ)(w.YR,{direction:"down",size:"sm"})},position:"bottom-end",disabledKeys:[...D,"preview"]}),(0,O.tZ)(N,{"aria-label":(0,y.t)("Open Widget Viewer"),priority:"link",size:"zero",icon:(0,O.tZ)(w.qp,{size:"xs"}),onClick:()=>{(h||g)&&s({seriesData:h,tableData:g,pageLinks:m,totalIssuesCount:b,seriesResultsType:x}),z(u)}})]})})}});if(t.features.includes("discover-basic")&&i.widgetType===W.l9.DISCOVER&&i.queries.length){const e=(0,L.z1)(i,s,t,0,f);v.push({key:"open-in-discover",label:(0,y.t)("Open in Discover"),to:1===i.queries.length?e:void 0,onAction:()=>{1!==i.queries.length?((0,P.Z)("dashboards_views.query_selector.opened",{organization:t,widget_type:i.displayType}),(0,I.openDashboardWidgetQuerySelectorModal)({organization:t,widget:i,isMetricsData:f})):(0,P.Z)("dashboards_views.open_in_discover.opened",{organization:t,widget_type:i.displayType})}})}if(i.widgetType===W.l9.ISSUE){const e=(0,L.hS)(i,s,t);v.push({key:"open-in-issues",label:(0,y.t)("Open in Issues"),to:e})}return t.features.includes("dashboards-edit")&&(v.push({key:"duplicate-widget",label:(0,y.t)("Duplicate Widget"),onAction:()=>n?.()}),a&&D.push("duplicate-widget"),v.push({key:"edit-widget",label:(0,y.t)("Edit Widget"),onAction:()=>r?.()}),v.push({key:"delete-widget",label:(0,y.t)("Delete Widget"),priority:"danger",onAction:()=>{(0,j._)({message:(0,y.t)("Are you sure you want to delete this widget?"),priority:"danger",onConfirm:()=>o?.()})}})),v.length?(0,O.tZ)(q.M.Consumer,{children:e=>{let{setData:s}=e;return(0,O.tZ)(Z.nP,{children:e=>(0,O.BX)(V,{children:[!t.features.includes("performance-mep-bannerless-ui")&&(t.features.includes("dashboards-mep")||t.features.includes("mep-rollout-flag"))&&!1===f&&e&&e.metricSettingState!==Z.oR.transactionsOnly&&(0,O.tZ)(F,{tooltipText:(0,y.t)("This widget is only applicable to indexed events."),children:(0,y.t)("Indexed")}),(0,O.tZ)($,{items:v,triggerProps:{"aria-label":(0,y.t)("Widget actions"),size:"xs",borderless:!0,showChevron:!1,icon:(0,O.tZ)(w.YR,{direction:"down",size:"sm"})},position:"bottom-end",disabledKeys:[...D]}),(0,O.tZ)(N,{"aria-label":(0,y.t)("Open Widget Viewer"),priority:"link",size:"zero",icon:(0,O.tZ)(w.qp,{size:"xs"}),onClick:()=>{s({seriesData:h,tableData:g,pageLinks:m,totalIssuesCount:b,seriesResultsType:x}),z(i.id??u)}})]})})}}):null}A.displayName="WidgetCardContextMenu";const B=A,V=(0,a.Z)("div",{target:"e1yltioa3"})("display:flex;align-items:center;height:",(0,x.Z)(3),";margin-left:",(0,x.Z)(1),";"),$=(0,a.Z)(M.Z,{target:"e1yltioa2"})({name:"gbbqag",styles:"&>button{z-index:auto;}"}),N=(0,a.Z)(d.ZP,{target:"e1yltioa1"})("padding:",(0,x.Z)(.75)," ",(0,x.Z)(1),";color:",(e=>e.theme.textColor),";&:hover{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.surface400),";border-color:transparent;}"),F=(0,a.Z)(R.Z,{target:"e1yltioa0"})("margin-right:",(0,x.Z)(.5),";"),U=["error.handled","error.unhandled","error.mechanism","error.type","error.value"];class H extends o.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{}),(0,i.Z)(this,"setData",(e=>{let{tableResults:t,timeseriesResults:s,totalIssuesCount:i,pageLinks:a,timeseriesResultsTypes:o}=e;this.setState({seriesData:s,tableData:t,totalIssuesCount:i,pageLinks:a,seriesResultsType:o})}))}renderToolbar(){const{onEdit:e,onDelete:t,onDuplicate:s,draggableProps:i,hideToolbar:a,isEditing:o,isMobile:n}=this.props;return o?(0,O.tZ)(J,{children:(0,O.BX)(K,{style:{visibility:a?"hidden":"visible"},children:[!n&&(0,O.tZ)(Q,{size:"xs","aria-label":(0,y.t)("Drag Widget"),icon:(0,O.tZ)(w.LS,{}),borderless:!0,className:k.re,...i?.listeners,...i?.attributes}),(0,O.tZ)(d.ZP,{"data-test-id":"widget-edit","aria-label":(0,y.t)("Edit Widget"),size:"xs",borderless:!0,onClick:e,icon:(0,O.tZ)(w.yl,{})}),(0,O.tZ)(d.ZP,{"aria-label":(0,y.t)("Duplicate Widget"),size:"xs",borderless:!0,onClick:s,icon:(0,O.tZ)(w.vU,{})}),(0,O.tZ)(d.ZP,{"data-test-id":"widget-delete","aria-label":(0,y.t)("Delete Widget"),borderless:!0,size:"xs",onClick:t,icon:(0,O.tZ)(w.Fz,{})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:s,showContextMenu:i,isPreview:a,widgetLimitReached:o,onEdit:n,onDuplicate:r,onDelete:d,isEditing:l,router:p,location:c,index:u}=this.props,{seriesData:h,tableData:g,pageLinks:m,totalIssuesCount:b,seriesResultsType:w}=this.state;return l?null:(0,O.tZ)(B,{organization:s,widget:e,selection:t,showContextMenu:i,isPreview:a,widgetLimitReached:o,onDuplicate:r,onEdit:n,onDelete:d,router:p,location:c,index:u,seriesData:h,seriesResultsType:w,tableData:g,pageLinks:m,totalIssuesCount:b})}render(){const{api:e,organization:t,selection:s,widget:i,isMobile:a,renderErrorMessage:r,tableItemLimit:d,windowWidth:l,noLazyLoad:p,showStoredAlert:h,noDashboardsMEPProvider:g,dashboardFilters:x,isWidgetInvalid:v,location:D}=this.props;if(i.displayType===W.FO.TOP_N){const e=i.queries.map((e=>({...e,aggregates:e.aggregates.length?[e.aggregates[e.aggregates.length-1]]:[]})));i.queries=e,i.limit=T._k}const z=i.queries.some((e=>{let{columns:t,aggregates:s,conditions:i}=e;return U.some((e=>t.includes(e)||s.some((t=>(0,f.dL)(t)?.arguments.includes(e)))||(0,m.UG)(i)?.some((t=>t.key?.value===e))))}));return(0,O.tZ)(c.Z,{customComponent:(0,O.tZ)(Y,{children:(0,y.t)("Error loading widget data")}),children:(C=(0,O.BX)(o.Fragment,{children:[(0,O.BX)(G,{isDragging:!1,children:[(0,O.BX)(te,{children:[(0,O.tZ)(b.Z,{title:i.title,containerDisplayMode:"grid",showOnlyOnOverflow:!0,children:(0,O.tZ)(ee,{children:i.title})}),this.renderContextMenu()]}),v?(0,O.BX)(o.Fragment,{children:[r?.("Widget query condition is invalid."),(0,O.tZ)(ie,{children:(0,O.tZ)(w.FC,{color:"gray500",size:"lg"})})]}):p?(0,O.tZ)(_.Z,{location:D,api:e,organization:t,selection:s,widget:i,isMobile:a,renderErrorMessage:r,tableItemLimit:d,windowWidth:l,onDataFetched:this.setData,dashboardFilters:x}):(0,O.tZ)(n.ZP,{once:!0,resize:!0,height:200,children:(0,O.tZ)(_.Z,{location:D,api:e,organization:t,selection:s,widget:i,isMobile:a,renderErrorMessage:r,tableItemLimit:d,windowWidth:l,onDataFetched:this.setData,dashboardFilters:x})}),this.renderToolbar()]}),!t.features.includes("performance-mep-bannerless-ui")&&(t.features.includes("dashboards-mep")||t.features.includes("mep-rollout-flag"))&&(0,O.tZ)(Z.nP,{children:e=>(0,O.tZ)(E.k,{children:t=>{let{isMetricsData:s}=t;return h&&!1===s&&i.widgetType===W.l9.DISCOVER&&e&&e.metricSettingState!==Z.oR.transactionsOnly&&!z?(0,O.tZ)(se,{showIcon:!0,children:(0,y._N)("Your selection is only applicable to [indexedData: indexed event data]. We've automatically adjusted your results.",{indexedData:(0,O.tZ)(u.Z,{href:"https://docs.sentry.io/product/dashboards/widget-builder/#errors--transactions"})})}):null}})})]}),g?C:(0,O.tZ)(E.KC,{children:C}))});var C}}H.displayName="WidgetCard";const X=(0,v.Z)((0,D.Z)((0,z.Z)((0,C.Z)(H)))),Y=(0,a.Z)(g.Z,{target:"e1fl0u6g8"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,x.Z)(2),";"),G=(0,a.Z)(h.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"e1fl0u6g7"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;display:flex;flex-direction:column;"),J=(0,a.Z)("div",{target:"e1fl0u6g6"})("position:absolute;top:0;left:0;z-index:2;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:calc(",(e=>e.theme.panelBorderRadius)," - 1px);"),K=(0,a.Z)("div",{target:"e1fl0u6g5"})("display:flex;margin:",(0,x.Z)(1),";touch-action:none;"),Q=(0,a.Z)(d.ZP,{target:"e1fl0u6g4"})({name:"1fgcczm",styles:"cursor:grab"}),ee=(0,a.Z)(p.Gh,{target:"e1fl0u6g3"})((e=>e.theme.overflowEllipsis),";font-weight:normal;"),te=(0,a.Z)("div",{target:"e1fl0u6g2"})("padding:",(0,x.Z)(2)," ",(0,x.Z)(1)," 0 ",(0,x.Z)(3),";min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;"),se=(0,a.Z)(r.Z,{target:"e1fl0u6g1"})("margin-top:",(0,x.Z)(1),";margin-bottom:0;"),ie=(0,a.Z)(l.Z,{target:"e1fl0u6g0"})("padding:",(0,x.Z)(2),";")},"./app/views/dashboardsV2/widgetViewer/widgetViewerContext.tsx":(e,t,s)=>{s.d(t,{M:()=>i});const i=(0,s("../node_modules/react/index.js").createContext)({setData:()=>{}})}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_dashboard_tsx.15059c49cc803d6205549e68ef32c076.js.map