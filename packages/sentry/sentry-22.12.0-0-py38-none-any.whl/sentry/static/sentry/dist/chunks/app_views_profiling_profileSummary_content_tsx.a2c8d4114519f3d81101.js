"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_profiling_profileSummary_content_tsx"],{"./app/views/profiling/profileSummary/content.tsx":(e,t,r)=>{r.d(t,{J:()=>$,H:()=>I});var o=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/react/index.js")),s=r("../node_modules/react-router/es/index.js"),a=r("./app/components/compactSelect.tsx"),i=r("./app/components/layouts/thirds.tsx"),l=r("./app/components/pagination.tsx"),c=r("./app/components/count.tsx"),u=r("./app/components/gridEditable/index.tsx"),p=r("./app/components/performanceDuration.tsx"),d=r("./app/locale.tsx"),m=r("./app/styles/space.tsx"),g=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function y(e){let{items:t}=e;const[r,o]=(0,n.useState)(!1),s=t[0];return(0,g.BX)(h,{expanded:r,children:[s&&(0,g.tZ)(f,{item:s}),t.length>1&&r&&t.slice(1,t.length).map((e=>(0,g.tZ)(f,{item:e},e.value))),t.length>1?(0,g.tZ)(k,{children:(0,g.tZ)("button",{onClick:()=>o(!r),children:r?(0,d.t)("[collapse]"):(0,d.t)("[+%s more]",t.length-1)})}):null]})}function f(e){let{item:t}=e;return(0,g.tZ)(x,{children:(0,g.tZ)(s.Link,{to:t.target,children:t.value})})}y.displayName="ArrayLinks",f.displayName="LinkedItem";const h=(0,o.Z)("div",{target:"e11x8nqr2"})("display:flex;flex-direction:",(e=>e.expanded?"column":"row"),";"),x=(0,o.Z)("span",{target:"e11x8nqr1"})("flex-shrink:1;display:block;",(e=>e.theme.overflowEllipsis),";width:unset;"),k=(0,o.Z)("div",{target:"e11x8nqr0"})("white-space:nowrap;& button{background:none;border:0;outline:none;padding:0;cursor:pointer;color:",(e=>e.theme.linkColor),";margin-left:",(0,m.Z)(.5),";}");var v=r("./app/utils/discover/styles.tsx"),Z=r("./app/utils/events.tsx"),b=r("./app/utils/profiling/routes.tsx"),w=r("./app/utils/profiling/tableRenderer.tsx"),q=r("./app/utils/useLocation.tsx"),S=r("./app/utils/useOrganization.tsx");function j(e){const t=(0,q.T)(),r=(0,S.Z)(),o=(0,n.useMemo)((()=>{let t=e.sort,r="asc";return e.sort.startsWith("-")&&(t=e.sort.substring(1),r="desc"),P.has(t)||(t="p99"),{key:t,order:r}}),[e.sort]),s=(0,n.useMemo)((()=>e.functions.map((t=>{const{worst:o,examples:n,...s}=t,a=n.filter((e=>e!==o));return a.unshift(o),{...s,examples:a.map((o=>{const n=o.replaceAll("-","");return{value:(0,Z.XQ)(n),target:(0,b.TH)({orgSlug:r.slug,projectSlug:e.project.slug,profileId:n,query:{frameName:t.name,framePackage:t.package}})}}))}}))),[r.slug,e.project.slug,e.functions]),a=(0,n.useCallback)((e=>{if(!P.has(e))return()=>{};const r=o.key!==e?"desc":"desc"===o.order?"asc":"desc";return()=>({...t,query:{...t.query,functionsSort:`${"desc"===r?"-":""}${e}`}})}),[t,o]);return(0,g.tZ)(u.ZP,{isLoading:e.isLoading,error:e.error,data:s,columnOrder:_.map((e=>H[e])),columnSortBy:[],grid:{renderHeadCell:(0,w.w)({currentSort:o,rightAlignedColumns:C,sortableColumns:P,generateSortLink:a}),renderBodyCell:T},location:t})}j.displayName="FunctionsTable";const C=new Set(["p75","p99","count"]),P=C;function T(e,t,r,o){return(0,g.tZ)(z,{column:e,dataRow:t,rowIndex:r,columnIndex:o})}T.displayName="renderFunctionsTableCell";const L=(0,o.Z)("span",{target:"ef2cp6g0"})("color:",(e=>e.theme.gray300),";");function z(e){let{column:t,dataRow:r}=e;const o=r[t.key];switch(t.key){case"count":return(0,g.tZ)(v.Hw,{children:(0,g.tZ)(c.Z,{value:o})});case"p75":case"p99":return(0,g.tZ)(v.Hw,{children:(0,g.tZ)(p.Z,{nanoseconds:o,abbreviation:!0})});case"examples":return(0,g.tZ)(y,{items:o});case"name":case"package":const e=o||(0,g.tZ)(L,{children:(0,d.t)("Unknown")});return(0,g.tZ)(v.W2,{children:e});default:return(0,g.tZ)(v.W2,{children:o})}}const _=["name","package","count","p75","p99","examples"],H={name:{key:"name",name:(0,d.t)("Name"),width:u.z7},package:{key:"package",name:(0,d.t)("Package"),width:u.z7},path:{key:"path",name:(0,d.t)("Path"),width:u.z7},p75:{key:"p75",name:(0,d.t)("P75 Total Duration"),width:u.z7},p99:{key:"p99",name:(0,d.t)("P99 Total Duration"),width:u.z7},count:{key:"count",name:(0,d.t)("Total Occurrences"),width:u.z7},examples:{key:"examples",name:(0,d.t)("Example Profiles"),width:u.z7}};var A=r("./app/components/profiling/profileEventsTable.tsx"),E=r("./app/data/platformCategories.tsx"),F=r("../node_modules/@sentry/core/esm/exports.js"),M=r("./app/components/organizations/pageFilters/parse.tsx"),N=r("./app/utils/tokenizeSearch.tsx"),B=r("./app/utils/useApi.tsx");var R=r("./app/utils/profiling/hooks/useProfileEvents.tsx"),X=r("./app/utils/queryString.tsx");function $(e){const t=(0,n.useMemo)((()=>I(e.project.platform)),[e.project]),r=(0,n.useMemo)((()=>(0,X.ro)(e.location.query.cursor)),[e.location.query.cursor]),o=(0,n.useMemo)((()=>(0,X.ro)(e.location.query.functionsCursor)),[e.location.query.functionsCursor]),l=(0,n.useMemo)((()=>(0,X.ro)(e.location.query.functionsSort,"-p99")),[e.location.query.functionsSort]),c=(0,R.kq)((0,X.ro)(e.location.query.sort),t,{key:"timestamp",order:"desc"}),u=(0,R.GP)({cursor:r,fields:t,query:e.query,sort:c,limit:5,referrer:"api.profiling.profile-summary-table"}),[p,m]=(0,n.useState)("application"),y=function(e){let{functionType:t,project:r,query:o,transaction:s,sort:a,cursor:i,selection:l}=e;const c=(0,B.Z)(),u=(0,S.Z)(),[p,m]=(0,n.useState)({type:"initial"});return(0,n.useEffect)((()=>{if(void 0!==l)return m({type:"loading"}),function(e,t,r){let{cursor:o,functionType:n,projectSlug:s,query:a,selection:i,sort:l,transaction:c}=r;const u=new N.MY(a);return u.setFilterValues("transaction_name",[c]),e.requestPromise(`/projects/${t.slug}/${s}/profiling/functions/`,{method:"GET",includeAllArgs:!0,query:{cursor:o,environment:i.environments,...(0,M.fK)(i.datetime),query:u.formatString(),sort:l,is_application:"application"===n?"1":"system"===n?"0":void 0}})}(c,u,{functionType:t,projectSlug:r.slug,query:o,selection:l,sort:a,transaction:s,cursor:i}).then((e=>{let[t,,r]=e;m({type:"resolved",data:{functions:t.functions??[],pageLinks:r?.getResponseHeader("Link")??null}})})).catch((e=>{m({type:"errored",error:(0,d.t)("Error: Unable to load functions")}),F.Tb(e)})),()=>c.clear()}),[c,i,t,u,r.slug,o,l,a,s]),p}({cursor:o,project:e.project,query:"",selection:e.selection,transaction:e.transaction,sort:l,functionType:p}),f=(0,n.useCallback)(((e,t,r)=>{s.browserHistory.push({pathname:t,query:{...r,functionsCursor:e}})}),[]),h=(0,n.useCallback)((t=>{s.browserHistory.push({...e.location,query:{...e.location.query,sort:t}})}),[e.location]);return(0,g.BX)(i.or,{fullWidth:!0,children:[(0,g.BX)(U,{children:[(0,g.tZ)(a.Z,{triggerProps:{prefix:(0,d.t)("Filter"),size:"xs"},value:"asc"===c.order?c.key:`-${c.key}`,options:O,onChange:e=>h(e.value)}),(0,g.tZ)(G,{pageLinks:"success"===u.status?u.data?.[2]?.getResponseHeader("Link")??null:null,size:"xs"})]}),(0,g.tZ)(A.Q,{columns:t,data:"success"===u.status?u.data[0]:null,error:"error"===u.status?(0,d.t)("Unable to load profiles"):null,isLoading:"loading"===u.status,sort:c}),(0,g.BX)(U,{children:[(0,g.tZ)(a.Z,{triggerProps:{prefix:(0,d.t)("Suspect Functions"),size:"xs"},value:p,options:[{label:(0,d.t)("All"),value:"all"},{label:(0,d.t)("Application"),value:"application"},{label:(0,d.t)("System"),value:"system"}],onChange:e=>{let{value:t}=e;return m(t)}}),(0,g.tZ)(G,{pageLinks:"resolved"===y.type?y.data.pageLinks:null,onCursor:f,size:"xs"})]}),(0,g.tZ)(j,{error:"errored"===y.type?y.error:null,isLoading:"initial"===y.type||"loading"===y.type,functions:"resolved"===y.type?y.data.functions:[],project:e.project,sort:l})]})}function I(e){return E.ai.includes(e)?W:D}$.displayName="ProfileSummaryContent";const W=["id","timestamp","release","device.model","device.classification","device.arch","profile.duration"],D=["id","timestamp","release","device.arch","profile.duration"],O=[{label:(0,d.t)("Recent Profiles"),value:"-timestamp"},{label:(0,d.t)("Slowest Profiles"),value:"-profile.duration"},{label:(0,d.t)("Fastest Profiles"),value:"profile.duration"}],U=(0,o.Z)("div",{target:"ewy0nsd1"})("display:flex;justify-content:space-between;margin-bottom:",(0,m.Z)(1),";"),G=(0,o.Z)(l.Z,{target:"ewy0nsd0"})("margin:0 0 0 ",(0,m.Z)(1),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_profiling_profileSummary_content_tsx.0db4313ceac1dfb2ee646b51549c8ddf.js.map