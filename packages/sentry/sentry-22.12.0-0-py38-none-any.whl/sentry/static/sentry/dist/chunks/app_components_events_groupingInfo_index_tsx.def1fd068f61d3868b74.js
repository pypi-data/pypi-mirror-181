"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_groupingInfo_index_tsx"],{"./app/components/events/groupingInfo/index.tsx":(t,e,n)=>{n.d(e,{B:()=>lt,Z:()=>ct});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=n("../node_modules/react/index.js"),s=n("./app/components/asyncComponent.tsx"),a=n("./app/components/button.tsx"),l=n("./app/components/events/eventDataSection.tsx"),p=n("./app/components/featureFeedback/index.tsx"),c=n("./app/components/loadingIndicator.tsx"),d=n("./app/locale.tsx"),h=n("./app/styles/space.tsx"),u=n("./app/utils/withOrganization.tsx"),g=n("./app/views/organizationGroupDetails/grouping/grouping.tsx"),m=n("./app/components/dropdownAutoComplete/index.tsx"),f=n("./app/components/dropdownButton.tsx"),Z=n("./app/components/tooltip.tsx"),b=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class v extends s.Z{getDefaultState(){return{...super.getDefaultState(),configs:[]}}getEndpoints(){return[["configs","/grouping-configs/"]]}renderLoading(){return this.renderBody()}renderBody(){const{configId:t,eventConfigId:e,onSelect:n}=this.props,{configs:i}=this.state,o=i.map((t=>{let{id:n,hidden:i}=t;return{value:n,label:(0,b.tZ)(lt,{isHidden:i,isActive:n===e,children:n})}}));return(0,b.tZ)(m.Z,{onSelect:n,items:o,children:n=>{let{isOpen:i}=n;return(0,b.tZ)(Z.Z,{title:(0,d.t)("Click here to experiment with other grouping configs"),children:(0,b.tZ)(C,{isOpen:i,size:"sm",children:(0,b.tZ)(lt,{isActive:e===t,children:t})})})}})}}const C=(0,o.Z)(f.Z,{target:"e4u5um40"})({name:"18zed2t",styles:"font-weight:inherit"}),y=v;var x=n("../node_modules/lodash/capitalize.js"),w=n.n(x),k=n("./app/components/buttonBar.tsx"),z=n("./app/components/events/interfaces/keyValueList/index.tsx"),S=n("./app/components/questionTooltip.tsx"),N=n("./app/icons/index.tsx"),O=n("./app/types/index.tsx"),B=n("../node_modules/lodash/isObject.js"),_=n.n(B);function I(t){if(void 0===t)return!1;if(!t.contributes)return!0;for(const e of t.values)if(_()(e)&&I(e))return!0;return!1}function T(t,e){if(_()(t)){if(!t.contributes&&!t.hint&&0===t.values.length)return!1;if(!e&&!t.contributes)return!1}return!0}const j=t=>{let{component:e,showNonContributing:n}=t;return(0,b.tZ)(r.Fragment,{children:e.values.filter((t=>T(t,n))).map(((t,i)=>(0,b.tZ)(L,{children:_()(t)?(0,b.tZ)(R,{component:t,showNonContributing:n}):(0,b.tZ)(M,{valueType:e.name||e.id,children:"string"==typeof t||"number"==typeof t?t:JSON.stringify(t,null,2)})},i)))})};j.displayName="GroupingComponentChildren";const G=j;class X extends r.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{collapsed:!0})}render(){const{items:t,maxVisibleItems:e}=this.props,{collapsed:n}=this.state,i=t.length>e;return(0,b.BX)(r.Fragment,{children:[t.map(((o,r)=>!n||r<e?(0,b.tZ)(L,{isCollapsible:i,children:o},r):r===e?(0,b.tZ)(L,{children:(0,b.tZ)(F,{size:"sm",priority:"link",icon:(0,b.tZ)(N.N_,{size:"8px"}),onClick:()=>this.setState({collapsed:!1}),children:(0,d._N)("show [numberOfFrames] similar",{numberOfFrames:t.length-e})})},r):null)),!n&&t.length>e&&(0,b.tZ)(L,{children:(0,b.tZ)(F,{size:"sm",priority:"link",icon:(0,b.tZ)(N.JZ,{size:"8px"}),onClick:()=>this.setState({collapsed:!0}),children:(0,d._N)("collapse [numberOfFrames] similar",{numberOfFrames:t.length-e})})})]})}}X.displayName="GroupingComponentFrames",(0,i.Z)(X,"defaultProps",{maxVisibleItems:2});const F=(0,o.Z)(a.ZP,{target:"enrkrz0"})("margin:",(0,h.Z)(.5)," 0;color:",(t=>t.theme.linkColor),";"),P=X,D=t=>{let{component:e,showNonContributing:n}=t;return(0,b.tZ)(r.Fragment,{children:(()=>{const t=[];return e.values.filter((t=>T(t,n))).forEach((e=>{const i=e.values.filter((t=>T(t,n))).map((t=>t.id)).sort(((t,e)=>t.localeCompare(e))).join(""),o=t[t.length-1];o?.key===i?o.data.push(e):t.push({key:i,data:[e]})})),t})().map(((t,e)=>(0,b.tZ)(P,{items:t.data.map(((t,e)=>(0,b.tZ)(R,{component:t,showNonContributing:n},e)))},e)))})};D.displayName="GroupingComponentStacktrace";const E=D,$=t=>{let{component:e,showNonContributing:n}=t;const i=function(t){return t.values.every((t=>!_()(t)))}(e),o="stacktrace"===e.id?E:G;return(0,b.BX)(A,{isContributing:e.contributes,children:[(0,b.BX)("span",{children:[e.name||e.id,e.hint&&(0,b.tZ)(V,{children:` (${e.hint})`})]}),(0,b.tZ)(H,{isInline:i,children:(0,b.tZ)(o,{component:e,showNonContributing:n})})]})};$.displayName="GroupingComponent";const H=(0,o.Z)("ul",{target:"e1rb8ztm4"})("padding:0;margin:0;list-style:none;&,&>li{display:",(t=>t.isInline?"inline":"block"),";}"),L=(0,o.Z)("li",{target:"e1rb8ztm3"})("padding:0;margin:",(0,h.Z)(.25)," 0 ",(0,h.Z)(.25)," ",(0,h.Z)(1.5),";",(t=>t.isCollapsible&&`\n    border-left: 1px solid ${t.theme.innerBorder};\n    margin: 0 0 -${(0,h.Z)(.25)} ${(0,h.Z)(1)};\n    padding-left: ${(0,h.Z)(.5)};\n  `),";"),M=(0,o.Z)("code",{target:"e1rb8ztm2"})("display:inline-block;margin:",(0,h.Z)(.25)," ",(0,h.Z)(.5)," ",(0,h.Z)(.25)," 0;font-size:",(t=>t.theme.fontSizeSmall),";padding:0 ",(0,h.Z)(.25),";background:rgba(112, 163, 214, 0.1);color:",(t=>t.theme.textColor),";",(t=>{let{valueType:e}=t;return("function"===e||"symbol"===e)&&`\n    font-weight: bold;\n    color: ${t=>t.theme.textColor};\n  `}),";"),A=(0,o.Z)("div",{target:"e1rb8ztm1"})("color:",(t=>t.isContributing?null:t.theme.textColor),";",M,",button{opacity:1;}"),V=(0,o.Z)("small",{target:"e1rb8ztm0"})({name:"1rawn5e",styles:"font-size:0.8em"}),R=$;function U(t,e){"matched_rule"in e&&t.push([(0,d.t)("Fingerprint rule"),(0,b.BX)(et,{children:[e.matched_rule,(0,b.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("The server-side fingerprinting rule that produced the fingerprint.")})]},"type")]),"values"in e&&t.push([(0,d.t)("Fingerprint values"),e.values]),"client_values"in e&&t.push([(0,d.t)("Client fingerprint values"),(0,b.BX)(et,{children:[e.client_values,(0,b.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("The client sent a fingerprint that was overridden by a server-side fingerprinting rule.")})]},"type")])}class J extends r.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{showNonContributing:!1}),(0,i.Z)(this,"handleShowNonContributing",(()=>{this.setState({showNonContributing:!0})})),(0,i.Z)(this,"handleHideNonContributing",(()=>{this.setState({showNonContributing:!1})}))}getVariantData(){const{variant:t,showGroupingConfig:e}=this.props,n=[];let i;if(!this.state.showNonContributing&&null===t.hash)return[n,i];switch(null!==t.hash&&n.push([(0,d.t)("Hash"),(0,b.BX)(et,{children:[(0,b.tZ)(nt,{children:t.hash}),(0,b.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Events with the same hash are grouped together")})]},"hash")]),t.hashMismatch&&n.push([(0,d.t)("Hash mismatch"),(0,d.t)("hashing algorithm produced a hash that does not match the event")]),t.type){case O.bo.COMPONENT:i=t.component,n.push([(0,d.t)("Type"),(0,b.BX)(et,{children:[t.type,(0,b.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Uses a complex grouping algorithm taking event data into account")})]},"type")]),e&&t.config?.id&&n.push([(0,d.t)("Grouping Config"),t.config.id]);break;case O.bo.CUSTOM_FINGERPRINT:n.push([(0,d.t)("Type"),(0,b.BX)(et,{children:[t.type,(0,b.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Overrides the default grouping by a custom fingerprinting rule")})]},"type")]),U(n,t);break;case O.bo.SALTED_COMPONENT:i=t.component,n.push([(0,d.t)("Type"),(0,b.BX)(et,{children:[t.type,(0,b.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Uses a complex grouping algorithm taking event data and a fingerprint into account")})]},"type")]),U(n,t),e&&t.config?.id&&n.push([(0,d.t)("Grouping Config"),t.config.id]);break;case O.bo.PERFORMANCE_PROBLEM:n.push([(0,d.t)("Type"),(0,b.BX)(et,{children:[t.type,(0,b.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Uses the evidence from performance issue detection to generate a fingerprint.")})]},"type")]),n.push(["Performance Issue Type",t.key]),n.push(["Span Operation",t.evidence.op]),n.push(["Parent Span Hashes",t.evidence.parent_span_hashes]),n.push(["Source Span Hashes",t.evidence.cause_span_hashes]),n.push(["Offender Span Hashes",[...new Set(t.evidence.offender_span_hashes)]])}return i&&n.push([(0,d.t)("Grouping"),(0,b.tZ)(tt,{children:(0,b.tZ)(R,{component:i,showNonContributing:this.state.showNonContributing})},i.id)]),[n,i]}renderTitle(){const{variant:t}=this.props,e=null!==t.hash;let n;if(e)n=(0,d.t)("Contributing variant");else{const e="component"in t?t.component?.hint:void 0;n=e?(0,d.t)("Non-contributing variant: %s",e):(0,d.t)("Non-contributing variant")}return(0,b.tZ)(Z.Z,{title:n,children:(0,b.BX)(Q,{children:[(0,b.tZ)(W,{isContributing:e}),(0,d.t)("By")," ",t.description?.split(" ").map((t=>w()(t))).join(" ")??(0,d.t)("Nothing")]})})}renderContributionToggle(){const{showNonContributing:t}=this.state;return(0,b.BX)(Y,{merged:!0,active:t?"all":"relevant",children:[(0,b.tZ)(a.ZP,{barId:"relevant",size:"xs",onClick:this.handleHideNonContributing,children:(0,d.t)("Contributing values")}),(0,b.tZ)(a.ZP,{barId:"all",size:"xs",onClick:this.handleShowNonContributing,children:(0,d.t)("All values")})]})}render(){const[t,e]=this.getVariantData();return(0,b.BX)(q,{children:[(0,b.BX)(K,{children:[this.renderTitle(),I(e)&&this.renderContributionToggle()]}),(0,b.tZ)(z.Z,{data:t.map((t=>({key:t[0],subject:t[0],value:t[1]}))),isContextData:!0,isSorted:!1})]})}}J.displayName="GroupVariant";const q=(0,o.Z)("div",{target:"ekctgc27"})("margin-bottom:",(0,h.Z)(4),";"),K=(0,o.Z)("div",{target:"ekctgc26"})("display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,h.Z)(2),";@media (max-width: ",(t=>t.theme.breakpoints.small),"){display:block;}"),Q=(0,o.Z)("h5",{target:"ekctgc25"})("font-size:",(t=>t.theme.fontSizeMedium),";margin:0;display:flex;align-items:center;"),W=(0,o.Z)((t=>{let{isContributing:e,...n}=t;return e?(0,b.tZ)(N.DL,{size:"sm",isCircled:!0,color:"successText",...n}):(0,b.tZ)(N.bM,{size:"sm",isCircled:!0,color:"dangerText",...n})}),{target:"ekctgc24"})("margin-right:",(0,h.Z)(1),";"),Y=(0,o.Z)(k.ZP,{target:"ekctgc23"})("justify-content:flex-end;@media (max-width: ",(t=>t.theme.breakpoints.small),"){margin-top:",(0,h.Z)(.5),";}"),tt=(0,o.Z)("div",{target:"ekctgc22"})("color:",(t=>t.theme.textColor),";"),et=(0,o.Z)("div",{target:"ekctgc21"})("display:grid;align-items:center;grid-template-columns:auto 1fr;gap:",(0,h.Z)(.5),";"),nt=(0,o.Z)("span",{target:"ekctgc20"})("@media (max-width: ",(t=>t.theme.breakpoints.small),"){",(t=>t.theme.overflowEllipsis),";width:210px;}"),it=J;class ot extends s.Z{constructor(){super(...arguments),(0,i.Z)(this,"toggle",(()=>{this.setState((t=>({isOpen:!t.isOpen,configOverride:t.isOpen?null:t.configOverride})))})),(0,i.Z)(this,"handleConfigSelect",(t=>{this.setState({configOverride:t.value},(()=>this.reloadData()))}))}getEndpoints(){const{organization:t,event:e,projectId:n}=this.props;let i=`/projects/${t.slug}/${n}/events/${e.id}/grouping-info/`;return this.state?.configOverride&&(i=`${i}?config=${this.state.configOverride}`),[["groupInfo",i]]}getDefaultState(){return{...super.getDefaultState(),isOpen:!1,configOverride:null}}renderGroupInfoSummary(){const{groupInfo:t}=this.state;if(!t)return null;const e=Object.values(t).filter((t=>null!==t.hash&&null!==t.description)).map((t=>t.description)).sort(((t,e)=>t.toLowerCase().localeCompare(e.toLowerCase()))).join(", ");return(0,b.tZ)(rt,{"data-test-id":"loaded-grouping-info",children:`(${(0,d.t)("grouped by")} ${e||(0,d.t)("nothing")})`})}renderGroupConfigSelect(){const{configOverride:t}=this.state,{event:e}=this.props;if(!e.groupingConfig)return null;const n=t??e.groupingConfig?.id;return(0,b.tZ)(y,{eventConfigId:e.groupingConfig.id,configId:n,onSelect:this.handleConfigSelect})}renderGroupInfo(){const{groupInfo:t,loading:e}=this.state,{showGroupingConfig:n}=this.props,i=t?Object.values(t).sort(((t,e)=>t.hash&&!e.hash?-1:t.description?.toLowerCase().localeCompare(e.description?.toLowerCase()??"")??1)):[];return(0,b.BX)(r.Fragment,{children:[(0,b.BX)(st,{children:[(0,b.tZ)("div",{children:n&&this.renderGroupConfigSelect()}),(0,b.tZ)(p.z,{featureName:"grouping",feedbackTypes:g.p,buttonProps:{size:"sm"}})]}),e?(0,b.tZ)(c.Z,{}):i.map(((t,e)=>(0,b.BX)(r.Fragment,{children:[(0,b.tZ)(it,{variant:t,showGroupingConfig:n}),e<i.length-1&&(0,b.tZ)(pt,{})]},t.key)))]})}renderLoading(){return this.renderBody()}renderBody(){const{isOpen:t}=this.state,e=(0,b.BX)(r.Fragment,{children:[(0,d.t)("Event Grouping Information"),!t&&this.renderGroupInfoSummary()]}),n=(0,b.tZ)(at,{onClick:this.toggle,priority:"link",children:t?(0,d.t)("Hide Details"):(0,d.t)("Show Details")});return(0,b.tZ)(l.Z,{type:"grouping-info",title:e,actions:n,children:t&&this.renderGroupInfo()})}}const rt=(0,o.Z)("small",{target:"eno4hz94"})("@media (max-width: ",(t=>t.theme.breakpoints.small),"){display:block;margin:0!important;}"),st=(0,o.Z)("div",{target:"eno4hz93"})("display:flex;align-items:center;justify-content:space-between;gap:",(0,h.Z)(1),";margin-bottom:",(0,h.Z)(2),";"),at=(0,o.Z)(a.ZP,{target:"eno4hz92"})("font-weight:700;color:",(t=>t.theme.subText),";&:hover,&:focus{color:",(t=>t.theme.textColor),";}"),lt=(0,o.Z)("span",{target:"eno4hz91"})("font-family:",(t=>t.theme.text.familyMono),";opacity:",(t=>t.isHidden?.5:null),";font-weight:",(t=>t.isActive?"bold":null),";font-size:",(t=>t.theme.fontSizeSmall),";"),pt=(0,o.Z)("hr",{target:"eno4hz90"})("padding-top:",(0,h.Z)(1),";border-top:1px solid ",(t=>t.theme.border),";"),ct=(0,u.Z)(ot)}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_groupingInfo_index_tsx.a537c6cd34e2c69bef7e0ec14b0037f2.js.map