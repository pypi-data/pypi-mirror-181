"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx"],{"./app/views/settings/organizationDeveloperSettings/sentryFunctionDetails.tsx":(e,n,t)=>{t.r(n),t.d(n,{default:()=>X}),t("../node_modules/core-js/modules/es.array.includes.js");var s=t("../node_modules/react/index.js"),a=t("../node_modules/react-router/es/index.js"),o=t("../node_modules/@monaco-editor/react/lib/es/index.js"),r=t("./app/actionCreators/indicator.tsx"),i=t("./app/components/acl/feature.tsx"),l=t("./app/components/asyncComponent.tsx"),c=t("./app/components/forms/form.tsx"),u=t("./app/components/forms/jsonForm.tsx"),d=t("./app/components/forms/model.tsx"),m=t("./app/components/panels/index.tsx"),p=t("./app/locale.tsx"),v=t("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),g=t("./app/components/button.tsx"),h=t("./app/components/forms/index.tsx"),b=t("./app/icons/index.tsx"),f=t("./app/styles/space.tsx"),y=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function Z(e){const{envVariables:n,setEnvVariables:t}=e;return(0,y.BX)("div",{children:[(0,y.BX)(m.V9,{children:[(0,p.t)("Environment Variables"),(0,y.tZ)(w,{size:"sm",type:"button",icon:(0,y.tZ)(b.N_,{isCircled:!0}),"aria-label":(0,p.t)("Add Environment Variable"),onClick:()=>{t([...n,{name:"",value:""}])}})]}),(0,y.BX)(_,{children:[(0,y.BX)(x,{children:[(0,y.tZ)(F,{children:(0,p.t)("Name")}),(0,y.tZ)(V,{children:(0,p.t)("Value")})]}),n.map(((e,s)=>(0,y.BX)(x,{children:[(0,y.tZ)(h.nv,{name:`env-variable-name-${s}`,required:!1,inline:!1,defaultValue:e.name,value:e.name,stacked:!0,onChange:e=>((e,s)=>{const a=[...n];for(;a.length<=s;)a.push({name:"",value:""});a[s]={...a[s],name:e},t(a)})(e,s)}),(0,y.tZ)(h.nv,{name:`env-variable-value-${s}`,required:!1,inline:!1,defaultValue:e.value,value:e.value,stacked:!0,onChange:e=>((e,s)=>{const a=[...n];for(;a.length<=s;)a.push({name:"",value:""});a[s]={...a[s],value:e},t(a)})(e,s)}),(0,y.tZ)(E,{children:(0,y.tZ)(w,{size:"sm",icon:(0,y.tZ)(b.Fz,{}),type:"button","aria-label":(0,p._N)("Remove Environment Variable [i]",{i:s}),onClick:()=>(e=>{const s=[...n];s.splice(e,1),t(s)})(s)})})]},s)))]})]})}Z.displayName="SentryFunctionEnvironmentVariables";const S=Z,x=(0,v.Z)("div",{target:"etwnfrb5"})({name:"1dre63g",styles:"display:grid;grid-template-columns:1fr 1.5fr min-content"}),w=(0,v.Z)(g.ZP,{target:"etwnfrb4"})({name:"tjo4qw",styles:"float:right"}),F=(0,v.Z)("div",{target:"etwnfrb3"})("text-align:left;margin-top:",(0,f.Z)(2),";margin-bottom:",(0,f.Z)(1),";color:",(e=>e.theme.gray400),";"),V=(0,v.Z)(F,{target:"etwnfrb2"})("margin-left:-",(0,f.Z)(2),";"),E=(0,v.Z)("div",{target:"etwnfrb1"})("align-items:center;display:flex;margin-bottom:",(0,f.Z)(2),";"),_=(0,v.Z)(m.N,{target:"etwnfrb0"})("padding:",(0,f.Z)(2),";");var C=t("./app/views/settings/organizationDeveloperSettings/constants.tsx"),B=t("./app/views/settings/organizationDeveloperSettings/subscriptionBox.tsx");function $(e){const{events:n,setEvents:t}=e;function s(e,s){s&&!n.includes(e)?t(n.concat(e)):!s&&n.includes(e)&&t(n.filter((n=>n!==e)))}return(0,y.tZ)(k,{children:C.j2.map((n=>(0,y.tZ)(B.Z,{disabledFromPermissions:!1,webhookDisabled:!1,checked:e.events.includes(n),resource:n,onChange:s,isNew:"comment"===n},n)))})}$.displayName="SentryFunctionSubscriptions";const j=$,k=(0,v.Z)("div",{target:"e6znvl90"})("display:grid;grid-template:auto/1fr 1fr 1fr;@media (max-width: ",(e=>e.theme.breakpoints.large),"){grid-template:1fr 1fr 1fr/auto;}");function N(e){const n=[];e.onIssue&&n.push("issue"),e.onError&&n.push("error"),e.onComment&&n.push("comment"),delete e.onIssue,delete e.onError,delete e.onComment,e.events=n;const t=[];let s=0;for(;e[`env-variable-name-${s}`];)e[`env-variable-value-${s}`]&&t.push({name:e[`env-variable-name-${s}`],value:e[`env-variable-value-${s}`]}),delete e[`env-variable-name-${s}`],delete e[`env-variable-value-${s}`],s++;e.envVariables=t;const{...a}=e;return a}const q=[{name:"name",type:"string",required:!0,placeholder:"e.g. My Sentry Function",label:"Name",help:"Human readable name of your Sentry Function"},{name:"author",type:"string",placeholder:"e.g. Acme Software",label:"Author",help:"The company or person who built and maintains this Sentry Function."},{name:"overview",type:"string",placeholder:"e.g. This Sentry Function does something useful",label:"Overview",help:"A short description of your Sentry Function."}];function z(e){const[n]=(0,s.useState)((()=>new d.Z({transformData:N}))),{orgId:t,functionSlug:l}=e.params,{sentryFunction:v}=e,g=l?"PUT":"POST";let h=`/organizations/${t}/functions/`;l&&(h+=`${l}/`);const b=v?v.code:"exports.yourFunction = (req, res) => {\n    let message = req.query.message || req.body.message || 'Hello World!';\n    console.log('Query: ' + req.query);\n    console.log('Body: ' + req.body);\n    res.status(200).send(message);\n  };",[f,Z]=(0,s.useState)(v?.events||[]);(0,s.useEffect)((()=>{n.setValue("onIssue",f.includes("issue")),n.setValue("onError",f.includes("error")),n.setValue("onComment",f.includes("comment"))}),[n,f]);const[x,w]=(0,s.useState)(v?.env_variables?.length?v?.env_variables:[{name:"",value:""}]);return(0,y.tZ)("div",{children:(0,y.BX)(i.Z,{features:["organizations:sentry-functions"],children:[(0,y.tZ)("h2",{children:v?(0,p.t)("Editing Sentry Function"):(0,p.t)("Create Sentry Function")}),(0,y.BX)(c.Z,{apiMethod:g,apiEndpoint:h,model:n,onPreSubmit:()=>{(0,r.E3)((0,p.t)("Saving changes.."))},initialData:{code:b,events:f,envVariables:x,...e.sentryFunction},onSubmitError:e=>{let n=(0,p.t)("Unknown Error");e.status>=400&&e.status<500&&(n=e?.responseJSON.detail??n),(0,r.Iw)(n)},onSubmitSuccess:e=>{(0,r.S9)((0,p.t)("Sentry Function successfully saved.",e.name));const n=`/settings/${t}/developer-settings/sentry-functions/${e.slug}/`;v?(0,r.S9)((0,p.t)("%s successfully saved.",e.name)):(0,r.S9)((0,p.t)("%s successfully created.",e.name)),a.browserHistory.push(n)},children:[(0,y.tZ)(u.Z,{forms:[{title:(0,p.t)("Sentry Function Details"),fields:q}]}),(0,y.BX)(m.s_,{children:[(0,y.tZ)(m.V9,{children:(0,p.t)("Webhooks")}),(0,y.tZ)(m.N,{children:(0,y.tZ)(j,{events:f,setEvents:Z})})]}),(0,y.tZ)(m.s_,{children:(0,y.tZ)(S,{envVariables:x,setEnvVariables:w})}),(0,y.BX)(m.s_,{children:[(0,y.tZ)(m.V9,{children:(0,p.t)("Write your Code Below")}),(0,y.tZ)(m.N,{children:(0,y.tZ)(o.ZP,{height:"40vh",theme:"light",defaultLanguage:"javascript",defaultValue:b,onChange:function(e,t){n.setValue("code",e)},options:{minimap:{enabled:!1},scrollBeyondLastLine:!1}})})]})]})]})})}z.displayName="SentryFunctionDetails";class D extends l.Z{getEndpoints(){const{functionSlug:e,orgId:n}=this.props.params;return e?[["sentryFunction",`/organizations/${n}/functions/${e}/`]]:[]}renderBody(){return(0,y.tZ)(z,{sentryFunction:this.state.sentryFunction,...this.props})}}const X=D}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx.54649b325431047f1fe39ab9026d57ff.js.map