"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx"],{"./app/actionCreators/plugins.tsx":(t,e,s)=>{s.d(e,{Cg:()=>g,MM:()=>d,rR:()=>u}),s("../node_modules/core-js/modules/es.error.cause.js");var n=s("./app/actionCreators/indicator.tsx"),i=s("./app/api.tsx"),a=s("./app/locale.tsx"),r=s("./app/stores/pluginsStore.tsx");const o={},l=new i.KU;function p(t){let{orgId:e,projectId:s,pluginId:n,update:i,...a}=t;r.Z.onUpdate(n,i);const o=l.requestPromise(`/projects/${e}/${s}/plugins/${n}/`,{...a});return o.then((()=>{r.Z.onUpdateSuccess(n,i)})).catch((t=>{const e=t&&t.responseJSON&&"string"==typeof t.responseJSON.detail?new Error(t.responseJSON.detail):new Error("Unable to update plugin");r.Z.onUpdateError(n,i,e)})),o}function d(t,e){let{orgId:s,projectId:n}=t;const i=`/projects/${s}/${n}/plugins/`;if(o[i])return o[i];r.Z.onFetchAll(e);const a=l.requestPromise(i,{method:"GET",includeAllArgs:!0});return o[i]=a,a.then((t=>{let[e,s,n]=t;return r.Z.onFetchAllSuccess(e,{pageLinks:n?.getResponseHeader("Link")??void 0}),e})).catch((t=>{throw r.Z.onFetchAllError(t),new Error("Unable to fetch plugins")})).then((()=>o[i]=null)),a}function g(t){return(0,n.E3)((0,a.t)("Enabling...")),p({...t,update:{enabled:!0},method:"POST"}).then((()=>(0,n.S9)((0,a.t)("Plugin was enabled")))).catch((()=>(0,n.Iw)((0,a.t)("Unable to enable plugin"))))}function u(t){return(0,n.E3)((0,a.t)("Disabling...")),p({...t,update:{enabled:!1},method:"DELETE"}).then((()=>(0,n.S9)((0,a.t)("Plugin was disabled")))).catch((()=>(0,n.Iw)((0,a.t)("Unable to disable plugin"))))}},"./app/components/pluginConfig.tsx":(t,e,s)=>{s.d(e,{Z:()=>x});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("../node_modules/react/index.js"),r=s("../node_modules/lodash/isEqual.js"),o=s.n(r),l=s("./app/actionCreators/indicator.tsx"),p=s("./app/components/button.tsx"),d=s("./app/components/loadingIndicator.tsx"),g=s("./app/components/panels/index.tsx"),u=s("./app/locale.tsx"),h=s("./app/plugins/index.tsx"),c=s("./app/plugins/components/pluginIcon.tsx"),m=s("./app/styles/space.tsx"),Z=s("./app/utils/withApi.tsx"),b=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class S extends a.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{loading:!h.ZP.isLoaded(this.props.data),testResults:""}),(0,n.Z)(this,"handleDisablePlugin",(()=>{this.props.onDisablePlugin(this.props.data)})),(0,n.Z)(this,"handleTestPlugin",(async()=>{this.setState({testResults:""}),(0,l.E3)((0,u.t)("Sending test..."));try{const t=await this.props.api.requestPromise(this.getPluginEndpoint(),{method:"POST",data:{test:!0}});this.setState({testResults:JSON.stringify(t.detail)}),(0,l.S9)((0,u.t)("Test Complete!"))}catch(t){(0,l.Iw)((0,u.t)("An unexpected error occurred while testing your plugin. Please try again."))}}))}componentDidMount(){this.loadPlugin(this.props.data)}UNSAFE_componentWillReceiveProps(t){this.loadPlugin(t.data)}shouldComponentUpdate(t,e){return!o()(e,this.state)||!o()(t.data,this.props.data)}loadPlugin(t){this.setState({loading:!0},(()=>{h.ZP.load(t,(()=>{this.setState({loading:!1})}))}))}getPluginEndpoint(){const{organization:t,project:e,data:s}=this.props;return`/projects/${t.slug}/${e.slug}/plugins/${s.id}/`}createMarkup(){return{__html:this.props.data.doc}}render(){const{data:t}=this.props,e=void 0!==this.props.enabled?this.props.enabled:t.enabled;return(0,b.BX)(g.s_,{className:`plugin-config ref-plugin-config-${t.id}`,"data-test-id":"plugin-config",children:[(0,b.BX)(g.V9,{hasButtons:!0,children:[(0,b.BX)(P,{children:[(0,b.tZ)(f,{pluginId:t.id}),(0,b.tZ)("span",{children:t.name})]}),t.canDisable&&e&&(0,b.BX)(w,{children:[t.isTestable&&(0,b.tZ)(y,{onClick:this.handleTestPlugin,size:"sm",children:(0,u.t)("Test Plugin")}),(0,b.tZ)(p.ZP,{size:"sm",onClick:this.handleDisablePlugin,children:(0,u.t)("Disable")})]})]}),"beta"===t.status&&(0,b.tZ)(g.aU,{type:"warning",children:(0,u.t)("This plugin is considered beta and may change in the future.")}),""!==this.state.testResults&&(0,b.BX)(g.aU,{type:"info",children:[(0,b.tZ)("strong",{children:"Test Results"}),(0,b.tZ)("div",{children:this.state.testResults})]}),(0,b.BX)(j,{children:[(0,b.tZ)("div",{dangerouslySetInnerHTML:this.createMarkup()}),this.state.loading?(0,b.tZ)(d.Z,{}):h.ZP.get(t).renderSettings({organization:this.props.organization,project:this.props.project})]})]})}}S.displayName="PluginConfig",(0,n.Z)(S,"defaultProps",{onDisablePlugin:()=>{}});const x=(0,Z.Z)(S),P=(0,i.Z)("div",{target:"e1kqgtma4"})({name:"y37upr",styles:"display:flex;align-items:center;flex:1"}),f=(0,i.Z)(c.ZP,{target:"e1kqgtma3"})("margin-right:",(0,m.Z)(1),";"),w=(0,i.Z)("div",{target:"e1kqgtma2"})({name:"zjik7",styles:"display:flex"}),y=(0,i.Z)(p.ZP,{target:"e1kqgtma1"})("margin-right:",(0,m.Z)(1),";"),j=(0,i.Z)(g.N,{target:"e1kqgtma0"})("padding:",(0,m.Z)(2),";padding-bottom:0;")},"./app/stores/pluginsStore.tsx":(t,e,s)=>{s.d(e,{Z:()=>r});var n=s("../node_modules/reflux/src/index.js");const i={loading:!0,plugins:[],error:null,pageLinks:null},a={plugins:null,state:{...i},updating:new Map,reset(){return this.plugins=null,this.state={...i},this.updating=new Map,this.state},getInitialState(){return this.getState()},getState(){const{plugins:t,...e}=this.state;return{...e,plugins:this.plugins?Array.from(this.plugins.values()):[]}},init(){this.reset()},triggerState(){this.trigger(this.getState())},onFetchAll(){let{resetLoading:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(this.state.loading=!0,this.state.error=null,this.plugins=null),this.triggerState()},onFetchAllSuccess(t,e){let{pageLinks:s}=e;this.plugins=new Map(t.map((t=>[t.id,t]))),this.state.pageLinks=s||null,this.state.loading=!1,this.triggerState()},onFetchAllError(t){this.plugins=null,this.state.loading=!1,this.state.error=t,this.triggerState()},onUpdate(t,e){if(!this.plugins)return;const s=this.plugins.get(t);if(!s)return;const n={...s,...e};this.plugins.set(t,n),this.updating.set(t,s),this.triggerState()},onUpdateSuccess(t,e){this.updating.delete(t)},onUpdateError(t,e,s){const n=this.updating.get(t);n&&this.plugins&&(this.plugins.set(t,n),this.updating.delete(t),this.state.error=s,this.triggerState())}},r=(0,n.createStore)(a)}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx.0612d5eff13994db4597169fa4d68de6.js.map